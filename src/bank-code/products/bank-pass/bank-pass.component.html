<div class="bank-pass">
    <section *ngIf="hasSubscription$ | async; else noSubscription">
        <mat-tab-group>
            <mat-tab [label]="ls.l('MyBankPass').toUpperCase()">
                <access-code-instructions></access-code-instructions>
                <div class="bank-pass-achievements">
                    <h2>{{ ls.l('BankPassAchievements') }}</h2>
                    <div class="achievements-content">
                        <div class="collect-bankcodes">
                            <h6>{{ ls.l('CollectAllBankCodes') }}</h6>
                            <img src="">
                        </div>
                        <div class="collect-badges">
                            <h6>{{ ls.l('CollectAllBadges') }}</h6>
                            <div class="badges">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                                <img src="./assets/common/images/bank-code/codebreaker-8.png">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="road-tracker">
                    <h2>{{ ls.l('BankPassRoadTracker') }}</h2>
                    <div class="settings">
                        <div>
                            <label>{{ ls.l('WorkDaysPerWeek') }}</label>
                            <dx-select-box [items]="workDaysPerWeekValues"></dx-select-box>
                        </div>
                        <div>
                            <label>{{ ls.l('Goal') }}</label>
                            <dx-select-box [items]="goalValues"></dx-select-box>
                        </div>
                        <div>
                            <label>{{ ls.l('GoalType') }}</label>
                            <dx-select-box [items]="goalTypes"
                                           displayExpr="text">
                            </dx-select-box>
                        </div>
                        <button class="update">{{ ls.l('Update') }}</button>
                    </div>
                    <div class="goals">
                        <div *ngFor="let goal of goalTypes" class="goal">
                            <div class="text">{{ goal.text + ' ' + ls.l('Goal') }}</div>
                            <div class="number">{{ goal.number }}</div>
                            <ng-container *ngIf="(goal.currentNumber / goal.number * 100).toFixed(0) as percent">
                                <circle-progress [percent]="+percent"
                                                 [outerStrokeColor]="goal.outerColor"
                                                 [innerStrokeColor]="goal.innerColor"
                                                 [title]="percent + '%'"
                                                 [radius]="42"
                                                 [titleFontWeight]="900"
                                                 [titleColor]="goal.innerColor"
                                                 [animation]="false"
                                                 [animateTitle]="false"
                                                 [animationDuration]="0"
                                                 titleFontSize="23px"
                                                 subtitleFontSize="12.3px"
                                                 [subtitleFontWeight]="700"
                                                 [subtitleColor]="goal.innerColor"
                                                 [subtitle]="goal.currentNumber">
                                </circle-progress>
                            </ng-container>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab [label]="ls.l('Leads').toUpperCase()">
                <div [hidden]="dataIsLoading">
                    <div class="grid" [hidden]="totalCount <= 0">
                        <dx-text-box [placeholder]="ls.l('Search')"
                                     [value]="searchValue"
                                     mode="search"
                                     (onValueChanged)="searchValueChange($event)">
                        </dx-text-box>
                        <dx-data-grid id="gridContainer"
                                      class="limitedPagerTotal"
                                      accessKey="narrowHeaderPanel"
                                      [noDataText]="''"
                                      [dataSource]="dataSource"
                                      [allowColumnReordering]="true"
                                      [columnAutoWidth]="true"
                                      [loadPanel]="{ enabled: false }"
                                      [allowColumnResizing]="true"
                                      [hoverStateEnabled]="true"
                                      [pager]="gridPagerConfig"
                                      (onDataErrorOccurred)="httpInterceptor.handleError($event.error)">
                            <dxo-paging [pageSize]="10"></dxo-paging>
                            <dxi-column dataField="PhotoPublicId" caption=" " cellTemplate="photoTemplate"
                                        [width]="50" [allowExporting]="false"
                                        [allowGrouping]="false" [allowSorting]="false"></dxi-column>
                            <div *dxTemplate="let data of 'photoTemplate'">
                                <div [ngStyle]="{'background-image': 'url(' + profileService.getContactPhotoUrl(data.data.PhotoPublicId) + ')'}"
                                     class="img-circle">
                                </div>
                            </div>
                            <dxi-column dataField="Name" [caption]="ls.l('Name')" [width]="150"></dxi-column>
                            <dxi-column dataField="Email" [caption]="ls.l('Email')" [width]="160"></dxi-column>
                            <dxi-column dataField="Phone" [caption]="ls.l('Phone')" cellTemplate="phoneCell" cssClass="tabular"></dxi-column>
                            <dxi-column dataField="CountryId" [caption]="ls.l('CountryCode')"></dxi-column>
                            <dxi-column dataField="StateId" [caption]="ls.l('State')"></dxi-column>
                            <dxi-column dataField="BankCode" cellTemplate="bankCodeCell" [caption]="ls.l('BankCode')" [width]="105"></dxi-column>
                            <dxi-column dataField="ContactDate" [caption]="ls.l('Created')" cellTemplate="dateCell" cssClass="tabular"></dxi-column>
                            <div *dxTemplate="let cellData of 'phoneCell'">
                                {{cellData.value | phone}}
                            </div>
                            <div *dxTemplate="let cellData of 'dateCell'">
                                {{cellData.value | date: formatting.date : userTimezone}}
                            </div>
                            <div *dxTemplate="let cellData of 'bankCodeCell'">
                                <bank-code-letters [bankCode]="cellData.value"></bank-code-letters>
                            </div>
                            <dxo-sorting mode="none"></dxo-sorting>
                        </dx-data-grid>
                    </div>
                    <app-no-data [hidden]="totalCount > 0"
                                 height="calc(100vh - 69px)"
                                 title="No contacts added yet"
                                 [showLink]="false">
                    </app-no-data>
                </div>
                <loading-spinner [hidden]="!dataIsLoading"></loading-spinner>
            </mat-tab>
        </mat-tab-group>
        <div class="my-access-code" *ngIf="accessCode$ | async as accessCode">
            <span>{{ ls.l('MyAccessCode') }}: </span>
            <span class="code">{{ accessCode }}</span>
        </div>
    </section>
    <ng-template #noSubscription>
        <section class="iframe" *ngIf="environmentLink$ | async as environmentLink">
            <iframe [src]="environmentLink" frameborder="0"></iframe>
        </section>
    </ng-template>
</div>
