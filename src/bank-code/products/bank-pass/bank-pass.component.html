<div class="bank-pass">
    <section *ngIf="hasSubscription$ | async; else noSubscription">
        <div class="header">
            <div class="search">
                <dx-text-box [placeholder]="ls.l('Search')"
                             [value]="searchValue"
                             [showClearButton]="false"
                             mode="search"
                             (onValueChanged)="searchValueChange($event)">
                </dx-text-box>
            </div>
            <div class="my-access-code">
                <span>{{ ls.l('MyAccessCode') }}: </span>
                <inplace-edit [value]="accessCode$ | async"
                              [editPlaceholder]="ls.l('YourAccessCode')"
                              [isCopyEnabled]="true"
                              [isEditDialogEnabled]="true"
                              [validationRules]="accessCodeValidationRules"
                              [showEditModeOnEditButtonClick]="true"
                              (valueChanged)="accessCodeChanged($event)">
                </inplace-edit>
            </div>
        </div>
        <mat-tab-group (selectedTabChange)="tabChanged($event)">
            <mat-tab [label]="ls.l('MyBankPass').toUpperCase()">
                <access-code-instructions></access-code-instructions>
                <div class="bank-pass-achievements">
                    <h2>{{ ls.l('BankPassAchievements') }}</h2>
                    <div class="achievements-content">
                        <div class="collect-bankcodes">
                            <h6>{{ ls.l('CollectAllBankCodes') }}</h6>
                            <div class="bank-code-groups">
                                <div *ngFor="let bankCodeGroup of bankCodeGroups; let i = index" class="bank-code-group">
                                    <img src="./assets/common/images/bank-code/{{bankCodeGroups[i][0][0]}}1.png">
                                    <div class="title" [ngStyle]="{ background: bankCodeService.getBackgroundColorByLetter(bankCodeGroupsTitles[i][0]) }">
                                        {{ bankCodeGroupsTitles[i] }}
                                    </div>
                                    <div>
                                        <bank-code-letters *ngFor="let bankCode of bankCodeGroups[i]"
                                                           [bankCode]="bankCode"
                                                           [active]="isBankCodeActive(bankCode)">
                                        </bank-code-letters>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="collect-badges">
                            <h6>{{ ls.l('CollectAllBadges') }}</h6>
                            <div class="badges">
                                <img *ngFor="let bankCodeBadge of bankCodeBadges; let i = index"
                                     src="./assets/common/images/bank-code/badges/L{{i + 1}}-{{ (i + 1) <= bankCodeLevel ? '1' : '0' }}.png">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="road-tracker">
                    <h2>{{ ls.l('BankPassGoalTracker') }}</h2>
                    <div class="settings">
                        <div>
                            <label>{{ ls.l('WorkDaysPerWeek') }}</label>
                            <dx-select-box [items]="workDaysPerWeekValues"></dx-select-box>
                        </div>
                        <div>
                            <label>{{ ls.l('Goal') }}</label>
                            <dx-select-box [items]="goalValues"></dx-select-box>
                        </div>
                        <div>
                            <label>{{ ls.l('GoalType') }}</label>
                            <dx-select-box [items]="goalTypes"
                                           displayExpr="text">
                            </dx-select-box>
                        </div>
                        <button class="update">{{ ls.l('Update') }}</button>
                    </div>
                    <div class="goals">
                        <div *ngFor="let goal of goalTypes" class="goal">
                            <div class="text">{{ goal.text + ' ' + ls.l('Goal') }}</div>
                            <div class="number">{{ goal.number }}</div>
                            <ng-container *ngIf="(goal.currentNumber / goal.number * 100).toFixed(0) as percent">
                                <circle-progress [percent]="+percent"
                                                 [outerStrokeColor]="goal.outerColor"
                                                 [innerStrokeColor]="goal.innerColor"
                                                 [title]="percent + '%'"
                                                 [radius]="42"
                                                 [titleFontWeight]="900"
                                                 [titleColor]="goal.innerColor"
                                                 [animation]="false"
                                                 [animateTitle]="false"
                                                 [animationDuration]="0"
                                                 titleFontSize="23px"
                                                 subtitleFontSize="12px"
                                                 [subtitleFontWeight]="700"
                                                 [subtitleColor]="goal.innerColor"
                                                 [subtitle]="goal.currentNumber">
                                </circle-progress>
                            </ng-container>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab [label]="ls.l('Leads').toUpperCase()">
                <div *ngIf="currentTabIndex == 1">
                    <div class="grid" [hidden]="totalCount <= 0">
                        <dx-data-grid id="gridContainer"
                                      class="limitedPagerTotal"
                                      accessKey="narrowHeaderPanel"
                                      [noDataText]="''"
                                      [dataSource]="dataSource"
                                      [allowColumnReordering]="true"
                                      [columnAutoWidth]="true"
                                      [loadPanel]="{ enabled: false }"
                                      [allowColumnResizing]="true"
                                      [hoverStateEnabled]="true"
                                      (onDataErrorOccurred)="httpInterceptor.handleError($event.error)">
                            <dxo-paging [pageSize]="10"></dxo-paging>
                            <dxo-pager
                                [showPageSizeSelector]="true"
                                [allowedPageSizes]="[10, 20, 50]"
                                [showInfo]="true">
                            </dxo-pager>
                            <dxi-column dataField="PhotoPublicId" caption=" " cellTemplate="photoTemplate"
                                        [width]="50" [allowExporting]="false"
                                        [allowGrouping]="false" [allowSorting]="false"></dxi-column>
                            <div *dxTemplate="let data of 'photoTemplate'">
                                <div [ngStyle]="{'background-image': 'url(' + profileService.getContactPhotoUrl(data.data.PhotoPublicId) + ')'}"
                                     class="img-circle">
                                </div>
                            </div>
                            <dxi-column dataField="Name" [caption]="ls.l('Name')" [width]="150"></dxi-column>
                            <dxi-column dataField="Email" [caption]="ls.l('Email')" [width]="160"></dxi-column>
                            <dxi-column dataField="Phone" [caption]="ls.l('Phone')" cellTemplate="phoneCell" cssClass="tabular"></dxi-column>
                            <dxi-column dataField="CountryId" [caption]="ls.l('CountryCode')"></dxi-column>
                            <dxi-column dataField="StateId" [caption]="ls.l('State')"></dxi-column>
                            <dxi-column dataField="BankCode" cellTemplate="bankCodeCell" [caption]="ls.l('BankCode')" [width]="105"></dxi-column>
                            <dxi-column dataField="LeadDate" [caption]="ls.l('Created')" cellTemplate="dateCell" cssClass="tabular"></dxi-column>
                            <div *dxTemplate="let cellData of 'phoneCell'">
                                {{cellData.value | phone}}
                            </div>
                            <div *dxTemplate="let cellData of 'dateCell'">
                                {{cellData.value | date: formatting.date : userTimezone}}
                            </div>
                            <div *dxTemplate="let cellData of 'bankCodeCell'">
                                <bank-code-letters [bankCode]="cellData.value"></bank-code-letters>
                            </div>
                            <dxo-sorting mode="none"></dxo-sorting>
                        </dx-data-grid>
                    </div>
                    <app-no-data [hidden]="totalCount > 0"
                                 title="No contacts added yet"
                                 [showLink]="false">
                    </app-no-data>
                </div>
            </mat-tab>
        </mat-tab-group>
    </section>
    <ng-template #noSubscription>
        <div class="iframe">
            <iframe [src]="environmentLink$ | async" frameborder="0"></iframe>
        </div>
    </ng-template>
    <loading-spinner *ngIf="dataIsLoading"></loading-spinner>
</div>
