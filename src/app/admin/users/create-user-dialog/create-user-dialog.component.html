<div class="photo-area" (click)="showUploadPhoto($event)" [ngStyle]="{'background-image': photoOriginalData ? 'url(' + photoOriginalData + ')': ''}"></div>
<modal-dialog [title]="title"
              [editTitle]="true"
              [titleClearButton]="true"
              [buttons]="buttons"
              [placeholder]="ls.l('FullNamePlaceholder')"
              (onTitleKeyUp)="onFullNameKeyUp($event)"
              (titleChange)="onFullNameKeyUp($event)">
    <dx-scroll-view showScrollbar="onHover">
        <dx-context-menu
            [selectByClick]="true"
            [selectionMode]="'single'"
            [dataSource]="saveContextMenuItems"
            [position]="{ my: 'top right', at: 'bottom right' }"
            (onSelectionChanged)="onSaveOptionSelectionChanged($event)"
            target="#{{saveButtonId}}">
        </dx-context-menu>
        <app-toolbar [config]="toolbarConfig"></app-toolbar>
        <mat-sidenav class="main_sidenav" mode="side" position="end" opened="true">
            <mat-tab-group>
                <mat-tab [label]="ls.l('UserInformations') | uppercase">
                    <div class="tab-content">
                        <form #userForm="ngForm" novalidate (ngSubmit)="save()" autocomplete="off">
                            <div class="form-group">
                                <label>{{ls.l("EmailAddress")}}</label>
                                <input type="email" name="EmailAddress" class="form-control" [(ngModel)]="user.emailAddress" required maxlength="256" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$">
                            </div>

                            <div class="form-group">
                                <label>{{ls.l("PhoneNumber")}}</label>
                                <dx-text-box #phoneNumber
                                             type="tel"
                                             name="PhoneNumber"
                                             class="tabular"
                                             [(value)]="user.phoneNumber"
                                             [maskInvalidMessage]="ls.l('PhoneValidationError')"
                                             [mask]="masks.phone"
                                             [isValid]="true"
                                             (onFocusIn)="focusInput($event)"
                                             (onFocusOut)="phoneComponentFocusOut($event)"
                                             (onInitialized)="phoneComponentInitialized($event)">
                                </dx-text-box>
                            </div>

                            <div class="user-options-delimiter"></div>
                            <dx-check-box [(value)]="setRandomPassword" [text]="ls.l('SetRandomPassword')"></dx-check-box>
                            <div class="form-group" *ngIf="!setRandomPassword">
                                <div class="right form-group">
                                    <label>{{ls.l("Password")}}</label>
                                    <input type="password" name="Password" #Password="ngModel" id="Password" class="form-control" [(ngModel)]="user.password" [required]="!user.id && !setRandomPassword" maxlength="32"
                                           [requireDigit]="passwordComplexitySetting?.requireDigit" [requireLowercase]="passwordComplexitySetting?.requireLowercase"
                                           [requireUppercase]="passwordComplexitySetting?.requireUppercase" [requireNonAlphanumeric]="passwordComplexitySetting?.requireNonAlphanumeric" [requiredLength]="passwordComplexitySetting?.requiredLength"
                                           validateEqual="PasswordRepeat" reverse="true">
                                </div>
                            </div>
                            <div [hidden]="setRandomPassword || userForm.form.valid || userForm.form.pristine">
                                <ul class="help-block text-danger" *ngIf="userForm.controls['Password'] && userForm.controls['Password'].errors">
                                    <li [hidden]="!userForm.controls['Password'].errors.requireDigit">{{ls.l("PasswordComplexity_RequireDigit_Hint")}}</li>
                                    <li [hidden]="!userForm.controls['Password'].errors.requireLowercase">{{ls.l("PasswordComplexity_RequireLowercase_Hint")}}</li>
                                    <li [hidden]="!userForm.controls['Password'].errors.requireUppercase">{{ls.l("PasswordComplexity_RequireUppercase_Hint")}}</li>
                                    <li [hidden]="!userForm.controls['Password'].errors.requireNonAlphanumeric">{{ls.l("PasswordComplexity_RequireNonAlphanumeric_Hint")}}</li>
                                    <li [hidden]="!userForm.controls['Password'].errors.requiredLength">{{ls.l("PasswordComplexity_RequiredLength_Hint", passwordComplexitySetting?.requiredLength)}}</li>
                                </ul>
                            </div>
                            <div class="form-group" *ngIf="!setRandomPassword">
                                <div class="right form-group">
                                    <label>{{ls.l("PasswordRepeat")}}</label>
                                    <input type="password" name="PasswordRepeat" #PasswordRepeat="ngModel" class="form-control" [(ngModel)]="user.passwordRepeat" [required]="!user.id && !setRandomPassword" maxlength="32"
                                           [requireDigit]="passwordComplexitySetting?.requireDigit" [requireLowercase]="passwordComplexitySetting?.requireLowercase"
                                           [requireUppercase]="passwordComplexitySetting?.requireUppercase" [requireNonAlphanumeric]="passwordComplexitySetting?.requireNonAlphanumeric" [requiredLength]="passwordComplexitySetting?.requiredLength"
                                           validateEqual="Password" reverse="false">
                                </div>
                            </div>
                            <div [hidden]="setRandomPassword || userForm.form.valid || userForm.form.pristine">
                                <ul class="help-block text-danger" *ngIf="userForm.controls['PasswordRepeat'] && userForm.controls['PasswordRepeat'].errors">
                                    <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireDigit">{{ls.l("PasswordComplexity_RequireDigit_Hint")}}</li>
                                    <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireLowercase">{{ls.l("PasswordComplexity_RequireLowercase_Hint")}}</li>
                                    <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireUppercase">{{ls.l("PasswordComplexity_RequireUppercase_Hint")}}</li>
                                    <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requireNonAlphanumeric">{{ls.l("PasswordComplexity_RequireNonAlphanumeric_Hint")}}</li>
                                    <li [hidden]="!userForm.controls['PasswordRepeat'].errors.requiredLength">{{ls.l("PasswordComplexity_RequiredLength_Hint", passwordComplexitySetting?.requiredLength)}}</li>
                                </ul>
                            </div>
                            <div class="m-checkbox-list">
                                <dx-check-box [(value)]="user.shouldChangePasswordOnNextLogin" [text]="ls.l('ShouldChangePasswordOnNextLogin')"></dx-check-box>
                                <dx-check-box [(value)]="sendActivationEmail" [text]="ls.l('SendActivationEmail')"></dx-check-box>
                                <dx-check-box [(value)]="user.isActive" [text]="ls.l('Active')"></dx-check-box>
                                <dx-check-box *ngIf="isTwoFactorEnabled" [(value)]="user.isTwoFactorEnabled" [text]="ls.l('IsTwoFactorEnabled')"></dx-check-box>
                                <dx-check-box *ngIf="isLockoutEnabled" [(value)]="user.isLockoutEnabled" [text]="ls.l('IsLockoutEnabled')"></dx-check-box>
                            </div>
                        </form>
                    </div>
                </mat-tab>
                <mat-tab label="{{ls.l('Roles') | uppercase}} {{'(' + getAssignedRoleCount() + ')'}}">
                    <div class="tab-content">
                        <label attr.for="EditUser_{{role.roleName}}" class="m-checkbox" *ngFor="let role of roles">
                            <input id="EditUser_{{role.roleName}}" type="checkbox" name="{{role.roleName}}" [(ngModel)]="role.isAssigned">
                            {{role.roleDisplayName}}
                            <span></span>
                        </label>
                    </div>
                </mat-tab>
                <mat-tab label="{{ls.l('OrganizationUnits') | uppercase}} {{'(' + getAssignedOrgUnitCount() + ')'}}">
                    <div class="tab-content">
                        <organization-unit-tree #organizationUnitTree></organization-unit-tree>
                    </div>
                </mat-tab>
            </mat-tab-group>
        </mat-sidenav>
    </dx-scroll-view>
</modal-dialog>
