<div [@routerTransition]>
    <app-headline [names]="[ l('Settings') ]"
                  [buttons]="headlineButtons">
    </app-headline>

    <div class="wrapper" #tabGroup>
        <mat-tab-group *ngIf="hostSettings" [selectedIndex]="tabIndex | async">
            <mat-tab label="{{l('General')}}" *ngIf="showTimezoneSelection">
                <dx-scroll-view showScrollbar="onHover">
                    <div class="form-group">
                        <label for="Timezone">{{l("Timezone")}}</label>
                        <timezone-combo id="Timezone"
                                        [(selectedTimeZone)]="hostSettings.general.timezone"
                                        [defaultTimezoneScope]="defaultTimezoneScope">
                        </timezone-combo>
                    </div>
                    <div class="form-group">
                        <label for="DefaultCountry">{{l("DefaultCountry")}}</label>
                        <dx-select-box stylingMode="outlined"
                                       valueExpr="key"
                                       displayExpr="text"
                                       [(value)]="hostSettings.general.defaultCountryCode"
                                       [dataSource]="supportedCountries">
                        </dx-select-box>
                    </div>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('TenantManagement')}}" *ngIf="hostSettings.tenantManagement">
                <dx-scroll-view showScrollbar="onHover">
                    <div class="m-form">
                        <h5>{{l("FormBasedRegistration")}}</h5>
                        <div class="m-checkbox-list">
                            <div class="form-group">
                                <dx-check-box id="Setting_AllowSelfRegistration"
                                              [text]="l('AllowTenantsToRegisterThemselves')"
                                              [(value)]="hostSettings.tenantManagement.allowSelfRegistration">
                                </dx-check-box>
                                <span class="m-form__help">{{l("AllowTenantsToRegisterThemselves_Hint")}}</span>
                            </div>
                            <div class="form-group">
                                <dx-check-box id="Setting_IsNewRegisteredTenantActiveByDefault"
                                              [text]="l('NewRegisteredTenantsIsActiveByDefault')"
                                              [(value)]="hostSettings.tenantManagement.isNewRegisteredTenantActiveByDefault">
                                </dx-check-box>
                                <span class="m-form__help">{{l("NewRegisteredTenantsIsActiveByDefault_Hint")}}</span>
                            </div>
                            <div class="form-group">
                                <dx-check-box id="Setting_UseCaptchaOnRegistration"
                                              [text]="l('UseCaptchaOnRegistration')"
                                              [(value)]="hostSettings.tenantManagement.useCaptchaOnRegistration">
                                </dx-check-box>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="DefaultEditionId">{{l("Edition")}}</label>
                            <select id="DefaultEditionId" class="form-control" [(ngModel)]="hostSettings.tenantManagement.defaultEditionId">
                                <option value=""></option>
                                <option *ngFor="let edition of editions" [value]="edition.value">{{edition.displayText}}</option>
                            </select>
                        </div>
                    </div>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('UserRegistration')}}" *ngIf="hostSettings.userManagement">
                <dx-scroll-view showScrollbar="onHover">
                    <div class="form-group">
                        <dx-check-box id="Settings_IsEmailConfirmationRequiredForLogin"
                                      [text]="l('EmailConfirmationRequiredForLogin')"
                                      [(value)]="hostSettings.userManagement.isEmailConfirmationRequiredForLogin">
                        </dx-check-box>
                    </div>
                    <div class="form-group">
                        <dx-check-box id="Settings_SmsVerificationEnabled"
                                      [text]="l('SmsVerificationEnabled')"
                                      [(value)]="hostSettings.userManagement.smsVerificationEnabled">
                        </dx-check-box>
                    </div>
                    <contact-group-templates [title]="l('UserRegistrationEmail')"
                                             [(customTemplates)]="hostSettings.userManagement.customWelcomeEmailTemplates"
                                             [templateType]="EmailTemplateType.WelcomeEmail">
                    </contact-group-templates>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('Security')}}" *ngIf="hostSettings.security">
                <dx-scroll-view showScrollbar="onHover">
                    <div>
                        <h5>{{l("PasswordComplexity")}}</h5>
                        <div class="form-group">
                            <dx-check-box id="Setting_PasswordComplexity_UseDefaultSettings"
                                          [text]="l('UseDefaultSettings')"
                                          [(value)]="hostSettings.security.useDefaultPasswordComplexitySettings">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_PasswordComplexity_RequireDigit"
                                          *ngIf="!hostSettings.security.useDefaultPasswordComplexitySettings"
                                          [text]="l('PasswordComplexity_RequireDigit')"
                                          [(value)]="hostSettings.security.passwordComplexity.requireDigit">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_PasswordComplexity_RequireDigit"
                                          *ngIf="hostSettings.security.useDefaultPasswordComplexitySettings"
                                          [disabled]="true"
                                          [text]="l('PasswordComplexity_RequireDigit')"
                                          [(value)]="hostSettings.security.defaultPasswordComplexity.requireDigit">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_PasswordComplexity_RequireLowercase"
                                          *ngIf="!hostSettings.security.useDefaultPasswordComplexitySettings"
                                          [text]="l('PasswordComplexity_RequireLowercase')"
                                          [(value)]="hostSettings.security.passwordComplexity.requireLowercase">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_PasswordComplexity_RequireLowercase"
                                          *ngIf="hostSettings.security.useDefaultPasswordComplexitySettings"
                                          [text]="l('PasswordComplexity_RequireLowercase')"
                                          [disabled]="true"
                                          [(value)]="hostSettings.security.defaultPasswordComplexity.requireLowercase">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_PasswordComplexity_RequireNonAlphanumeric"
                                          *ngIf="!hostSettings.security.useDefaultPasswordComplexitySettings"
                                          [text]="l('PasswordComplexity_RequireNonAlphanumeric')"
                                          [(value)]="hostSettings.security.passwordComplexity.requireNonAlphanumeric">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_PasswordComplexity_RequireNonAlphanumeric"
                                          *ngIf="hostSettings.security.useDefaultPasswordComplexitySettings"
                                          [text]="l('PasswordComplexity_RequireNonAlphanumeric')"
                                          [disabled]="true"
                                          [(value)]="hostSettings.security.defaultPasswordComplexity.requireNonAlphanumeric">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_PasswordComplexity_RequireUppercase"
                                          *ngIf="!hostSettings.security.useDefaultPasswordComplexitySettings"
                                          [text]="l('PasswordComplexity_RequireUppercase')"
                                          [(value)]="hostSettings.security.passwordComplexity.requireUppercase">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_PasswordComplexity_RequireUppercase"
                                          *ngIf="hostSettings.security.useDefaultPasswordComplexitySettings"
                                          [text]="l('PasswordComplexity_RequireUppercase')"
                                          [disabled]="true"
                                          [(value)]="hostSettings.security.defaultPasswordComplexity.requireUppercase">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <label>{{l("PasswordComplexity_RequiredLength")}}</label>
                            <input type="number" name="RequiredLength" class="form-control" [ngClass]="{'edited':hostSettings.security.passwordComplexity.requiredLength}"
                                   [(ngModel)]="hostSettings.security.passwordComplexity.requiredLength" *ngIf="!hostSettings.security.useDefaultPasswordComplexitySettings">
                            <input type="number" name="RequiredLength" class="form-control" [ngClass]="{'edited':hostSettings.security.defaultPasswordComplexity.requiredLength}"
                                   [(ngModel)]="hostSettings.security.defaultPasswordComplexity.requiredLength" *ngIf="hostSettings.security.useDefaultPasswordComplexitySettings"
                                   disabled>
                        </div>
                    </div>
                    <div>
                        <h5>{{l("UserLockOut")}}</h5>
                        <div class="form-group">
                            <div class="form-group">
                                <dx-check-box id="Setting_UserLockOut_IsEnabled"
                                              [text]="l('EnableUserAccountLockingOnFailedLoginAttemts')"
                                              [(value)]="hostSettings.security.userLockOut.isEnabled">
                                </dx-check-box>
                            </div>
                        </div>
                        <div class="form-group" *ngIf="hostSettings.security.userLockOut.isEnabled">
                            <label for="MaxFailedAccessAttemptsBeforeLockout">{{l("MaxFailedAccessAttemptsBeforeLockout")}}</label>
                            <input id="MaxFailedAccessAttemptsBeforeLockout" type="number" name="MaxFailedAccessAttemptsBeforeLockout" class="form-control" [ngClass]="{'edited':hostSettings.security.userLockOut.maxFailedAccessAttemptsBeforeLockout}"
                                   [(ngModel)]="hostSettings.security.userLockOut.maxFailedAccessAttemptsBeforeLockout">
                        </div>
                        <div class="form-group" *ngIf="hostSettings.security.userLockOut.isEnabled">
                            <label for="DefaultAccountLockoutDurationAsSeconds">{{l("DefaultAccountLockoutDurationAsSeconds")}}</label>
                            <input id="DefaultAccountLockoutDurationAsSeconds" type="number" name="DefaultAccountLockoutSeconds" class="form-control" [ngClass]="{'edited':hostSettings.security.userLockOut.defaultAccountLockoutSeconds}"
                                   [(ngModel)]="hostSettings.security.userLockOut.defaultAccountLockoutSeconds">
                        </div>
                    </div>
                    <div>
                        <h5>{{l("TwoFactorLogin")}}</h5>
                        <div class="form-group">
                            <dx-check-box id="Setting_TwoFactorLogin_IsEnabled"
                                          [text]="l('EnableTwoFactorLogin')"
                                          [(value)]="hostSettings.security.twoFactorLogin.isEnabled">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_TwoFactorLogin_IsEmailProviderEnabled"
                                          *ngIf="hostSettings.security.twoFactorLogin.isEnabled"
                                          [text]="l('IsEmailVerificationEnabled')"
                                          [(value)]="hostSettings.security.twoFactorLogin.isEmailProviderEnabled">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_TwoFactorLogin_IsSmsProviderEnabled"
                                          *ngIf="hostSettings.security.twoFactorLogin.isEnabled"
                                          [text]="l('IsSmsVerificationEnabled')"
                                          [(value)]="hostSettings.security.twoFactorLogin.isSmsProviderEnabled">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_TwoFactorLogin_IsGoogleAuthenticatorEnabled"
                                          *ngIf="hostSettings.security.twoFactorLogin.isEnabled"
                                          [text]="l('IsGoogleAuthenticatorEnabled')"
                                          [(value)]="hostSettings.security.twoFactorLogin.isGoogleAuthenticatorEnabled">
                            </dx-check-box>
                        </div>
                        <div class="form-group">
                            <dx-check-box id="Setting_TwoFactorLogin_IsRememberBrowserEnabled"
                                          *ngIf="hostSettings.security.twoFactorLogin.isEnabled"
                                          [text]="l('AllowToRememberBrowserForTwoFactorLogin') + '. ' + l('AllowToRememberBrowserForTwoFactorLoginDescription')"
                                          [(value)]="hostSettings.security.twoFactorLogin.isRememberBrowserEnabled">
                            </dx-check-box>
                        </div>
                    </div>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab [label]="l('Domain')" *ngIf="isAdminCustomizations && isTenantHosts">
                <dx-scroll-view showScrollbar="onHover">
                    <system-settings></system-settings>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('EmailSmtp')}}" *ngIf="hostSettings.email">
                <dx-scroll-view showScrollbar="onHover">
                    <div class="form-group">
                        <label for="DefaultFromAddress">{{l("DefaultFromAddress")}}</label>
                        <input id="DefaultFromAddress" type="email" name="DefaultFromAddress" class="form-control"
                               [ngClass]="{'edited':hostSettings.email.defaultFromAddress}"
                               [(ngModel)]="hostSettings.email.defaultFromAddress" maxlength="256">
                    </div>
                    <div class="form-group">
                        <label for="DefaultFromDisplayName">{{l("DefaultFromDisplayName")}}</label>
                        <input id="DefaultFromDisplayName" type="text" name="DefaultFromDisplayName" class="form-control"
                               [ngClass]="{'edited':hostSettings.email.defaultFromDisplayName}"
                               [(ngModel)]="hostSettings.email.defaultFromDisplayName" maxlength="128">
                    </div>
                    <div class="form-group">
                        <label for="SmtpHost">{{l("SmtpHost")}}</label>
                        <input id="SmtpHost" type="text" name="SmtpHost" class="form-control" [ngClass]="{'edited':hostSettings.email.smtpHost}"
                               [(ngModel)]="hostSettings.email.smtpHost"
                               maxlength="64">
                    </div>
                    <div class="form-group">
                        <label for="SmtpPort">{{l("SmtpPort")}}</label>
                        <input id="SmtpPort" type="number" name="SmtpPort" class="form-control"
                               [ngClass]="{'edited':hostSettings.email.smtpPort}" [(ngModel)]="hostSettings.email.smtpPort"
                               maxlength="5">
                    </div>

                    <div class="checkbox-list">
                        <div class="form-group">
                            <dx-check-box id="Settings_SmtpEnableSsl"
                                          [text]="l('UseSsl')"
                                          [(value)]="hostSettings.email.smtpEnableSsl">
                            </dx-check-box>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="SmtpDomainName">{{l("DomainName")}}</label>
                        <input id="SmtpDomainName" type="text" name="SmtpDomainName" class="form-control"
                               [ngClass]="{'edited':hostSettings.email.smtpDomain}"
                               [(ngModel)]="hostSettings.email.smtpDomain" maxlength="128">
                    </div>
                    <div class="form-group">
                        <label for="SmtpUserName">{{l("UserName")}}</label>
                        <input id="SmtpUserName" type="text" name="SmtpUserName" class="form-control"
                               [ngClass]="{'edited':hostSettings.email.smtpUserName}"
                               [(ngModel)]="hostSettings.email.smtpUserName" maxlength="128">
                    </div>
                    <div class="form-group">
                        <label for="SmtpPassword">{{l("Password")}}</label>
                        <input type="text" class="hidden-field">
                        <input type="password" class="hidden-field">
                        <input id="SmtpPassword" type="password" name="SmtpPassword" class="form-control"
                               [ngClass]="{'edited':hostSettings.email.smtpPassword}" [(ngModel)]="hostSettings.email.smtpPassword"
                               maxlength="128" autocomplete="off">
                    </div>
                    <hr />
                    <h5>{{l("TestEmailSettingsHeader")}}</h5>
                    <div class="row">
                        <div class="form-group col-md-4">
                            <input type="text" class="form-control input-mini" [(ngModel)]="testEmailAddress">
                        </div>
                        <div class="form-group col-md-2">
                            <button class="btn btn-primary" type="button" (click)="sendTestEmail()">{{l("SendTestEmail")}}</button>
                        </div>
                    </div>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('YTel')}}">
                <dx-scroll-view showScrollbar="onHover">
                    <div>
                        <div class="form-group">
                            <br />
                            <label for="YTelIsEnabled" class="m-checkbox">
                                <input id="YTelIsEnabled" type="checkbox" name="YTelIsEnabled" [(ngModel)]="yTelSettings.isEnabled">
                                {{l("YTelIsEnabled")}}
                                <span></span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="YTelUserName">{{l("YTelUserName")}}</label>
                            <input id="YTelUserName" type="text" name="YTelUserName" class="form-control" [(ngModel)]="yTelSettings.userName" maxlength="128">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="YTelPassword">{{l("YTelPassword")}}</label>
                            <input id="YTelPassword" type="text" name="YTelPassword" class="form-control" [(ngModel)]="yTelSettings.password" maxlength="128">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="YTelFrom">{{l("YTelFrom")}}</label>
                            <dx-text-box type="tel" id="YTelFrom" name="YTelFrom" class="form-control" [(ngModel)]="yTelSettings.from" maxlength="128" [mask]="masks.phone" useMaskedValue="true" maskInvalidMessage=""></dx-text-box>
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="YTelInboundSMSKey">{{l("YTelInboundSMSKey")}}</label>
                            <input id="YTelInboundSMSKey" type="text" name="YTelInboundSMSKey" class="form-control" [(ngModel)]="yTelSettings.inboundSmsKey" maxlength="128">
                        </div>
                    </div>
                    <p>
                        <span [innerHtml]="l('YTelInboundSMSHint', 'https://app.ytel.com/#/numbers')"></span><br />
                        <span class="copy-url"><b>{{getYtelInboundSMSUrl()}}</b><i class="copy save-to-clipboard" (click)="copyToClipboard($event)"></i></span><br /><br />
                    </p>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('Bugsnag')}}">
                <dx-scroll-view showScrollbar="onHover">
                    <div>
                            <div class="form-group">
                            <label for="BugsnagAppAPIKey">{{l("App Api Key")}}</label>
                            <input id="BugsnagAppAPIKey" type="text" name="BugsnagAppAPIKey" class="form-control" [(ngModel)]="hostSettings.bugsnag.appApiKey" maxlength="128">
                            </div>
                        <div class="form-group">
                            <label for="BugsnagUIAPIKey">{{l("UI Api Key")}}</label>
                            <input id="BugsnagUIAPIKey" type="text" name="BugsnagUIAPIKey" class="form-control" [(ngModel)]="hostSettings.bugsnag.uiApiKey" maxlength="128">
                        </div>
                    </div>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('PayPal')}}">
                <dx-scroll-view showScrollbar="onHover">
                    <div>
                        <div class="form-group">
                            <label for="PayPalEnvironment">{{l("PayPal environment")}}</label>
                            <input id="PayPalEnvironment" type="text" name="PayPalEnvironment" class="form-control" [(ngModel)]="payPalPaymentSettings.environment">
                        </div>
                        <div class="form-group">
                            <label for="PayPalClientId">{{l("Client ID")}}</label>
                            <input id="PayPalClientId" type="text" name="PayPalClientId" class="form-control" [(ngModel)]="payPalPaymentSettings.clientId">
                        </div>
                        <div class="form-group">
                            <label for="PayPalClientSecret">{{l("Client Secret")}}</label>
                            <input id="PayPalClientSecret" type="text" name="PayPalClientSecret" class="form-control" [(ngModel)]="payPalPaymentSettings.clientSecret">
                        </div>
                    </div>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('ACH Works')}}">
                <dx-scroll-view showScrollbar="onHover">
                    <div>
                        <div class="form-group">
                            <label for="achWorksSSS">{{l("SSS")}}</label>
                            <input id="achWorksSSS" type="text" name="achWorksSSS" class="form-control" [(ngModel)]="achWorksSettings.sss" maxlength="3">
                        </div>
                        <div class="form-group">
                            <label for="achWorksLocID">{{l("LocID")}}</label>
                            <input id="achWorksLocID" type="text" name="achWorksLocID" class="form-control" [(ngModel)]="achWorksSettings.locID" maxlength="128">
                        </div>
                        <div class="form-group">
                            <label for="achWorksSOAPUser">{{l("SOAPUser")}}</label>
                            <input id="achWorksSOAPUser" type="text" name="achWorksSOAPUser" class="form-control" [(ngModel)]="achWorksSettings.soapUser" maxlength="128">
                        </div>
                        <div class="form-group">
                            <label for="achWorksSOAPKey">{{l("SOAPKey")}}</label>
                            <input id="achWorksSOAPKey" type="text" name="achWorksSOAPKey" class="form-control" [(ngModel)]="achWorksSettings.soapKey" maxlength="128">
                        </div>
                    </div>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('Stripe')}}">
                <dx-scroll-view showScrollbar="onHover">
                    <div>
                        <div class="form-group">
                            <label for="StripeSecretKey">{{l("Secret key")}}</label>
                            <input id="StripeSecretKey" type="text" name="StripeSecretKey" class="form-control" [(ngModel)]="stripePaymentSettings.apiKey">
                        </div>
                        <p>
                            <span class="small" [innerHtml]="l('StripeSecretKeyHint')"></span>
                        </p>
                        <div class="form-group">
                            <label for="StripeWebhookSecret">{{l("Signing secret")}}</label>
                            <input id="StripeWebhookSecret" type="text" name="StripeWebhookSecret" class="form-control" [(ngModel)]="stripePaymentSettings.webhookSingingSecret">
                        </div>
                        <p>
                            <span class="small" [innerHtml]="l('StripeWebhookSecretHint1')"></span><br />
                            <span class="small">URL - <span class="copy-url"><b>{{getStripeWebhookUrl()}}</b><i class="copy save-to-clipboard" (click)="copyToClipboard($event)"></i></span></span><br />
                            <span class="small" [innerHtml]="l('StripeWebhookSecretHint2')"></span>
                        </p>
                    </div>
                </dx-scroll-view>
            </mat-tab>
            <mat-tab label="{{l('RecurlyLink')}}">
                <dx-scroll-view showScrollbar="onHover">
                    <div>
                        <div class="form-group">
                            <label for="RecurlySubdomain">{{l("RecurlySubdomain")}}</label>
                            <input id="RecurlySubdomain" type="text" name="RecurlySubdomain" class="form-control" [(ngModel)]="recurlySettings.subdomain" maxlength="128">
                        </div>
                        <div class="form-group">
                            <label for="RecurlyApiKey">{{l("RecurlyApiKey")}}</label>
                            <input id="RecurlyApiKey" type="text" name="RecurlyApiKey" class="form-control" [(ngModel)]="recurlySettings.apiKey" maxlength="128">
                        </div>
                        <div class="form-group">
                            <label for="RecurlyPrivateKey">{{l("RecurlyPrivateKey")}}</label>
                            <input id="RecurlyPrivateKey" type="text" name="RecurlyPrivateKey" class="form-control" [(ngModel)]="recurlySettings.privateKey" maxlength="128">
                        </div>
                        <div class="form-group">
                            <label for="RecurlyPageSize">{{l("RecurlyPageSize")}}</label>
                            <input id="RecurlyPageSize" type="text" name="RecurlyPageSize" class="form-control" [(ngModel)]="recurlySettings.pageSize" maxlength="128">
                        </div>
                    </div>
                </dx-scroll-view>
            </mat-tab>
        </mat-tab-group>
    </div>
</div>
