<div [@routerTransition]>
    <app-headline [config]="headlineConfig">
        <import-progress-bar></import-progress-bar>
    </app-headline>
    <div [hidden]="showPipeline" class="portlet light no-padding margin-bottom-0">
        <div class="portlet-body">
            <dx-scheduler
                height="calc(100vh - 210px)"
                [dataSource]="dataSource"
                [views]="['day', 'week', 'month', 'agenda']"
                [resources]="resources"
                [timeZone]="timezone"
                [(currentView)]="scheduleView"
                [(currentDate)]="scheduleDate"
                [showAllDayPanel]="true"
                [textExpr]="'Title'"
                [allDayExpr]="'AllDay'"
                [startDateExpr]="'StartDate'"
                [endDateExpr]="'EndDate'"
                [remoteFiltering]="false"
                [descriptionExpr]="'Description'"
                [startDateTimeZoneExpr]="'fieldTimeZone'"
                [endDateTimeZoneExpr]="'fieldTimeZone'"
                [dropDownAppointmentTemplate]="'appointmentDropDown'"
                (onContentReady)="onContentReady($event)"
                (onAppointmentUpdating)="onAppointmentUpdating($event)"
                (onAppointmentFormCreated)="onAppointmentFormCreated($event)">
                <div *dxTemplate="let appointment of 'appointmentDropDown'">
                    <div class="appointment-content">
                        <div class="appointment-badge" [ngStyle]="{ backgroundColor: appointment.Type == activityTypes.Event ? '#727bd2': '#32c9ed' }">{{appointment.Type[0]}}</div>
                        <div class="appointment-text">{{appointment.Title}}</div>
                        <div class="appointment-dates">
                            {{(getDateWithTimezone(appointment.StartDate) | date : 'MMM d') + ' , ' + (getDateWithTimezone(appointment.StartDate) | date:'shortTime') + ' - ' + (getDateWithTimezone(appointment.EndDate) | date:'shortTime')}}
                        </div>
                        <dx-button class = "delete-appointment" icon="trash" (onClick)="deleteAppointment(appointment)"></dx-button>
                    </div>
                </div>
            </dx-scheduler>

        </div>
    </div>

    <div [hidden]="!showPipeline" class="portlet light no-padding margin-bottom-0">
        <div class="portlet-body">
            <div>
                <div class="funnel-wrapper">
                    <app-pipeline
                        [dataSource]="pipelineDataSource"
                        [dragulaName]="'activityStages'"
                        [selectFields]="['Id', 'Title', 'Description', 'StartDate', 'EndDate', 'StageId']"
                        [pipelinePurposeId]="pipelinePurposeId"
                        [(selectedEntities)]="selectedEntities"
                        (onCardClick)="showActivityDialog($event)">
                        Loading...
                    </app-pipeline>
                </div>
            </div>
        </div>
    </div>

    <dx-popover target="#calendar-navigator-body"
                position="bottom"
                [(visible)]="popoverCalendarVisible">
        <div *dxTemplate="let data of 'content'">
            <dx-calendar
                [(value)]="currentDate"
                (onValueChanged) = "currentDateChange()"
                (onInitialized) = "calendarInitialized = true">
            </dx-calendar>
        </div>
    </dx-popover>
</div>
