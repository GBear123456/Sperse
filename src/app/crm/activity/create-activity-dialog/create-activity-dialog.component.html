<modal-dialog [title]="title"
              [buttons]="buttons"
              [editTitle]="true"
              [titleClearButton]="true"
              [placeholder]="ls.l('Title')"
              (onTitleKeyUp)="titleChanged($event)">
    <dx-scroll-view showScrollbar="onHover">
        <dx-context-menu
            [selectByClick]="true"
            [selectionMode]="'single'"
            [dataSource]="saveContextMenuItems"
            [position]="{ my: 'top right', at: 'bottom right' }"
            (onSelectionChanged)="onSaveOptionSelectionChanged($event)"
            target="#{{saveButtonId}}">
        </dx-context-menu>
        <app-toolbar [config]="toolbarConfig"></app-toolbar>
        <app-static-list #stagesList
                         [width]="'210px'"
                         [selectedKeys]="[data.appointment.StageId]"
                         [showConfirmation]="false"
                         [selectedItems]=""
                         [hideButtons]="true"
                         [highlightSelected]="true"
                         [targetSelector]="'[accessKey=ActivityStage]'"
                         (onItemSelected)="onStagesChanged($event)"
                         [showTitle]="false"
                         [funnelStyling]="true"
                         [list]="data.stages">
        </app-static-list>
        <crm-user-assignment-list [multiSelection]="true"
                                  [targetSelector]="'[accesskey=\'UserAssign\']'"
                                  [(selectedItemKey)]="data.appointment.AssignedUserIds"
                                  [hideButtons]="true"
                                  [selectedKeys]="[data.appointment.AssignedUserIds]"
                                  [permissionKey]="'Pages.CRM.Events.ManageAssignments'"
                                  (onSelectionChanged)="onUserAssignmentChanged($event)"
                                  [assignedUsersSelector]="getAssignedUsersSelector()">
        </crm-user-assignment-list>

        <app-static-list #leadsList
                         [width]="'330px'"
                         [height]="440"
                         [targetSelector]="'[accesskey=\'LeadsList\']'"
                         [title]="ls.l('Leads')"
                         [showConfirmation]="false"
                         [highlightSelected]="true"
                         [selectedKeys]="[data.appointment.LeadId]"
                         [searchEnabled]="true"
                         [customSearchEnabled]="true"
                         (onItemSelected)="onLeadSelected($event)"
                         (onListFiltered)="onListFiltered($event)"
                         [list]="leads">
        </app-static-list>
        <app-static-list #clientsList
                         [width]="'330px'"
                         [height]="440"
                         [targetSelector]="'[accesskey=\'ClientsList\']'"
                         [title]="ls.l('Clients')"
                         [showConfirmation]="false"
                         [highlightSelected]="true"
                         [selectedKeys]="[data.appointment.ContactId]"
                         [searchEnabled]="true"
                         [customSearchEnabled]="true"
                         (onItemSelected)="onClientSelected($event)"
                         (onListFiltered)="onListFiltered($event)"
                         [list]="clients">
        </app-static-list>
        <!--<app-static-list #ordersList-->
                         <!--[width]="'330px'"-->
                         <!--[height]="440"-->
                         <!--[targetSelector]="'[accesskey=\'OrdersList\']'"-->
                         <!--[title]="ls.l('Orders')"-->
                         <!--[showConfirmation]="false"-->
                         <!--[highlightSelected]="true"-->
                         <!--[selectedKeys]="[data.appointment.OrderId]"-->
                         <!--[searchEnabled]="true"-->
                         <!--(onItemSelected)="onOrderSelected($event)"-->
                         <!--(onListFiltered)="onListFiltered($event)"-->
                         <!--[list]="orders">-->
        <!--</app-static-list>-->

        <app-static-list [selectedKeys]="[data.appointment.SelectedStar]" [hideButtons]="true"
                        (onSelectionChanged)="onStarsChanged($event)" [bulkUpdatePermissionKey]="permissions.PagesCRMBulkUpdates"></app-static-list>

        <div class="tab-content">
            <dx-validation-group (onInitialized)="initDateValidationGroup($event)">
                <div class="field date-selector">
                    <div class="row">
                        <label class="col-12">{{ls.l('Date')}}</label>
                    </div>
                    <div class="row align-items-center">
                        <div class="col-4 align-self-center">
                            <ng-container *ngFor="let type of ['date', 'datetime']">
                                <dx-date-box #startDateRef
                                             maxLength="10"
                                             *ngIf="isAllDay ? type == 'date' : type =='datetime'"
                                             [type]="type"
                                             [max]="endDate"
                                             (onFocusIn)="openCalendar($event)"
                                             (onClosed)="removeFocusFromElement($event)"
                                             [(value)]="startDate">
                                    <dx-validator>
                                        <dxi-validation-rule type="required"
                                                             message="{{ls.l('StartDateIsRequired')}}."></dxi-validation-rule>
                                    </dx-validator>
                                </dx-date-box>
                            </ng-container>
                        </div>

                        <div class="col-1 align-self-center">
                            <i class="fa fa-arrow-right"></i>
                        </div>

                        <div class="col-4 align-self-center">
                            <ng-container *ngFor="let type of ['date', 'datetime']">
                                <dx-date-box #endDateRef
                                             *ngIf="isAllDay ? type == 'date' : type =='datetime'"
                                             maxLength="10"
                                             [type]="type"
                                             [min]="startDate"
                                             (onFocusIn)="openCalendar($event)"
                                             (onClosed)="removeFocusFromElement($event)"
                                             [(value)]="endDate">
                                    <dx-validator>
                                        <dxi-validation-rule type="required"
                                                             message="{{ls.l('EndDateIsRequired')}}."></dxi-validation-rule>
                                    </dx-validator>
                                </dx-date-box>
                            </ng-container>
                        </div>

                        <div class="col-3 align-self-center text-right">
                            <div class="dx-field all-day-checkbox">
                                <div class="dx-field-label">{{ls.l('All day')}}</div>
                                <div class="dx-field-value">
                                    <dx-check-box [(value)]="isAllDay"></dx-check-box>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </dx-validation-group>
            <div class="field description">
                <div class="row">
                    <label class="col-12">{{ls.l('Description')}}</label>
                </div>

                <div class="row">
                    <div class="col-12">
                        <dx-text-area name="description"
                                      [width]="'100%'"
                                      [height]="'100px'"
                                      [(value)]="data.appointment.Description">
                        </dx-text-area>
                    </div>
                </div>
            </div>
        </div>
    </dx-scroll-view>
</modal-dialog>
