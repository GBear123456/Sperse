<modal-dialog [title]=""
              [titleClearButton]="false"
              [buttons]="buttons"
              [editTitle]="false"
              (onContextItemChanged)="save()">
    <ng-container headerContent>        
        <div class="header">
            <div class="header-div">
                <div class="email-container">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="blue" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M10 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-8l-2-2z" />
                        </svg>
                    </span>
                    <span class="email-sub-txt"> New Email</span>
                </div>
                <div class="header-content">
                    Spring Sale - 20% Off, All Customers
                </div>
            </div>
            <div class="right">
                <div class="actions">
                    <span class="tab new-email" (click)="showTabs('new-email')"
                        [class.selected-tab]="selectedTab === 'new-email'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="#003366" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="4" width="20" height="16" rx="2" ry="2" fill="none" stroke="#003366"></rect>
                            <path d="M22 6l-10 7L2 6" fill="none" stroke="#003366"></path>
                        </svg>
                        New Email
                    </span>
                    <span class="tab html-editor" (click)="showTabs('html-editor')"
                        [class.selected-tab]="selectedTab === 'html-editor'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="#5A6782" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 20h9" />
                            <path d="M16.5 3.5l4 4L7 21H3v-4L16.5 3.5z" />
                        </svg>

                        HTML Editor
                    </span>
                    <span class="tab templates" (click)="showTabs('template')"
                        [class.selected-tab]="selectedTab === 'template'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="#5A6782" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="7" height="7" rx="1" />
                            <rect x="14" y="3" width="7" height="7" rx="1" />
                            <rect x="3" y="14" width="7" height="7" rx="1" />
                            <rect x="14" y="14" width="7" height="7" rx="1" />
                        </svg>
                        Templates
                    </span>
                </div>
            </div>
        </div>
        <!-- <dx-select-box #templateSelector
            name="template"
            width="380px"
            height="40px"
            displayExpr="name"
            valueExpr="id"
            [placeholder]="ls.l(data.addMode ? 'TemplateName' : 'SelectTemplate')"
            [disabled]="templateEditMode && isManageUnallowed || onTemplateCreate.observers.length && !(data.contact || data.contactIds)"
            [value]="data.templateId"
            [showClearButton]="!data.addMode && templateEditMode"
            [dataSource]="templates$ | async"
            [acceptCustomValue]="templateEditMode && !isManageUnallowed"
            [openOnFieldClick]="!data.addMode"
            [showDropDownButton]="!data.addMode"
            itemTemplate="itemTemplate"
            (onOptionChanged)="onTemplateOptionChanged($event)"
            (onCustomItemCreating)="onNewTemplate($event)"
            (onValueChanged)="onTemplateChanged($event)">
            <dx-validator (onInitialized)="extendDefaultValidator($event)">
                <dxi-validation-rule type="required" [message]="ls.l('RequiredField', ls.l('Template'))"></dxi-validation-rule>
            </dx-validator>
            <div *dxTemplate="let item of 'itemTemplate'" class="email-templates-select-box">
                {{ item.name }}
                <i *ngIf="!isManageUnallowed" class="delete fa fa-times" [title]="ls.l('DeleteTemplate')" (click)="deleteTemplate($event, item, templateSelector)"></i>
            </div>
        </dx-select-box> -->
        <div class="buttons" *ngIf="!data.addMode && !isManageUnallowed && data.contact && onTemplateCreate.observers.length">
            <i class="create-template" [title]="ls.l('CreateTemplate')" (click)="createTemplate()"></i>
            <i *ngIf="data.templateId" [title]="ls.l('EditTemplate')" class="edit-template fa fa-pencil" (click)="editTemplate(data)"></i>
        </div>
    </ng-container>
    <div class="form-content">
        <div class="d-flex">
            <dx-scroll-view showScrollbar="onHover" #scrollView>
                <dx-validation-group>
                    <div class="row row-body-space" *ngIf="showNewEmailTab">

                        <div class="field-area from row--subdiv">
                            <div class="w-48">
                                <label class="caption"
                                    [ngClass]="{disabled: templateEditMode}">{{ls.l('From')}}:</label>
                                <dx-select-box *ngIf="fromDataSource?.length || templateEditMode; else configure"
                                    name="from"
                                    height="40px"
                                    placeholder=""
                                    [(value)]="data.emailSettingsSource"
                                    valueExpr="emailSettingsSource" 
                                    displayExpr="emailAddress"
                                    [dataSource]="fromDataSource" 
                                    itemTemplate="itemTemplate"
                                    fieldTemplate="fieldTemplate" 
                                    [disabled]="templateEditMode"
                                    (onValueChanged)="onFromChanged($event)">
                                    <div *dxTemplate="let item of 'itemTemplate'" class="from-item-select-box" [title]="item?.emailAddress">
                                        {{ item?.emailAddress }}
                                    </div>
                                    <div *dxTemplate="let item of 'fieldTemplate'" class="from-field-select-box">
                                        <dx-text-box 
                                            height="40px" 
                                            [readOnly]="true" 
                                            [value]="item?.emailAddress"
                                            [hint]="item?.emailAddress">
                                        </dx-text-box>
                                    </div>
                                    <dx-validator>
                                        <dxi-validation-rule 
                                            type="required"
                                            [message]="ls.l('MailerSettingsAreNotConfigured', ls.l('SMTP'))">
                                        </dxi-validation-rule>
                                    </dx-validator>
                                </dx-select-box>
                                <ng-template #configure>
                                    <a class="config-link" (click)="close()" [routerLink]="'app/admin/settings'"
                                        [queryParams]="{tab: 'smtp'}" [ngClass]="{disabled: !isSettingsAllowed}">
                                        {{ls.l('MailerSettingsAreNotConfigured',ls.l('SMTP'))}}&nbsp;
                                    </a>
                                </ng-template>
                            </div>
                            <div class="w-48">
                                <label class="caption disabled">{{ls.l('ReplyTo')}}:</label>
                                <dx-tag-box #ReplyToElement 
                                    name="replyTo" 
                                    noDataText="" 
                                    placeholder=""
                                    [multiline]="false" 
                                    [acceptCustomValue]="true" 
                                    [(value)]="data.replyTo"
                                    [disabled]="true" 
                                    (onKeyUp)="onKeyUp($event)"
                                    (onInitialized)="onTagBoxInitialized($event)"
                                    (onFocusOut)="emailInputFocusOut($event)"
                                    (onCustomItemCreating)="onCustomItemCreating($event)">
                                    <dx-validator>
                                        <dxi-validation-rule type="custom"
                                            [message]="ls.l('InvalidField', ls.l('ReplyTo'))"
                                            [validationCallback]="validateEmailList(ReplyToElement)">
                                        </dxi-validation-rule>
                                    </dx-validator>
                                </dx-tag-box>
                            </div>
                        </div>

                        <div class="field-area">
                            <label class="caption" [ngClass]="{disabled: templateEditMode}">{{ls.l('To')}}:</label>
                            <dx-tag-box #ToElement 
                                name="to" 
                                width="calc(100% - 31px)" 
                                noDataText="" 
                                placeholder=""
                                [dataSource]="data.suggestionEmails" 
                                [multiline]="false" 
                                [acceptCustomValue]="true"
                                [(value)]="data.to" 
                                [disabled]="templateEditMode" 
                                (onKeyUp)="onKeyUp($event)"
                                (onInitialized)="onTagBoxInitialized($event)" 
                                (onFocusOut)="emailInputFocusOut($event)"
                                (onCustomItemCreating)="onCustomItemCreating($event)">
                                <dx-validator>
                                    <dxi-validation-rule type="custom" 
                                        [message]="ls.l('InvalidField', ls.l('To'))" 
                                        [validationCallback]="validateEmailList(ToElement)">
                                    </dxi-validation-rule>
                                    <dxi-validation-rule type="required"
                                        [message]="ls.l('RequiredField', ls.l('To'))"></dxi-validation-rule>
                                </dx-validator>
                            </dx-tag-box>
                            <div class="bcc-links">
                                <span (click)="showInputField(CCElement, 'showCC')" [ngClass]="{disabled: showCC}">{{ls.l('CC')}}</span>
                                <span (click)="showInputField(BCCElement, 'showBCC')" [ngClass]="{disabled: showBCC}">{{ls.l('BCC')}}</span>
                            </div>
                        </div>

                        <div class="field-area from row--subdiv">
                            <div class="w-48" [hidden]="!showCC">
                                <label class="caption">{{ls.l('CC')}}:</label>
                                <dx-tag-box #CCElement 
                                    name="cc" 
                                    width="calc(100% - 35px)" 
                                    placeholder="" 
                                    noDataText=""
                                    [multiline]="false" 
                                    [acceptCustomValue]="true" 
                                    [(value)]="data.cc"
                                    (onKeyUp)="onKeyUp($event)" 
                                    (onInitialized)="onTagBoxInitialized($event)"
                                    (onFocusOut)="emailInputFocusOut($event, true)"
                                    (onCustomItemCreating)="onCustomItemCreating($event)">
                                    <dx-validator>
                                        <dxi-validation-rule type="custom" 
                                            [message]="ls.l('InvalidField', ls.l('CC'))"
                                            [validationCallback]="validateEmailList(CCElement)">
                                        </dxi-validation-rule>
                                    </dx-validator>
                                </dx-tag-box>
                            </div>

                            <div class="w-48" [hidden]="!showBCC">
                                <label class="caption">{{ls.l('BCC')}}:</label>
                                <dx-tag-box #BCCElement 
                                    name="bcc" 
                                    width="calc(100% - 46px)" 
                                    noDataText=""
                                    placeholder="" 
                                    [multiline]="false" 
                                    [acceptCustomValue]="true" 
                                    [(value)]="data.bcc"
                                    (onKeyUp)="onKeyUp($event)" 
                                    (onInitialized)="onTagBoxInitialized($event)"
                                    (onFocusOut)="emailInputFocusOut($event, true)"
                                    (onCustomItemCreating)="onCustomItemCreating($event)">
                                    <dx-validator>
                                        <dxi-validation-rule type="custom" 
                                            [message]="ls.l('InvalidField', ls.l('BCC'))"
                                            [validationCallback]="validateEmailList(BCCElement)">
                                        </dxi-validation-rule>
                                    </dx-validator>
                                </dx-tag-box>
                            </div>
                        </div>

                        <div class="field-area from row--subdiv">
                            <div class="w-48  preview-text">
                                <label class="caption">{{ls.l('Subject')}}:</label>
                                <dx-text-box 
                                    name="subject" 
                                    width="calc(100% - 69px)" 
                                    height="40px" 
                                    placeholder=""
                                    [(value)]="data.subject">
                                    <dx-validator>
                                        <dxi-validation-rule type="required" [message]="ls.l('RequiredField', ls.l('Subject'))"></dxi-validation-rule>
                                    </dx-validator>
                                </dx-text-box>
                            </div>

                            <div class="w-48 preview-text">
                                <label class="caption">{{ls.l('PreviewText')}}:</label>
                                <dx-text-box 
                                    name="previewText" 
                                    width="calc(100% - 102px)" 
                                    height="40px" 
                                    placeholder=""
                                    [(value)]="data.previewText">
                                </dx-text-box>
                            </div>
                        </div>

                        <div class="field-area ckeditor bt-none">
                            <ckeditor *ngIf="ckConfig.height && templateLoaded" [config]="ckConfig" [(data)]="data.body"
                                (ready)="onCKReady($event)" (change)="updateDataLength()"></ckeditor>

                        </div>

                        <div class="attachment-div" style="margin-top: 5px;">
                            <div class="attachment-field-area">
                                <ngx-file-drop accept="*.*" (onFileDrop)="addAttachments($event)">
                                    <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
                                        <a href="javascript:void(0);" class="attach-link" (click)="openDocuments()">
                                            <img src="assets/common/icons/attach.svg">{{ ls.l('Add attachment') }}
                                        </a>
                                        <dx-check-box *ngIf="!templateEditMode && attachments && attachments.length"
                                            class="saveToDocs" [(value)]="data.saveAttachmentsToDocuments"
                                            [rtlEnabled]="true" [text]="ls.l('Save to Documents')">
                                        </dx-check-box>
                                    </ng-template>
                                </ngx-file-drop>
                            </div>
                            <div class="attachment-field-area bottom-text-ste">Insert Widget</div>
                            <div class="attachment-field-area bottom-text-ste">
                                {{ charCount }}
                            </div>
                        </div>

                        <div class="field-area attachments">
                            <div *ngFor="let attachment of attachments; let i = index" class="attachment"
                                [ngClass]="{'progress': !!attachment.loader}"
                                [ngStyle]="{'background-size': (attachment.progress || 0) + '%'}">
                                <a target="_blank" [download]="attachment.name" [href]="attachment.url"
                                    (click)="attachmentClick($event, attachment)"
                                    class="name">{{attachment.name}}</a>&nbsp;<span class="size">
                                    ({{attachment.size |filesize}})
                                </span><i (click)="removeAttachment(attachment, i)" aria-hidden="true"
                                    class="delete fa fa-times"></i>
                            </div>
                        </div>

                        <ng-content *ngIf="data.templateType" select="[templateSettings]"></ng-content>
                    </div>
                    <div class="row w-71" *ngIf="showHtmlEditor">
                        <span class="settings-icon"></span>
                        <textarea class="source-editor" [(ngModel)]="data.body" (input)="updateEditor()"></textarea>
                    </div>
                    <div class="row w-71" *ngIf="showTemplate">
                    </div>
                </dx-validation-group>
            </dx-scroll-view>
            <dx-scroll-view showScrollbar="onHover" #scrollAIView>
                <div class="container">
                    <div class="prompt-header d-flex justify-content-between align-items-center"
                        style="margin-bottom: 20px;">
                        <h5 class="your-prompt-title">Prompt</h5>
                        <h5 class="your-prompt-title prompt-library-title "> Prompt Library
                            <img class="img" src="./assets/common/icons/down-arrow.png" />
                        </h5>
                    </div>
                    <div class="content-container mb-19" *ngIf="!showAIOption">
                        <div contenteditable="true" dir="ltr" lang="en" autocomplete="off" autocorrect="off"
                            autocapitalize="off" spellcheck="false" (input)="onContentChange($event)"
                            (paste)="onPaste($event)" #contentEditableDiv>
                            <p>
                                Consectetur adipiscing elit, <strong>sed do eiusmod</strong> tempor incididunt
                                ut
                                labore
                                et dolore.
                            </p>
                            <ul class="styled-list">
                                <li>
                                    <strong>Customer Name and Business:</strong>
                                    <div class="list-content">Adam Smith, <br> Samsung International LLC</div>
                                </li>
                                <li>
                                    <strong>Purpose of the email:</strong>
                                    <div class="list-content">
                                        voluptatem accusantium doloremque laudantium, totam
                                        rem
                                        aperiam
                                    </div>
                                </li>
                                <li>
                                    <strong>Prior communications:</strong>
                                    <div class="list-content">
                                        Ab illo inventore veritatis et quasi architecto beatae
                                        vitae dicta sunt explicabo.
                                    </div>
                                </li>
                                <li>
                                    <strong>Tone of the email:</strong>
                                    <div class="list-content">
                                        Nemo enim ipsam voluptatem quia voluptas sit
                                        aspernatur
                                        aut odit aut fugit
                                    </div>
                                </li>
                                <li>
                                    <strong>Styling Preferences:</strong>
                                    <div class="list-content">
                                        Sed quia consequuntur magni dolores eos qui ratione
                                        voluptatem sequi nesciunt.
                                    </div>
                                </li>
                                <li>
                                    <strong>Specific details to include:</strong>
                                    <div class="list-content">
                                        Neque porro quisquam est, qui dolorem ipsum quia dolor
                                        sit
                                        amet, consectetur.
                                    </div>
                                </li>
                            </ul>
                            <div>
                                <strong>The email must include:</strong>
                                <div>1. Numquam eius modi tempora incidunt</div>
                                <div>2. Labore et dolore magnam aliquam</div>
                                <div>3. Ut enim ad minima veniam, quis nostrum.</div>
                            </div>
                        </div>
                        <div class="action-buttons d-flex  ">
                            <div class="left-buttons">
                                <button class="post-btn btn-primary button-layout button-primary ng-star-inserted"
                                    (click)="getChatGptResponse(contentEditableDiv)">
                                    {{processing ? 'Posting..' :'Post'}}
                                </button>
                                <button class="cancel-btn btn-secondary button-layout button-default ng-star-inserted">
                                    Cancel
                                </button>
                            </div>
                            <div class="right-buttons ml-auto">
                                <button
                                    class="select-model-btn btn-secondary button-layout button-default ng-star-inserted"
                                    (click)="openAIOptionDiv()">
                                    Select AI Model
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="content-container ai-content-container" *ngIf="showAIOption">
                        <div class="search-field-wrapper">
                            <div class="search-icon-wrapper">
                                <i class="fa fa-search" aria-hidden="true"></i>
                            </div>
                            <input type="text" placeholder="Search Models" class="search-box"
                                (input)="filterItems($event)" />
                        </div>
                        <div class="list-container">
                            <div *ngFor="let item of filteredItems" class="list-item"
                                [class.selected]="item.id === selectedItemId" [class.disabled]="!item.enabled"
                                (click)="selectItem(item)">
                                <div class="model-item">  
                                    <img class="img" src="./assets/common/icons/{{item.icon}}" class="model-icon" /> 
                                    <span class="llm-text"><strong>{{ item.name }}</strong></span>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="temperature-slider pt-2">
                            <label for="temperature" class="temperature-label">Temperature</label>
                            <input type="range" id="temperature" class="temperature-range" min="0" max="1" step="0.1">
                            <div class="temperature-labels">
                                <span class="temperature-label-left">Reserved</span>
                                <span class="temperature-label-right">Creative</span>
                            </div>
                        </div> 
                        <div class="action-buttons d-flex">
                            <div class="left-buttons">
                                <button class="post-btn btn-primary button-layout button-primary ng-star-inserted">
                                    Save
                                </button>
                            </div>
                            <div class="right-buttons ml-auto">
                                <button class="cancel-btn btn-secondary button-layout button-default ng-star-inserted"
                                    (click)="closeAIOptionDiv()">
                                    Cancel
                                </button>
                            </div>
                        </div> -->
                    </div>
                </div> 
                <!-- <div class="content-container" *ngIf="showAIOption">
                        <div>
                            <div class="search-field-wrapper">
                                <div class="search-icon-wrapper">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </div>
                                <input type="text" placeholder="Search Models..." class="search-box"
                                    (input)="filterItems($event)" />
                            </div>

                            <div class="list-container">
                                <div *ngFor="let item of filteredItems" class="list-item"
                                    [class.selected]="item.id === selectedItemId" [class.disabled]="!item.enabled"
                                    (click)="selectItem(item)">
                                    <div class="model-item">
                                        <span [innerHTML]="getSanitizedIcon(item.icon)" class="model-icon"></span>
                                        <span><strong>{{ item.name }}</strong></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="temperature-slider pt-2">
                            <label for="temperature" class="temperature-label">Temperature</label>
                            <input type="range" id="temperature" class="temperature-range" min="0" max="1" step="0.1">
                            <div class="temperature-labels">
                                <span class="temperature-label-left">Reserved</span>
                                <span class="temperature-label-right">Creative</span>
                            </div>
                        </div>

                        <div class="action-buttons d-flex pt-2">
                            <button class="post-btn btn-primary button-layout button-primary ng-star-inserted">
                                Save
                            </button>
                            <button class="cancel-btn btn-secondary button-layout button-default ng-star-inserted"
                                (click)="closeAIOptionDiv()">
                                Cancel
                            </button>
                        </div>

                    </div> -->
                <!-- </div> -->
            </dx-scroll-view> 
        </div> 
        <div class="bank-decode-wrapper" *ngIf="!templateEditMode && bankCodeEnabled">
            <bank-code-decode [content]="data.body" [source]="'CRMEmail'" (onDecodeStart)="startLoading()"
                (onDecodeFinish)="finishLoading()"></bank-code-decode>
        </div> 
    </div>
</modal-dialog>

 <!-- <div style="display: flex; align-items: center;"> -->
        <!-- <span #tagsButton [class]="'tags-button id' + uniqId" *ngIf="tagsList.length"
                        style="padding-left: 15px;">
                        <a (click)="tagsTooltipVisible = true">Tags</a>
                    </span>
                    <dx-tooltip [width]="250" position="bottom" [(visible)]="tagsTooltipVisible"
                        [target]="'.tags-button.id' + uniqId">
                        <div *dxTemplate="let data of 'content'" class="tags-container">
                            <p class="tags-note">{{ls.l('EmailTemplate_SupportedTags')}}</p>
                            <dx-list height="calc(100% - 40px)" [selectionMode]="'single'" [dataSource]="tagsList"
                                [itemTemplate]="'tagTemplate'" (onItemClick)="onTagClick($event)">
                                <div *dxTemplate="let data of 'tagTemplate'" class="tags-list-item"
                                    [ngClass]="{disabled: !templateEditMode && !getTagValue(data)}">
                                    {{ getTagText(data) }}
                                </div>
                            </dx-list>
                        </div>
                    </dx-tooltip> -->
        <!-- </div> -->