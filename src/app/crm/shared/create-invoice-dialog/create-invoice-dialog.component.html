<dx-context-menu
    [selectByClick]="true"
    [selectionMode]="'single'"
    [dataSource]="saveContextMenuItems"
    [position]="{ my: 'top right', at: 'bottom right' }"
    (onSelectionChanged)="onSaveOptionSelectionChanged($event)"
    target="#{{saveButtonId}}">
</dx-context-menu>

<app-modal-dialog>
    <ng-container headerContent>    
        <label>#</label>
        <dx-text-box
            width="160px"
            name="invoiceNo"
            [placeholder]="l('INV-XXXX-XX')"
            [(value)]="invoiceNo"
            [showClearButton]="true"
            [readOnly]="false">
        </dx-text-box>
        <dx-select-box
            name="currency"
            width="125px"   
            height="40px"                 
            displayExpr="name"
            valueExpr="code"
            [placeholder]="l('Currency')"
            [(value)]="currency"
            [dataSource]="currencies"
            (onValueChanged)="linesComponent.instance.repaint()">
        </dx-select-box>        
        <span>{{ status | uppercase }}</span>
    </ng-container>

    <div class="form-content">
        <dx-scroll-view showScrollbar="onHover">
            <div class="row">
                <div class="col-sm-8">
                    <div class="field description">
                        <dx-text-area
                            name="description"
                            width="500px"
                            height="85px"
                            [placeholder]="l('Add a description to this invoice')"
                            [disabled]="disabledForUpdate"
                            [(value)]="description">
                        </dx-text-area>
                    </div>
                    <div class="field">
                        <label class="from-label">{{l('From')}}<a><i class="edit fa fa-pencil"></i>{{l('Edit Profile')}}</a></label>
                        <div class="credentials">
                            <span>{{billingSettings?.legalName}} {{billingSettings?.taxVatNo}}</span>
                            <span>{{billingSettings?.address}}</span>
                        </div>
                    </div>
                    <div class="field">
                        <label class="customer-label">{{l('To')}}<a>+ {{l('New Client')}}</a></label>
                        <dx-select-box #contact
                            name="customer"
                            width="500px"     
                            displayExpr="name"
                            valueExpr="name"
                            [disabled]="data.invoice"
                            [acceptCustomValue]="true"
                            [placeholder]="l('Enter Client Details')"
                            [(value)]="customer"
                            [dataSource]="customers"
                            [searchEnabled]="true"
                            [searchTimeout]="0"
                            (onFocusIn)="onFieldFocus($event)"
                            (onSelectionChanged)="selectContact($event)"
                            (onInput)="customerLookupItems($event)">
                        </dx-select-box>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="field">
                        <div class="logo-container"><a>+ Add Logo</a></div>
                    </div>
                    <div class="field">
                        <dx-date-box
                            placeholder="{{l('Date')}}"
                            [min]="currentDate"
                            [disabled]="disabledForUpdate"
                            [width]="'260px'"
                            [(value)]="date">
                        </dx-date-box>
                    </div>
                    <div class="field">
                        <dx-date-box
                            [min]="currentDate"
                            placeholder="{{l('Due on Receipt')}}"
                            [disabled]="disabledForUpdate"
                            [width]="'260px'"
                            [(value)]="dueDate">
                        </dx-date-box>
                    </div>
                    <div class="field">
                        <dx-text-box
                            maxLength="10"
                            placeholder="{{l('Purchase Order Number')}}"
                            [disabled]="disabledForUpdate"
                            [width]="'260px'"
                            [value]="data.orderId">
                        </dx-text-box>
                    </div>
                </div>
            </div>
            <div class="field lines">
                <dx-data-grid
                    width="810px"
                    height="100%"
                    [disabled]="disabledForUpdate"
                    [(dataSource)]="lines"
                    [allowColumnReordering]="false"
                    [columnAutoWidth]="true"
                    [focusStateEnabled]="true"
                    [showColumnLines]="false"
                    [allowColumnResizing]="false">

                    <dxi-column dataField="Description" width="400px" caption="{{l('Description')}}" [allowSorting]="false" cellTemplate="description"></dxi-column>
                    <dxi-column dataField="Quantity" width="100px" caption="{{l('Quantity')}}" [allowSorting]="false" cellTemplate="quantity"></dxi-column>
                    <dxi-column dataField="Rate" width="100px" caption="{{l('Rate')}}" [allowSorting]="false" cellTemplate="rate"></dxi-column>
                    <dxi-column dataField="Amount" caption="{{l('Amount')}}" [allowSorting]="false" [allowEditing]="false" [calculateCellValue]="calculateLineAmount" cellTemplate="amount"></dxi-column>

                    <div *dxTemplate="let cellData of 'description'">
                        <dx-text-box
                            width="400px"
                            placeholder=""
                            dataType="string" 
                            [value]="cellData.value"
                            (onValueChanged)="onValueChanged($event, cellData)">
                        </dx-text-box>
                    </div>
                    <div *dxTemplate="let cellData of 'quantity'">
                        <dx-text-box
                            width="100px"
                            placeholder=""
                            dataType="number" 
                            [value]="cellData.value"
                            (onValueChanged)="onValueChanged($event, cellData)">
                        </dx-text-box>
                    </div>
                    <div *dxTemplate="let cellData of 'rate'">
                        <dx-text-box
                            width="100px"
                            placeholder=""
                            dataType="number" 
                            value="{{cellData.value | currency: currency}}"
                            (onValueChanged)="onValueChanged($event, cellData)">
                        </dx-text-box>
                    </div>  
                    <div *dxTemplate="let cellData of 'amount'">
                        <dx-text-box
                            width="100px"
                            placeholder=""
                            dataType="number" 
                            [readOnly]="true"
                            value="{{cellData.value | currency: currency}}">
                        </dx-text-box>
                    </div>  
                </dx-data-grid>
            </div>
        </dx-scroll-view>
        <div class="row bottom-container">
            <div class="col-sm-6">
                <div class="field notes">
                    <label class="notes-label">{{l('Invoice Note')}} <a (click)="resetNoteDefault()">({{l('default')}} {{l('note')}})</a></label>
                    <dx-text-area
                        name="comment"
                        [disabled]="disabledForUpdate"
                        [width]="'380px'"
                        [height]="'100px'"
                        [(value)]="notes">
                    </dx-text-area>
                </div>
            </div>
            <div class="col-sm-6 conclusion">
                <div class="sub-total"><span>{{l('Sub Total')}}</span><span>{{subTotal | currency: currency}}</span></div>
                <div class="total"><span>{{l('Total')}} ({{currency}})</span><a>{{l('Manage Default Taxes')}}</a><span>{{total | currency: currency}}</span></div>
                <div class="balance"><span>{{l('Balance')}} ({{currency}})</span><span>{{balance | currency: currency}}</span></div>
            </div>
        </div>
    </div>
</app-modal-dialog>