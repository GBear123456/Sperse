<h2 *ngIf="!data.viewMode" mat-dialog-title (mousedown)="mouseDown($event)">{{ls.l('Update Address')}}</h2>
<dx-scroll-view showScrollbar="always">
    <mat-dialog-content>
        <dx-validation-group (onInitialized)="initValidationGroup($event)">
            <div>
                <label>{{ls.l('Company')}}</label>
                <dx-select-box
                    name="company"
                    maxLength="50"
                    [placeholder]="!data.viewMode ? ls.l('EditValuePlaceholder') : ''"
                    displayExpr="name"
                    valueExpr="name"
                    [(value)]="data.company"
                    [acceptCustomValue]="true"
                    [dataSource]="organizations"
                    [disabled]="data.viewMode"
                    (onCustomItemCreating)="onCustomItemCreating($event, 'name')"
                    (onFocusIn)="onFieldFocus($event)">
                </dx-select-box>
            </div>
            <div>
                <label>{{ls.l('FirstName')}}</label>
                <dx-text-box
                    name="firstName"
                    maxLength="50"
                    [disabled]="data.viewMode"
                    [(value)]="data.firstName">
                </dx-text-box>
            </div>
            <div>
                <label>{{ls.l('LastName')}}</label>
                <dx-text-box
                    name="lastName"
                    maxLength="50"
                    [disabled]="data.viewMode"
                    [(value)]="data.lastName">
                </dx-text-box>
            </div>
            <div>
                <label>{{ls.l('Email')}}</label>
                <dx-select-box
                    name="email"
                    maxLength="50"
                    [placeholder]="!data.viewMode ? ls.l('EditValuePlaceholder') : ''"
                    displayExpr="emailAddress"
                    valueExpr="emailAddress"
                    [(value)]="data.email"
                    [acceptCustomValue]="true"
                    [disabled]="data.viewMode"
                    [dataSource]="contactDetails.emails"
                    (onCustomItemCreating)="onCustomItemCreating($event, 'emailAddress')"
                    (onFocusIn)="onFieldFocus($event)">
                    <dx-validator>
                        <dxi-validation-rule type="pattern" [pattern]="emailRegEx" message="{{ls.l('EmailIsNotValid')}}."></dxi-validation-rule>
                    </dx-validator>
                </dx-select-box>
            </div>
            <div class="phone-container">
                <label>{{ls.l('Phone')}}</label>
                <country-phone-number #phoneComponent id="togglePhone"
                    [phoneNumber]="data.phone"
                    [disabled]="data.viewMode"
                    [required]="false"
                    (phoneNumberChange)="onPhoneNumberChange($event, phoneComponent)">
                </country-phone-number>
                <dx-tooltip #phoneTooltip
                    width="200px"
                    position="right"
                    target="#togglePhone"
                    [disabled]="data.viewMode"
                    showEvent="dxclick"
                    hideEvent="dxoverend">
                    <div *dxTemplate="let data of 'content'">
                        <dx-list
                            [dataSource]="phones"
                            (onItemClick)="selectPhoneNumber($event, phoneTooltip, phoneComponent)">
                        </dx-list>
                    </div>
                </dx-tooltip>
            </div>
            <div>
                <label>{{ls.l('Address')}}</label>
                <input *ngIf="!googleAutoComplete"
                       id="toggleAddress"
                       type="text"
                       name="Address"
                       placeholder=""
                       [disabled]="data.viewMode"
                       [(ngModel)]="address"
                       class="dx-texteditor-input"/>
                <input #addressInput
                       *ngIf="googleAutoComplete"
                       id="toggleAddress"
                       type="text"
                       name="Address"
                       placeholder=""
                       [ngModel]="address"
                       class="dx-texteditor-input"
                       [disabled]="data.viewMode"
                       (street_number)='data.streetNumber=$event'
                       (street)='data.address1=$event'
                       (postal_code)='data.zip=$event'
                       (setAddress)="onAddressChanged($event)"
                       angularGooglePlace/>
                <dx-tooltip #addressTooltip
                    width="300px"
                    position="right"
                    target="#toggleAddress"
                    showEvent="dxclick"
                    [disabled]="data.viewMode"
                    hideEvent="dxoverend">
                    <div *dxTemplate="let data of 'content'">
                        <dx-list
                            [dataSource]="addresses"
                            itemTemplate="addressType"
                            (onItemClick)="onAddressSelected($event, addressTooltip)">
                            <div *dxTemplate="let data of 'addressType'" class="address-template">
                                 <i class="address-icons type-{{data.usageTypeId || 'H'}}"></i><span>{{data.text}}</span>
                            </div>
                        </dx-list>
                    </div>
                </dx-tooltip>
            </div>
            <div>
                <label>{{ls.l('Country')}}</label>
                <dx-select-box
                    name="country"
                    [dataSource]="countries"
                    displayExpr="name"
                    valueExpr="code"
                    [disabled]="data.viewMode"
                    [searchEnabled]="true"
                    [(value)]="data.countryId"
                    fieldTemplate="field"
                    (onValueChanged)="onCountryChange($event)">
                    <div *dxTemplate="let data of 'field'">
                        <div class="custom-item">
                            <dx-text-box class="state"
                                         [value]="data?.name"
                                         [readOnly]="true">
                            </dx-text-box>
                        </div>
                    </div>
                </dx-select-box>
            </div>

            <div>
                <label>{{ls.l('State')}}</label>
                <dx-select-box
                    [acceptCustomValue]="true"
                    [dataSource]="getCountryStates() | async"
                    displayExpr="name"
                    valueExpr="name"
                    [disabled]="data.viewMode"
                    name="state"
                    [searchEnabled]="true"
                    [(value)]="data.stateName"
                    fieldTemplate="field"
                    (onCustomItemCreating)="onCustomStateCreate($event)">
                    <div *dxTemplate="let data of 'field'">
                        <div class="custom-item">
                            <dx-text-box class="state" [value]="data?.name"></dx-text-box>
                        </div>
                    </div>
                </dx-select-box>
            </div>

            <div>
                <label>{{ls.l('City')}}</label>
                <dx-text-box
                    name="city"
                    maxLength="50"
                    [disabled]="data.viewMode"
                    [(value)]="data.city">
                    <dx-validator>
                        <dxi-validation-rule type="required" [message]="ls.l('RequiredField', ls.l('City'))"></dxi-validation-rule>
                    </dx-validator>
                </dx-text-box>
            </div>

            <div>
                <label>{{ls.l('ZipCode')}}</label>
                <dx-text-box
                    name="zip"
                    maxLength="10"
                    [disabled]="data.viewMode"
                    [(value)]="data.zip">
                </dx-text-box>
            </div>
        </dx-validation-group>
    </mat-dialog-content>
</dx-scroll-view>
<mat-dialog-actions *ngIf="!data.viewMode">
    <button mat-button mat-dialog-close class="button-layout button-default">{{ls.l('Cancel')}}</button>
    <button mat-button class="button-layout button-primary" (click)="onSave(phoneComponent)">{{ls.l('Update')}}</button>
</mat-dialog-actions>
