<modal-dialog
    [title]=""
    [titleClearButton]="false"
    [buttons]="buttons"
    [editTitle]="false"
    class="mail-template-modal"
>
    <ng-container headerContent>
        <div class="header">
            <div class="header-div">
                <div class="email-container">
                    <span class="icon">
                        <img src="assets/common/icons/group.png" />
                    </span>
                    <span class="email-sub-txt"> {{ ls.l(modalTitle) }}</span>
                </div>
            </div>
        </div>
    </ng-container>
    <div class="form-content row">
        <dx-validation-group
            [class.col-md-9]="showAIPrompt"
            [class.col-md-12]="!showAIPrompt"
            style="padding-left: 25px"
        >
            <div class="field-area subject">
                <label class="caption">{{ ls.l("Template Name") }}:</label>
                <dx-text-box
                    name="title"
                    placeholder=""
                    [(value)]="data.title"
                    validationGroup="templateValidation"
                    width="100%"
                    (onFocusIn)="onFieldFocusImproved('title', $event)"
                    (onFocusOut)="onFieldBlur('title', $event)"
                >
                    <dx-validator>
                        <dxi-validation-rule
                            type="required"
                            [message]="ls.l('RequiredField', ls.l('title'))"
                        ></dxi-validation-rule>
                    </dx-validator>
                </dx-text-box>
            </div>

            <div class="field-area subject">
                <label class="caption">{{ ls.l("Subject") }}:</label>
                <dx-text-box
                    name="subject"
                    width="calc(100% - 31px)"
                    placeholder=""
                    [(value)]="data.subject"
                    validationGroup="templateValidation"
                    width="100%"
                    (onFocusIn)="onFieldFocusImproved('subject', $event)"
                    (onFocusOut)="onFieldBlur('subject', $event)"
                >
                    <dx-validator>
                        <dxi-validation-rule
                            type="required"
                            [message]="ls.l('RequiredField', ls.l('subject'))"
                        ></dxi-validation-rule>
                    </dx-validator>
                </dx-text-box>
            </div>
            <div class="field-area subject">
                <label class="caption">{{ ls.l("Preview Text") }}:</label>
                <dx-text-box
                    name="previewText"
                    width="calc(100% - 31px)"
                    placeholder=""
                    [(value)]="data.previewText"
                    width="100%"
                    validationGroup="templateValidation"
                    (onFocusIn)="onFieldFocusImproved('previewText', $event)"
                    (onFocusOut)="onFieldBlur('previewText', $event)"
                >
                </dx-text-box>
            </div>
            <div (keydown.escape)="onESC($event)" class="editor-div">
                <ckeditor
                    [(ngModel)]="data.body"
                    [config]="ckConfig"
                    (ready)="onReady($event)"
                    (change)="onChange($event)"
                    (focus)="onCKEditorFocusImproved($event)"
                    (blur)="onCKEditorBlur($event)"
                >
                </ckeditor>
                <div #tagsButtonContainer class="tags-button-container" *ngIf="tagsList.length && currentFocusedField" [style.left.px]="tooltipButtonLeft" [style.top.px]="tooltipButtonTop">
                    <span #tagsButton [class]="'tags-button id' + uniqId">
                        <a (click)="onTagButtonClick($event)">Add a Tag</a>
                    </span>
                </div>
                <dx-tooltip [width]="250"
                            [position]="tooltipPosition" 
                            [(visible)]="isTagsTooltipVisible"
                            [target]="'.tags-button.id' + uniqId">
                    <div *dxTemplate="let data of 'content'" class="tags-container">
                        <p class="tags-note">Supported Tags:</p>
                        <dx-list height="calc(100% - 40px)" [selectionMode]="'single'" [dataSource]="tagsList"
                            [itemTemplate]="'tagTemplate'" (onItemClick)="onTagClick($event)">
                            <div *dxTemplate="let data of 'tagTemplate'" class="tags-list-item"
                             [class]="{disabled: !templateEditMode && !getTagValue(data)}">
                                {{ getTagText(data) }}
                            </div>
                        </dx-list>
                    </div>
                </dx-tooltip>
            </div>
            <div class="attachment-div">
                <div class="attachment-field-area">
                    <ngx-file-drop
                        accept="*.*"
                        (onFileDrop)="addAttachments($event)"
                    >
                        <ng-template
                            ngx-file-drop-content-tmp
                            let-openFileSelector="openFileSelector"
                        >
                            <a
                                href="javascript:void(0);"
                                class="attach-link"
                                (click)="openDocuments()"
                            >
                                <img src="assets/common/icons/attach.svg" />
                                {{ls.l("Add attachment")}}
                            </a>
                            <dx-check-box
                                *ngIf="attachments && attachments.length"
                                class="saveToDocs"
                                [(value)]="data.saveAttachmentsToDocuments"
                                [rtlEnabled]="true"
                                [text]="ls.l('Save to Documents')"
                            >
                            </dx-check-box>
                        </ng-template>
                    </ngx-file-drop>
                </div>
                <div class="attachment-field-area bottom-text-ste"></div>
                <div class="attachment-field-area bottom-text-ste">
                    {{ charCount ? charCount : 0 }} chars
                </div>
            </div>

            <div class="field-area attachments">
                <div
                    *ngFor="let attachment of attachments; let i = index"
                    class="attachment"
                    [ngClass]="{ progress: !!attachment.loader }"
                    [ngStyle]="{'background-size': (attachment.progress || 0) + '%'}"
                >
                    <a
                        target="_blank"
                        [download]="attachment.name"
                        [href]="attachment.url"
                        (click)="attachmentClick($event, attachment)"
                        class="name"
                        >{{ attachment.name }}</a
                    >&nbsp;<span class="size">
                        ({{ attachment.size | filesize }}) </span
                    ><i
                        (click)="removeAttachment(attachment, i)"
                        aria-hidden="true"
                        class="delete fa fa-times"
                    ></i>
                </div>
            </div>
        </dx-validation-group>

        <div
            class="container"
            [ngClass]="showAIPrompt ? 'col-md-3' : 'hidden'"
            *ngIf="showAIPrompt"
        >
            <div
                class="prompt-header d-flex justify-content-between align-items-center"
                style="margin-bottom: 20px"
            >
                <h5 class="your-prompt-title">
                    <img src="./assets/common/icons/AI.png" class="img" />
                    Your AI Prompt
                </h5>

                <div style="display: flex; align-items: center">
                    <h5
                        class="your-prompt-title prompt-library-title"
                        id="promptLibraryToggle"
                        (click)="propmtTooltipVisible = true"
                        [class]="'prompt-liabrary-button id' + uniqId"
                    >
                        Your Prompt Library
                        <img
                            class="img"
                            src="./assets/common/icons/down-arrow.png"
                        />
                    </h5>

                    <dx-tooltip
                        [width]="350"
                        [position]="'bottom'"
                        [(visible)]="propmtTooltipVisible"
                        [target]="'.prompt-liabrary-button.id' + uniqId"
                    >
                        <div
                            *dxTemplate="let data of 'content'"
                            class="tags-container text-left p-2 prompt-tooltip-scroll"
                            style="max-height: 500px; overflow-y: scroll; overflow-x: hidden; scrollbar-width: thin; -webkit-overflow-scrolling: touch; cursor: default;"
                            tabindex="0"
                            (wheel)="onPromptTooltipWheel($event)"
                        >
                            <div
                                *ngFor="let group of groupedPromptLibrary;let groupIndex = index"
                            >
                                <!-- Group Title with toggle -->
                                <div
                                    class="group-header"
                                    (click)="toggleGroup(group)"
                                    style="cursor: pointer; padding: 8px 0; border-bottom: 1px solid #eee;"
                                >
                                    <strong>{{ group.category }}</strong>
                                    <span style="float: right;">{{
                                        group.expanded ? "▲" : "▼"
                                    }}</span>
                                </div>

                                <!-- Prompt list inside group -->
                                <div class="group-items" *ngIf="group.expanded">
                                    <div
                                        *ngFor="let item of group.prompts;let itemIndex = index"
                                        class="tags-list-item"
                                        (click)="selectedPromptItem(item,groupIndex,itemIndex)"
                                        style="cursor: pointer; padding: 8px 0; border-bottom: 1px solid #f5f5f5;"
                                    >
                                        <div class="prompt-title" style="font-weight: bold; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                            {{ item.title }}
                                        </div>
                                        <div class="prompt-subtext" style="font-size: 12px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                            {{ item.subtext }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dx-tooltip>
                </div>
            </div>

            <dx-scroll-view
                showScrollbar="onHover"
                #scrollAIView
                class="html-scroll-view"
            >
                <div class="content-container" *ngIf="!showAIOption">
                    <div
                        class="html-container-div"
                        contenteditable="true"
                        dir="ltr"
                        lang="en"
                        autocomplete="off"
                        autocorrect="off"
                        autocapitalize="off"
                        spellcheck="false"
                        (input)="onContentChange($event)"
                        (paste)="onPaste($event)"
                        #contentEditableDiv
                    >
                        <p>
                            Consectetur adipiscing elit,
                            <strong>sed do eiusmod</strong> tempor incididunt ut
                            labore et dolore.
                        </p>
                        <ul class="styled-list">
                            <li>
                                <strong>Customer Name and Business:</strong>
                                <div class="list-content">
                                    Adam Smith, <br />
                                    Samsung International LLC
                                </div>
                            </li>
                            <li>
                                <strong>Purpose of the email:</strong>
                                <div class="list-content">
                                    voluptatem accusantium doloremque
                                    laudantium, totam rem aperiam
                                </div>
                            </li>
                            <li>
                                <strong>Prior communications:</strong>
                                <div class="list-content">
                                    Ab illo inventore veritatis et quasi
                                    architecto beatae vitae dicta sunt
                                    explicabo.
                                </div>
                            </li>
                            <li>
                                <strong>Tone of the email:</strong>
                                <div class="list-content">
                                    Nemo enim ipsam voluptatem quia voluptas sit
                                    aspernatur aut odit aut fugit
                                </div>
                            </li>
                            <li>
                                <strong>Styling Preferences:</strong>
                                <div class="list-content">
                                    Sed quia consequuntur magni dolores eos qui
                                    ratione voluptatem sequi nesciunt.
                                </div>
                            </li>
                            <li>
                                <strong>Specific details to include:</strong>
                                <div class="list-content">
                                    Neque porro quisquam est, qui dolorem ipsum
                                    quia dolor sit amet, consectetur.
                                </div>
                            </li>
                        </ul>
                        <div>
                            <strong>The email must include:</strong>
                            <div>1. Numquam eius modi tempora incidunt</div>
                            <div>2. Labore et dolore magnam aliquam</div>
                            <div>
                                3. Ut enim ad minima veniam, quis nostrum.
                            </div>
                        </div>
                    </div>
                </div>
            </dx-scroll-view>

            <div class="prompt-footer">
                <div style="display: flex; align-items: center">
                    <div
                        class="gpt-model-toggle"
                        id="aiModelToggle"
                        (click)="aiTooltipVisible = true"
                        [class]="'ai-model-button id' + uniqId"
                    >
                        <img
                            class="img"
                            src="./assets/common/icons/openai-white.png"
                        />
                    </div>
                    <dx-tooltip
                        [width]="250"
                        [position]="'bottom'"
                        [(visible)]="aiTooltipVisible"
                        [target]="'.ai-model-button.id' + uniqId"
                    >
                        <div
                            *dxTemplate="let data of 'content'"
                            class="tags-container"
                        >
                            <dx-list
                                height="calc(100% - 40px)"
                                [selectionMode]="'single'"
                                [dataSource]="aiModels"
                                [itemTemplate]="'aiTemplate'"
                                (onItemClick)="selectedAIItem($event)"
                            >
                                <div
                                    *dxTemplate="let data of 'aiTemplate'"
                                    class="tags-list-item"
                                    [class.selected]="data.id==selectedItemId"

                                >
                                    <img
                                        [src]="
                                            './assets/common/icons/' + data.icon
                                        "
                                        alt="icon"
                                        class="ai-model-icon"
                                    />
                                    {{ data.name }}
                                </div>
                            </dx-list>
                        </div>
                    </dx-tooltip>
                </div>
                <button
                    class="button-generate-ai-message"
                    (click)="generateAIMessage()"
                >
                    {{ processing ? "Generating.." : "Generate AI Message" }}
                </button>
                <button class="cancel-button" (click)="cancelAIMessage()">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</modal-dialog>
