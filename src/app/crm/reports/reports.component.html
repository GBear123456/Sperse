<app-headline icon="briefcase"
              [showToggleToolbarButton]="true"
              [showToggleCompactViewButton]="true"
              [showReloadButton]="true"
              (onToggleCompactView)="toggleContactView()"
              (onToggleToolbar)="toggleToolbar()"
              (onReload)="reload()">
    <types-dropdown [items]="reportTypes"
                    [totalCount]="totalCount"
                    [(value)]="selectedReportType"
                    (onValueChanged)="onReportTypeChanged($event)">
    </types-dropdown>
    <import-progress-bar></import-progress-bar>
</app-headline>
<app-toolbar [config]="toolbarConfig" [hidden]="appService.toolbarIsHidden$ | async"></app-toolbar>
<div class="main-wrapper" [ngStyle]="{ height: 'calc(100% - ' + (appService.toolbarIsHidden.value ? '75px' : '136px' ) + ')' }">
    <ghost-list *ngIf="!isDataLoaded"></ghost-list>
    <div [hidden]="totalCount <= 0 || selectedReportType !== reportTypesEnum.Subscribers">
        <dx-data-grid #subscribersDataGrid
                      id="gridContainer"
                      class="main-component-view"
                      accesskey="narrowHeaderPanel"
                      [allowColumnReordering]="true"
                      [columnAutoWidth]="true"
                      [allowColumnResizing]="true"
                      [hoverStateEnabled]="true"
                      [loadPanel]="{ enabled: false }"
                      [remoteOperations]="{ filtering: false }"
                      [pager]="defaultGridPagerConfig"
                      (onContentReady)="onContentReady()"
                      (onDataErrorOccurred)="httpInterceptor.handleError($event.error)">
            <dxo-selection selectAllMode="page"
                           showCheckBoxesMode="always"
                           mode="multiple">
            </dxo-selection>
            <dxo-sorting mode="multiple"></dxo-sorting>
            <dxo-group-panel [visible]="true"></dxo-group-panel>
            <dxo-paging [pageSize]="20"></dxo-paging>

            <dxi-column dataField="name" [caption]="ls.l('Customer.Name')" cssClass="clipboard-holder"></dxi-column>
            <dxi-column dataField="email" [caption]="ls.l('Contact.Email')" cssClass="clipboard-holder"></dxi-column>
            <dxi-column [caption]="ls.l('Contact.Phone')" [calculateDisplayValue]="customizePhoneCell" cssClass="clipboard-holder"></dxi-column>
            <dxi-column dataField="city" [caption]="ls.l('Contact.City')" cssClass="clipboard-holder"></dxi-column>
            <dxi-column dataField="status" [caption]="ls.l('Status')" [calculateDisplayValue]="customizeStatusCell" cellTemplate="statusCell"></dxi-column>
            <dxi-column dataField="bankCode"
                        cellTemplate="bankCodeCell"
                        [caption]="ls.l('BankCode')">
            </dxi-column>
            <dxi-column dataField="crated"
                        [caption]="ls.l('Created')"
                        [calculateDisplayValue]="customizeCreatedCell"
                        cssClass="clipboard-holder">
            </dxi-column>
            <dxi-column dataField="bankPassFee"
                        [caption]="ls.l('BankPassFee')"
                        cssClass="clipboard-holder"
                        [calculateDisplayValue]="customizeBankPassFeeCell">
            </dxi-column>
            <dxi-column dataField="bankVaultFee"
                        [caption]="ls.l('BankVaultFee')"
                        cssClass="clipboard-holder"
                        [calculateDisplayValue]="customizeBankVaultFeeCell">
            </dxi-column>
            <dxi-column dataField="wtbFee"
                        [caption]="ls.l('WtbFee')"
                        cssClass="clipboard-holder"
                        [calculateDisplayValue]="customizeWtbFeeCell">
            </dxi-column>
            <dxi-column dataField="total"
                        [caption]="ls.l('Total')"
                        cssClass="clipboard-holder"
                        [calculateDisplayValue]="customizeTotalCell">
            </dxi-column>
            <div *dxTemplate="let cellData of 'bankCodeCell'">
                <bank-code-letters [bankCode]="cellData.value"></bank-code-letters>
            </div>
            <div *dxTemplate="let cellData of 'statusCell'">
                <div [class]="'client-status ' + cellData.value | lowercase">
                    {{ cellData.displayValue }}
                </div>
            </div>
        </dx-data-grid>
    </div>
    <div [hidden]="totalCount <= 0 || selectedReportType !== reportTypesEnum.SubscribersStats">
        <dx-data-grid #statsDataGrid
                      id="gridContainer"
                      class="main-component-view subscribers-stats-grid"
                      accesskey="narrowHeaderPanel"
                      [allowColumnReordering]="true"
                      [columnAutoWidth]="true"
                      [allowColumnResizing]="true"
                      [hoverStateEnabled]="true"
                      [showBorders]="true"
                      [loadPanel]="{ enabled: false }"
                      [remoteOperations]="{ filtering: false }"
                      [pager]="defaultGridPagerConfig"
                      (onContentReady)="onContentReady()"
                      (onDataErrorOccurred)="httpInterceptor.handleError($event.error)">
            <dxo-selection selectAllMode="page"
                           showCheckBoxesMode="always"
                           mode="multiple">
            </dxo-selection>
            <dxo-sorting mode="multiple"></dxo-sorting>
            <dxo-paging [pageSize]="20"></dxo-paging>
            <dxi-column dataField="date"
                        [caption]="ls.l('Date')"
                        [calculateDisplayValue]="customizeDateCell"
                        cssClass="clipboard-holder">
            </dxi-column>
            <dxi-column [caption]="ls.l('Contacts')" alignment="center">
                <dxi-column alignment="center"
                            dataField="leadCount"
                            [caption]="ls.l('Leads')"
                            cssClass="clipboard-holder">
                </dxi-column>
                <dxi-column alignment="center"
                            dataField="clientCount"
                            [caption]="ls.l('Clients')"
                            cssClass="clipboard-holder">
                </dxi-column>
            </dxi-column>
            <dxi-column [caption]="ls.l('Subscribers')" alignment="center">
                <dxi-column alignment="center"
                            dataField="bankConnectCount"
                            [caption]="ls.l('Connect')"
                            cssClass="clipboard-holder">
                </dxi-column>
                <dxi-column alignment="center"
                            dataField="bankBeyondCount"
                            [caption]="ls.l('Beyond')"
                            cssClass="clipboard-holder">
                </dxi-column>
                <dxi-column alignment="center"
                            dataField="starterKitCount"
                            [caption]="ls.l('StarterKit')"
                            cssClass="clipboard-holder">
                </dxi-column>
            </dxi-column>
            <dxi-column [caption]="ls.l('GrossSales')" alignment="center">
                <dxi-column alignment="center"
                            dataField="bankConnectAmount"
                            [caption]="ls.l('Connect')"
                            [calculateDisplayValue]="customizeBankConnectAmountCell"
                            cssClass="clipboard-holder">
                </dxi-column>
                <dxi-column alignment="center"
                            dataField="bankBeyondAmount"
                            [caption]="ls.l('Beyond')"
                            [calculateDisplayValue]="customizeBankBeyondAmountCell"
                            cssClass="clipboard-holder">
                </dxi-column>
                <dxi-column alignment="center"
                            dataField="starterKitAmount"
                            [caption]="ls.l('StarterKit')"
                            [calculateDisplayValue]="customizeStarterKitAmountCell"
                            cssClass="clipboard-holder">
                </dxi-column>
                <dxi-column alignment="center"
                            dataField="totalAmount"
                            [caption]="ls.l('Total')"
                            [calculateDisplayValue]="customizeTotalAmountCell"
                            cssClass="clipboard-holder">
                </dxi-column>
            </dxi-column>
            <dxo-summary>
                <dxi-total-item alignment="center"
                                column="leadCount"
                                displayFormat="{0}"
                                summaryType="sum">
                </dxi-total-item>
                <dxi-total-item alignment="center"
                                column="clientCount"
                                displayFormat="{0}"
                                summaryType="sum">
                </dxi-total-item>
                <dxi-total-item alignment="center"
                                column="bankConnectCount"
                                displayFormat="{0}"
                                summaryType="sum">
                </dxi-total-item>
                <dxi-total-item alignment="center"
                                column="bankBeyondCount"
                                displayFormat="{0}"
                                summaryType="sum">
                </dxi-total-item>
                <dxi-total-item alignment="center"
                                column="starterKitCount"
                                displayFormat="{0}"
                                summaryType="sum">
                </dxi-total-item>
                <dxi-total-item [customizeText]="customizeAmountSummary"
                                alignment="center"
                                column="bankConnectAmount"
                                displayFormat="{0}"
                                summaryType="sum">
                </dxi-total-item>
                <dxi-total-item [customizeText]="customizeAmountSummary"
                                alignment="center"
                                column="bankBeyondAmount"
                                displayFormat="{0}"
                                summaryType="sum">
                </dxi-total-item>
                <dxi-total-item [customizeText]="customizeAmountSummary"
                                alignment="center"
                                column="starterKitAmount"
                                displayFormat="{0}"
                                summaryType="sum">
                </dxi-total-item>
                <dxi-total-item [customizeText]="customizeAmountSummary"
                                alignment="center"
                                column="totalAmount"
                                displayFormat="{0}"
                                summaryType="sum">
                </dxi-total-item>
            </dxo-summary>
        </dx-data-grid>
    </div>
    <app-no-data
        [hidden]="!isDataLoaded || totalCount"
        [showLink]="false">
    </app-no-data>
</div>
