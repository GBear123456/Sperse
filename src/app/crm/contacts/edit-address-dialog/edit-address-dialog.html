<!-- Modern Address Dialog UI -->
<div class="address-dialog-container" (mousedown)="mouseDown($event)">
    <!-- Header Section -->
    <div class="dialog-header">
        <div class="header-content">
            <div class="icon-container">
                <div class="address-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-house h-6 w-6 sm:h-7 sm:w-7 text-purple-600 dark:text-purple-400" ><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg>
                </div>
            </div>
            <div class="title-section">
                <h2 class="dialog-title">{{action === 'Edit' ? 'Edit Address' : 'Add Address'}}</h2>
                <p class="dialog-subtitle">{{action === 'Edit' ? 'Edit the address details' : 'Add a new address'}}</p>
            </div>
        </div>
        <div class="header-actions">
            <button mat-button mat-dialog-close class="cancel-btn">{{ls.l('Cancel')}}</button>
            <button *ngIf="isEditAllowed" mat-button class="save-btn" (click)="onSave()">
                {{action == 'Edit' ? ls.l('Update') : 'Save'}}
            </button>
        </div>
    </div>

    <!-- Content Section -->
    <div class="dialog-content">
        <dx-validation-group (onInitialized)="initValidationGroup($event)">
            
            <!-- Address Type Selection Tabs -->
            <div *ngIf="data.showType" class="type-selection">
                <div class="type-tabs">
                    <div class="type-tab" 
                         [class.active]="getAddressType() === 'Home'"
                         (click)="setAddressType('Home')">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path><path d="M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg>
                        <span>Home</span>
                    </div>
                    <div class="type-tab" 
                         [class.active]="getAddressType() === 'Work'"
                         (click)="setAddressType('Work')">
                         
                             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path><rect width="20" height="14" x="2" y="6" rx="2"></rect></svg>
                         
                        <span>Work</span>
                    </div>
                    <div class="type-tab" 
                         [class.active]="getAddressType() === 'Other'"
                         (click)="setAddressType('Other')">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path><circle cx="12" cy="10" r="3"></circle></svg>
                        <span>Other</span>
                    </div>
                </div>
            </div>
            <!-- Street Address Field -->
            <div class="field-group">
                <input *ngIf="!googleAutoComplete"
                       type="text"
                       name="Address"
                       placeholder="Street address"
                       [(ngModel)]="address"
                       class="form-control"
                       [disabled]="!isEditAllowed"/>
                <input *ngIf="googleAutoComplete"
                       #addressInput
                       type="text"
                       name="Address"
                       placeholder="Street address"
                       [(ngModel)]="address"
                       class="form-control"
                       [disabled]="!isEditAllowed"
                       (onAddressChange)="onAddressChanged($event)"
                       ngx-google-places-autocomplete/>
            </div>
            <!-- Country Field -->
            <div class="field-group">
                <dx-select-box
                    [dataSource]="countries"
                    displayExpr="name"
                    valueExpr="name"
                    [disabled]="!isEditAllowed"
                    name="country"
                    [searchEnabled]="true"
                    [(value)]="data.countryName"
                    fieldTemplate="field"
                    (onValueChanged)="onCountryChange($event)"
                    placeholder="Country">
                    <div *dxTemplate="let data of 'field'">
                        <div class="custom-item">
                            <dx-text-box class="state"
                                         [value]="data?.name"
                                         [readOnly]="true">
                            </dx-text-box>
                        </div>
                    </div>
                </dx-select-box>
            </div>

            <!-- City Field (Full Width) -->
            <div class="field-group">
                <input
                    type="text"
                    name="city"
                    class="form-control"
                    [disabled]="!isEditAllowed"
                    maxlength="50"
                    [(ngModel)]="data.city"
                    placeholder="City">
            </div>

            <!-- State and Zip Code Row -->
            <div class="field-row">
                <div class="field-group state-field">
                    <dx-select-box
                        [acceptCustomValue]="true"
                        [dataSource]="getCountryStates() | async"
                        displayExpr="name"
                        valueExpr="name"
                        name="state"
                        [disabled]="!isEditAllowed"
                        [searchEnabled]="true"
                        [(value)]="data.stateName"
                        fieldTemplate="field"
                        (onValueChanged)="stateChanged($event)"
                        (onCustomItemCreating)="onCustomStateCreate($event)"
                        placeholder="State"
                        [showClearButton]="false">
                        <div *dxTemplate="let data of 'field'">
                            <div class="custom-item">
                                <dx-text-box class="state" [value]="data?.name" placeholder="State"></dx-text-box>
                            </div>
                        </div>
                    </dx-select-box>
                </div>

                <div class="field-group zip-field">
                    <input
                        type="text"
                        name="zip"
                        class="form-control"
                        [disabled]="!isEditAllowed"
                        maxlength="10"
                        [(ngModel)]="data.zip"
                        placeholder="Zip code">
                </div>
            </div>

            <!-- Neighborhood Field (if enabled) -->
            <div *ngIf="data.showNeighborhood" class="field-group">
                <input
                    type="text"
                    name="neighborhood"
                    class="form-control"
                    [disabled]="!isEditAllowed"
                    maxlength="128"
                    [(ngModel)]="data.neighborhood"
                    placeholder="Neighborhood">
            </div>

            <!-- Comment Field -->
            <div *ngIf="!data.hideComment" class="field-group comment-field">
                <textarea
                    name="comment"
                    class="form-control"
                    [disabled]="!isEditAllowed"
                    [(ngModel)]="data.comment"
                    placeholder="Note about this address (optional)"
                    rows="3">
                </textarea>
            </div>

            <!-- Status Checkboxes -->
            <div *ngIf="!data.hideCheckboxes" class="status-checkboxes">
                <div class="checkbox-item">
                    <dx-check-box
                        text="Active"
                        [disabled]="!isEditAllowed"
                        [(value)]="data.isActive">
                    </dx-check-box>
                </div>
                <div class="checkbox-item">
                    <dx-check-box
                        text="Confirmed"
                        [disabled]="!isEditAllowed"
                        [(value)]="data.isConfirmed">
                    </dx-check-box>
                </div>
            </div>
        </dx-validation-group>
    </div>

    <!-- Delete Button (for edit mode) -->
    <div *ngIf="isEditAllowed && data.isDeleteAllowed && data.deleteItem && action === 'Edit'" class="delete-section">
        <button mat-button class="delete-btn" (click)="data.deleteItem($event)">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2 h-4 w-4 mr-2" ><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>
            {{ls.l('Delete')}}
        </button>
    </div>
</div>
