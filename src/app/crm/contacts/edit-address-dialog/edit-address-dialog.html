<!-- Modern Address Dialog UI -->
<div class="address-dialog-container" (mousedown)="mouseDown($event)">
    <!-- Header Section -->
    <div class="dialog-header">
        <div class="header-content">
            <div class="icon-container">
                <div class="address-icon">
                    <i class="fa fa-home"></i>
                </div>
            </div>
            <div class="title-section">
                <h2 class="dialog-title">{{action === 'Edit' ? 'Edit Address' : 'Add Address'}}</h2>
                <p class="dialog-subtitle">{{action === 'Edit' ? 'Edit the address details' : 'Add a new address'}}</p>
            </div>
        </div>
        <div class="header-actions">
            <button mat-button mat-dialog-close class="cancel-btn">{{ls.l('Cancel')}}</button>
            <button *ngIf="isEditAllowed" mat-button class="save-btn" (click)="onSave()">
                {{action == 'Edit' ? ls.l('Update') : 'Save'}}
            </button>
        </div>
    </div>

    <!-- Content Section -->
    <div class="dialog-content">
        <dx-validation-group (onInitialized)="initValidationGroup($event)">
            
            <!-- Address Type Selection Tabs -->
            <div *ngIf="data.showType" class="type-selection">
                <div class="type-tabs">
                    <div class="type-tab" 
                         [class.active]="getAddressType() === 'Home'"
                         (click)="setAddressType('Home')">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </div>
                    <div class="type-tab" 
                         [class.active]="getAddressType() === 'Work'"
                         (click)="setAddressType('Work')">
                        <i class="fa fa-briefcase"></i>
                        <span>Work</span>
                    </div>
                    <div class="type-tab" 
                         [class.active]="getAddressType() === 'Other'"
                         (click)="setAddressType('Other')">
                        <i class="fa fa-map-marker"></i>
                        <span>Other</span>
                    </div>
                </div>
            </div>
            <!-- Street Address Field -->
            <div class="field-group">
                <input *ngIf="!googleAutoComplete"
                       type="text"
                       name="Address"
                       placeholder="Street address"
                       [(ngModel)]="address"
                       class="form-control"
                       [disabled]="!isEditAllowed"/>
                <input *ngIf="googleAutoComplete"
                       #addressInput
                       type="text"
                       name="Address"
                       placeholder="Street address"
                       [(ngModel)]="address"
                       class="form-control"
                       [disabled]="!isEditAllowed"
                       (onAddressChange)="onAddressChanged($event)"
                       ngx-google-places-autocomplete/>
            </div>
            <!-- Country Field -->
            <div class="field-group">
                <dx-select-box
                    [dataSource]="countries"
                    displayExpr="name"
                    valueExpr="name"
                    [disabled]="!isEditAllowed"
                    name="country"
                    [searchEnabled]="true"
                    [(value)]="data.countryName"
                    fieldTemplate="field"
                    (onValueChanged)="onCountryChange($event)"
                    placeholder="Country">
                    <div *dxTemplate="let data of 'field'">
                        <div class="custom-item">
                            <dx-text-box class="state"
                                         [value]="data?.name"
                                         [readOnly]="true">
                            </dx-text-box>
                        </div>
                    </div>
                </dx-select-box>
            </div>

            <!-- State and City Row -->
            <div class="field-row">
                <div class="field-group state-field">
                    <dx-select-box
                        [acceptCustomValue]="true"
                        [dataSource]="getCountryStates() | async"
                        displayExpr="name"
                        valueExpr="name"
                        name="state"
                        [disabled]="!isEditAllowed"
                        [searchEnabled]="true"
                        [(value)]="data.stateName"
                        fieldTemplate="field"
                        (onValueChanged)="stateChanged($event)"
                        (onCustomItemCreating)="onCustomStateCreate($event)"
                        placeholder="State"
                        [showClearButton]="false">
                        <div *dxTemplate="let data of 'field'">
                            <div class="custom-item">
                                <dx-text-box class="state" [value]="data?.name" placeholder="State"></dx-text-box>
                            </div>
                        </div>
                    </dx-select-box>
                </div>

                <div class="field-group city-field">
                    <input
                        type="text"
                        name="city"
                        class="form-control"
                        [disabled]="!isEditAllowed"
                        maxlength="50"
                        [(ngModel)]="data.city"
                        placeholder="City">
                </div>
            </div>
            <!-- Neighborhood Field (if enabled) -->
            <div *ngIf="data.showNeighborhood" class="field-group">
                <input
                    type="text"
                    name="neighborhood"
                    class="form-control"
                    [disabled]="!isEditAllowed"
                    maxlength="128"
                    [(ngModel)]="data.neighborhood"
                    placeholder="Neighborhood">
            </div>

            <!-- Zip Code Field -->
            <div class="field-group">
                <input
                    type="text"
                    name="zip"
                    class="form-control"
                    [disabled]="!isEditAllowed"
                    maxlength="10"
                    [(ngModel)]="data.zip"
                    placeholder="Zip code">
            </div>

            <!-- Comment Field -->
            <div *ngIf="!data.hideComment" class="field-group comment-field">
                <textarea
                    name="comment"
                    class="form-control"
                    [disabled]="!isEditAllowed"
                    [(ngModel)]="data.comment"
                    placeholder="Note about this address (optional)"
                    rows="3">
                </textarea>
            </div>

            <!-- Status Checkboxes -->
            <div *ngIf="!data.hideCheckboxes" class="status-checkboxes">
                <div class="checkbox-item">
                    <dx-check-box
                        text="Active"
                        [disabled]="!isEditAllowed"
                        [(value)]="data.isActive">
                    </dx-check-box>
                </div>
                <div class="checkbox-item">
                    <dx-check-box
                        text="Confirmed"
                        [disabled]="!isEditAllowed"
                        [(value)]="data.isConfirmed">
                    </dx-check-box>
                </div>
            </div>
        </dx-validation-group>
    </div>

    <!-- Delete Button (for edit mode) -->
    <div *ngIf="isEditAllowed && data.isDeleteAllowed && data.deleteItem && action === 'Edit'" class="delete-section">
        <button mat-button class="delete-btn" (click)="data.deleteItem($event)">
            <i class="fa fa-trash"></i>
            {{ls.l('Delete')}}
        </button>
    </div>
</div>
