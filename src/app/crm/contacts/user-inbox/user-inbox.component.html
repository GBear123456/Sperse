<div class="inbox-user-form" >
    <div class="inbox-list">
        <dx-list
            width="100%"
            height="100%"
            keyExpr="id"
            searchExpr="Name"
            searchMode="contains"
            selectionMode="single"
            pageLoadMode="scrollBottom"
            [grouped]="true"
            [searchTimeout]="500"
            [dataSource]="dataSource"
            [collapsibleGroups]="true"
            [focusStateEnabled]="false"
            [activeStateEnabled]="false"
            [selectedItemKeys]="[activeMessage?.id]"
            [searchEditorOptions]="{placeholder: ls.l('SearchMessage')}"
            [searchEnabled]="true"
            (onItemClick)="initActiveMessage($event.itemData)">
                <div *dxTemplate="let item of 'group'" class="group-item" [ngClass]="{selected: item.id == activeMessage?.id, 'has-children': item.hasChildren, expanded: item.expanded}" (click)="expandGroup(item)">
                    <div class="email" title="{{item.date | date: formatting.inboxDate : userTimezone}}">
                        <div [ngStyle]="{'background-image': 'url(' + profileService.getProfilePictureUrl(item?.fromUserThumbnailId, noPhotoUrl) + ')'}" class="img-circle"></div>
                        <div class="details">
                            <span class="from">{{item.fromUserName}}</span>
                            <span class="subject">{{item.subject}}</span>
                        </div>
                        <div class="date">{{item.creationTime | date: formatting.monthDay : userTimezone}}</div>
                    </div>
                </div>
                <div *dxTemplate="let item of 'item'" class="sub-item" [ngClass]="{selected: item.id == activeMessage?.id}">
                    <div class="email" title="{{item.date | date: formatting.inboxDate : userTimezone}}">
                        <div [ngStyle]="{'background-image': 'url(' + profileService.getProfilePictureUrl(item?.fromUserThumbnailId, noPhotoUrl) + ')'}" class="img-circle"></div>
                        <div class="details">
                            <span class="from">{{item.fromUserName}}</span>
                            <span class="subject">{{item.subject}}</span>
                        </div>
                        <div class="date">{{item.creationTime | date: formatting.monthDay : userTimezone}}</div>
                    </div>
                </div>
        </dx-list>
    </div>
    <div class="inbox-content" *ngIf="activeMessage">
        <app-toolbar [config]="contentToolbar"></app-toolbar>
        <ng-container [ngSwitch]="activeMessage.deliveryType">
            <ng-container *ngSwitchCase="'SMS'">                
                <div class="header sms">
                    <div [ngStyle]="{'background-image': 'url(' + profileService.getProfilePictureUrl(activeMessage?.fromUserThumbnailId, noPhotoUrl) + ')'}" class="img-circle avatar"></div>  
                    <div class="details">
                        <span class="from">{{activeMessage?.fromUserName}}</span>
                        <span class="to">{{activeMessage?.to}}</span>
                    </div>
                    <div class="date">{{activeMessage?.creationTime | date: formatting.inboxDate : userTimezone}}</div>
                </div>                
            </ng-container>
            <ng-container *ngSwitchCase="'Email'">                
                <div class="header">
                    <div [ngStyle]="{'background-image': 'url(' + profileService.getProfilePictureUrl(activeMessage?.fromUserThumbnailId, noPhotoUrl) + ')'}" class="img-circle avatar"></div>  
                    <div class="details">
                        <span class="from">{{activeMessage?.fromUserName}}</span>
                        <span class="subject">{{activeMessage?.subject}}</span>
                        <span class="to">{{ls.l('to')}} {{activeMessage?.to}}</span>
                    </div>
                    <div class="date">{{activeMessage?.creationTime | date: formatting.inboxDate : userTimezone}}</div>
                </div>
            </ng-container>
        </ng-container>
        <div class="content {{activeMessage.deliveryType | lowercase}}">
            <dx-scroll-view showScrollbar="onHover">
                <div class="body from" [innerHtml]="activeMessage?.body"></div>
                <div *ngFor="let child of activeMessage?.items">
                    <div class="body" [ngClass]="{from: activeMessage?.from == child.from, to: activeMessage?.from == child.to}" [innerHtml]="child.body || child.subject"></div>
                </div>                
            </dx-scroll-view>
            <div class="attachments">
                <div *ngFor="let attachment of activeMessage?.attachments" class="attachment">
                    <a [download]="attachment.name" href="javascript:void(0)" class="name" (click)="openAttachment(attachment)">{{attachment.name}}</a>&nbsp;<span class="size">({{attachment.size | filesize}})</span>
                </div>
            </div>
            <div class="input-form">                  
                <img src="assets/common/icons/page.svg" class="page" (click)="extendMessage()">
                <img src="assets/common/icons/attach.svg" class="attach" [ngClass]="{disabled: activeMessage.deliveryType == 'SMS'}">
                <div class="delimiter"></div>
                <dx-text-box
                    width="95%"
                    height="44px"
                    [maxLength]="150"
                    valueChangeEvent="keyup"
                    [placeholder]="ls.l('Type your message here...')"
                    [stylingMode]="'outlined'"
                    [(value)]="instantMessageText">
                </dx-text-box>
                <img src="assets/common/icons/send-blue.svg" class="send" [ngClass]="{disabled: !instantMessageText}" (click)="instantMessageSend($event)">
            </div>
        </div>
    </div>
    <app-no-data
        [hidden]="activeMessage"
        [showLink]="false">
    </app-no-data>
</div>