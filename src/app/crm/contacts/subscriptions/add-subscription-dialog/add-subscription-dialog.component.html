<header>
    <h2 mat-dialog-title>{{ls.l('AddSubscription')}}</h2>
    <mat-dialog-actions>
        <button mat-button (click)="saveSubscription()" class="button-layout button-primary">{{ls.l('Save')}}</button>
    </mat-dialog-actions>
    <span class="close" (click)="close()"></span>
</header>
<span class="close" (click)="close()"></span>
<mat-dialog-content>
    <dx-validation-group>
        <div class="subscription" *ngFor="let subscription of subscription.subscriptions; let i = index">
            <i *ngIf="i !== 0" class="fa fa-close" (click)="removeSubscriptionFields(i)"></i>
            <div class="field">
                <label for="code">{{ls.l('Code')}}</label>
                <dx-select-box [inputAttr]="{ id: 'code' }"
                               [dataSource]="serviceTypes"
                               displayExpr="code"
                               valueExpr="code"
                               [(value)]="subscription.code"
                               placeholder="Select service..."
                               (onValueChanged)="onServiceTypeChanged($event, subscription)">
                    <dx-validator>
                        <dxi-validation-rule type="required" message=""></dxi-validation-rule>
                    </dx-validator>
                </dx-select-box>
            </div>
            <div class="field">
                <label for="name">{{ls.l('Name')}}</label>
                <dx-text-box name="name" #nameComponent
                             [inputAttr]="{ id: 'name' }"
                             [(value)]="subscription.name">
                    <dx-validator>
                        <dxi-validation-rule type="required" message="{{ls.l('NameIsRequired')}}."></dxi-validation-rule>
                    </dx-validator>
                </dx-text-box>
            </div>
            <div class="field" *ngIf="subscription.levels?.length">
                <label for="name">{{ls.l('Level')}}</label>
                <dx-select-box [inputAttr]="{ id: 'level' }"
                               [dataSource]="subscription.levels"
                               displayExpr="code"
                               valueExpr="code"
                               [(value)]="subscription.level"
                               showClearButton="true"
                               (onValueChanged)="onServiceLevelChanged($event, subscription)">
                </dx-select-box>
            </div>
            <div class="field">
                <label for="endDate">{{ls.l('StartDate') }}</label>
                <dx-date-box type="date"
                             [max]="subscription.maxStartDate"
                             [(value)]="subscription.startDate"
                             (onValueChanged)="onStartDateChanged(subscription)">
                </dx-date-box>
            </div>
            <div class="field">
                <label for="endDate">{{ls.l('EndDate') }}</label>
                <dx-date-box [min]="subscription.startDate"
                             type="date"
                             [(value)]="subscription.endDate">
                </dx-date-box>
            </div>
            <div class="field">
                <label for="amount">{{ls.l('Amount')}}</label>
                <dx-number-box name="amount"
                               [inputAttr]="{ id: 'amount' }"
                               [format]="amountFormat$ | async"
                               [(value)]="subscription.amount">
                </dx-number-box>
            </div>
        </div>
        <div class="field order-field">
            <label for="orderNumber">
                {{ls.l('OrderNumber')}}
                <small class="small-gray">*optional</small>
            </label>
            <order-dropdown [(orderNumber)]="subscription.orderNumber"
                            placeholder=""
                            width="100%"
                            [contactId]="data.contactId">
            </order-dropdown>
        </div>
        <div class="field">
            <div class="add-new-button" (click)="addNewSubscriptionFields()"><span>+ Add</span></div>
        </div>
    </dx-validation-group>
</mat-dialog-content>