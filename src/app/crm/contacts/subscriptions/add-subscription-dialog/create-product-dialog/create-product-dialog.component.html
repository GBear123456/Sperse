<modal-dialog [title]="title"
              [titleClearButton]="false"
              [buttons]="buttons"
              [isTabAvailable]="true"
              [tabs]="tabs"
              [selectedTab]="selectedTab"
              [isTitleValid]="true"
              [editTitle]="false"
              (onContextItemChanged)="onSaveOptionSelectionChanged()">
    <dx-scroll-view showScrollbar="onHover">
        <dx-validation-group>
            <div class="wrapper">
                <div class="content">
                    <ng-container *ngIf="selectedTab == tabs.options[0].type; else deliverables">
                        <div class="left">
                            <div class="block" [ngClass]="{selected: product.type == productType.Subscription, disabled: !isSubscriptionManagementEnabled || (product.type != productType.Subscription && product.id)}" (click)="onProductTypeChanged(productType.Subscription)">
                                <img class="head" src="assets/common/icons/team.svg">
                                <h3>{{ls.l('Membership or Subscription')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <p>{{ls.l('Selling memberships or subscriptions enable you to sell regularly delivered products with recurring payments.')}}</p>
                            </div>
                            <div class="block" [ngClass]="{selected: product.type == productType.Digital, disabled: product.type != productType.Digital && product.id}" (click)="onProductTypeChanged(productType.Digital)">
                                <img class="head" src="assets/common/icons/group.svg">
                                <h3>{{ls.l('Digital Download Product')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <p>{{ls.l('Sell digital downloadable such as Software, eBooks, PDFs, templates, music, videos, or anything else digital.')}}</p>
                            </div>
                            <div class="block" [ngClass]="{selected: product.type == productType.General, disabled: product.type != productType.General && product.id}" (click)="onProductTypeChanged(productType.General)">
                                <img class="head" src="assets/common/icons/open-book.svg">
                                <h3>{{ls.l('Service & Physical Product')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <p>{{ls.l('Sell books, merchandise, mugs, t-shirts, art, or any other product that requires shipping.')}}</p>
                            </div>
                            <div class="block" [ngClass]="{selected: product.type == productType.Event, disabled: product.type != productType.Event && product.id }" (click)="onProductTypeChanged(productType.Event)">
                                <img class="head" src="assets/common/icons/fireworks.svg">
                                <h3>{{ls.l('Event Tickets')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <p>{{ls.l('Sell event tickets and highlight benefits to get event-goers interested to attend.')}}</p>
                            </div>
                            <div class="block" [ngClass]="{selected: product.type == productType.Donation, disabled: product.type != productType.Donation && product.id }" (click)="onProductTypeChanged(productType.Donation)">
                                <img class="head" src="assets/common/icons/donation.png">
                                <h3>{{ls.l('Donate')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <p>{{ls.l('Set a goal and start receiving funds to achieve it straightforwardly.')}}</p>
                            </div>
                        </div>
                        <div class="middle">
                            <div class="block">
                                <div class="product-title-block">
                                    <h3>{{ls.l('Product')}}</h3>
                                    <span *ngIf="product && product.id">Product Id: <b>{{product.id}}</b> <i class="save-to-clipboard" (click)="copyTextToClipboard(product.id)"></i></span>
                                </div>
                                <hr>
                                <div>
                                    <label>{{ls.l('Product name')}} <img class="info" src="assets/common/icons/info-circle.svg"></label>
                                    <dx-text-box name="name"
                                                 width="100%"
                                                 [maxLength]="255"
                                                 [inputAttr]="{ id: 'name' }"
                                                 [(value)]="product.name"
                                                 [disabled]="isReadOnly">
                                        <dx-validator>
                                            <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Name'))}}."></dxi-validation-rule>
                                        </dx-validator>
                                    </dx-text-box>
                                </div>
                                <div class="product-ident">
                                    <div>
                                        <label>{{ls.l('Product SKU or unique code')}} <img class="info" src="assets/common/icons/info-circle.svg"></label>
                                        <dx-text-box name="code"
                                                     width="100%"
                                                     [maxLength]="50"
                                                     valueChangeEvent="keyup"
                                                     [inputAttr]="{ id: 'code' }"
                                                     [(value)]="product.code"
                                                     [disabled]="isReadOnly"
                                                     (onValueChanged)="onProductCodeChanged($event)">
                                            <dx-validator>
                                                <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Code'))}}."></dxi-validation-rule>
                                            </dx-validator>
                                        </dx-text-box>
                                    </div>
                                    <div>
                                        <label>{{ls.l('Product Barcode')}} <img class="info" src="assets/common/icons/info-circle.svg"></label>
                                        <dx-text-box name="barCode"
                                                     width="100%"
                                                     [maxLength]="50"
                                                     [inputAttr]="{ id: 'barCode' }"
                                                     [(value)]="product.barCode"
                                                     [disabled]="isReadOnly">
                                        </dx-text-box>
                                    </div>
                                </div>
                                <div class="product-url">
                                    <div class="edit">
                                        <inplace-edit *ngIf="isPublicProductsEnabled"
                                                      [id]="'product-url'"
                                                      [value]="product.publicName"
                                                      [showInlineEditButton]="true"
                                                      [displayValue]="baseUrl + '/p/' + tenantId + '/' + (product.publicName || '')"
                                                      [maxLength]="255"
                                                      [validationRules]="publicNameValidationRules"
                                                      [isReadOnlyField]="isReadOnly"
                                                      lEntityName="Product Url"
                                                      [editPlaceholder]="ls.l('ProductUrl')"
                                                      [isEditDialogEnabled]="false"
                                                      [isHistoryEnabled]="false"
                                                      (valueChanged)="updateProductUrl($event)"
                                                      width="80%">
                                        </inplace-edit>
                                    </div>
                                    <div class="qr-code" (click)="downloadQr()">
                                        <div #canvas></div>
                                    </div>
                                </div>
                                <div>
                                    <label for="name">{{ls.l('Description')}}</label>
                                    <dx-text-area name="description"
                                                  width="100%"
                                                  [inputAttr]="{ id: 'description' }"
                                                  [(value)]="product.description"
                                                  [autoResizeEnabled]="true"
                                                  [maxLength]="5000"
                                                  [maxHeight]="150"
                                                  [minHeight]="100"
                                                  [disabled]="isReadOnly">
                                    </dx-text-area>
                                </div>
                                <div>
                                    <label>{{ls.l('Description')}} Html <img class="info" src="assets/common/icons/info-circle.svg"></label>
                                    <dx-text-area name="descriptionHtml"
                                                  width="100%"
                                                  [inputAttr]="{ id: 'descriptionHtml' }"
                                                  [(value)]="product.descriptionHtml"
                                                  [autoResizeEnabled]="true"
                                                  [maxLength]="8192"
                                                  [maxHeight]="150"
                                                  [minHeight]="100"
                                                  [disabled]="isReadOnly">
                                    </dx-text-area>
                                </div>
                            </div>
                            <div class="block">
                                <div class="options-header">
                                    <h3>
                                        {{ls.l('Price settings')}} <img class="info" src="assets/common/icons/info-circle.svg">
                                    </h3>

                                    <div *ngIf="!isReadOnly && !isOneTime" class="add-new-button button-text" [matMenuTriggerFor]="beforeMenu"><span>+ Add Pricing Plan</span></div>
                                    <mat-menu #beforeMenu="matMenu" xPosition="before" class="product-option-menu">
                                        <button mat-menu-item (click)="addNewPriceOption(priceOptionType.Subscription)">Subscription</button>
                                        <button mat-menu-item *ngIf="product.type != productType.Subscription" (click)="addNewPriceOption(priceOptionType.OneTime)">One-time</button>
                                    </mat-menu>
                                </div>
                                <hr class="wide">
                                <div class="currency-block">
                                    <label>Currency</label>
                                    <currency-selector [(currency)]="product.currencyId"
                                                       [disabled]="isReadOnly || product.hasIncompletedInvoices || product.hasExternalReference"
                                                       (onCurrencyChanged)="onCurrencyChanged($event)">
                                    </currency-selector>
                                </div>
                                <div class="price-tabs">
                                    <div class="no-prices" *ngIf="!product.priceOptions.length" (click)="addNewPriceOption(product.type == productType.Subscription ? priceOptionType.Subscription : priceOptionType.OneTime)">+ Add Pricing Plan</div>
                                    <dx-tabs *ngIf="product.priceOptions.length > 1"
                                             [dataSource]="priceOptionTabs"
                                             [(selectedIndex)]="selectedTabIndex"
                                             [scrollByContent]="true"
                                             [focusStateEnabled]="false"
                                             [hoverStateEnabled]="false">
                                    </dx-tabs>
                                    <div class="price-tab collapse" *ngFor="let priceOption of product.priceOptions; let i = index" [ngClass]="selectedTabIndex == i ? 'show' : ''">
                                        <div class="position-relative">
                                            <div class="price-option-archived" *ngIf="priceOption.isArchived">Archived</div>
                                            <div *ngIf="!isReadOnly" class="add-new-button" [matMenuTriggerFor]="beforeMenu"><span>...</span></div>
                                            <mat-menu #beforeMenu="matMenu" xPosition="before" class="product-option-menu">
                                                <button mat-menu-item (click)="toggelPriceOptionArchived(priceOption)">{{ priceOption.isArchived ? 'Unarchive' : 'Archive' }}</button>
                                                <button mat-menu-item [disabled]="priceOption.hasInvoices" (click)="removePriceOption(i)">Remove price</button>
                                            </mat-menu>
                                            <inplace-edit [(value)]="priceOption.name"
                                                          [maxLength]="256"
                                                          showInlineEditButton="true"
                                                          lEntityName="DisplayName"
                                                          [editPlaceholder]="ls.l('DisplayName')"
                                                          (valueChanged)="priceOptionNameChanged(priceOption, i, $event)">
                                            </inplace-edit>
                                            <div *ngIf="product.type != productType.Donation" class="slider-wrapper">
                                                <div class="state-slider point">
                                                    <div class="captions">
                                                        <div [ngClass]="{active: priceOption.isFreePriceType}" (click)="togglePriceType(priceOption)">{{ ls.l('Free') }}</div>
                                                        <div [ngClass]="{active: !priceOption.isFreePriceType}" (click)="togglePriceType(priceOption)">{{ ls.l('Paid') }}</div>
                                                    </div>
                                                    <mat-slider [value]="getSliderValue(priceOption)"
                                                                [disabled]="true">
                                                    </mat-slider>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="general-product" *ngIf="priceOption.type == priceOptionType.OneTime">
                                            <div class="general-product-price">
                                                <div [ngClass]="{disabled: priceOption.isFreePriceType}">
                                                    <dx-number-box name="price"
                                                                   width="100%"
                                                                   height="65px"
                                                                   class="label"
                                                                   [placeholder]="priceOption.customerChoosesPrice ? ls.l('Preset Price') : ls.l('Price')"
                                                                   [format]="priceOption.isFreePriceType ? amountFormat : amountNullableFormat"
                                                                   [(value)]="priceOption.fee"
                                                                   [disabled]="isReadOnly || priceOption.isArchived"
                                                                   (onValueChanged)="checkShowAmountChangeWarrning(priceOption)">
                                                        <dx-validator>
                                                            <dxi-validation-rule type="custom" [validationCallback]="validateGeneralPrice(priceOption)" message="{{ls.l('InvalidField', ls.l('Price'))}}."></dxi-validation-rule>
                                                        </dx-validator>
                                                    </dx-number-box>
                                                </div>
                                                <div *ngIf="product.type != productType.Donation">
                                                    <dx-select-box [dataSource]="getProductUnits()"
                                                                   width="100%"
                                                                   [placeholder]="ls.l('Unit')"
                                                                   [(value)]="priceOption.unit"
                                                                   [disabled]="isReadOnly || priceOption.isArchived"
                                                                   (onValueChanged)="priceOptionNameChanged(priceOption, i)">
                                                        <dx-validator>
                                                            <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Unit'))}}."></dxi-validation-rule>
                                                        </dx-validator>
                                                    </dx-select-box>
                                                </div>
                                                <div *ngIf="product.type != productType.Donation">
                                                    <dx-number-box name="commissionableAmount"
                                                                   width="100%"
                                                                   height="65px"
                                                                   class="label commissionable-amount"
                                                                   [placeholder]="ls.l('CommissionableAmount')"
                                                                   [format]="amountNullableFormat"
                                                                   [(value)]="priceOption.commissionableFeeAmount"
                                                                   [disabled]="isReadOnly || priceOption.isArchived">
                                                    </dx-number-box>
                                                </div>
                                                <div *ngIf="hasViewCredits && product.type != productType.Donation">
                                                    <dx-number-box width="100%"
                                                                   [placeholder]="ls.l('Credits')"
                                                                   min="0"
                                                                   format="#"
                                                                   height="65px"
                                                                   class="label"
                                                                   [(value)]="priceOption.credits"
                                                                   [disabled]="isReadOnly || priceOption.isArchived || !hasManageCredits || priceOption.customerChoosesPrice">
                                                    </dx-number-box>
                                                </div>
                                            </div>
                                            <div class="general-product-price customer-price">
                                                <div>
                                                    <dx-switch switchedOffText=""
                                                               switchedOnText=""
                                                               [(value)]="priceOption.customerChoosesPrice"
                                                               (onValueChanged)="priceOption.credits = priceOption.minCustomerPrice = priceOption.maxCustomerPrice = null"
                                                               [disabled]="isReadOnly || priceOption.isArchived || priceOption.isFreePriceType || (product.type != productType.Donation && (priceOption.stripeXref || priceOption.paypalXref))">
                                                    </dx-switch><span>{{ls.l('Customer chooses price')}}</span>
                                                </div>
                                                <dx-number-box name="minCustomerPrice"
                                                               width="100%"
                                                               height="65px"
                                                               class="label"
                                                               [placeholder]="ls.l('Min Price')"
                                                               [format]="amountNullableFormat"
                                                               [min]="0"
                                                               [max]="priceOption.maxCustomerPrice ? priceOption.maxCustomerPrice - 1 : null"
                                                               [(value)]="priceOption.minCustomerPrice"
                                                               [disabled]="isReadOnly || priceOption.isArchived || !priceOption.customerChoosesPrice">
                                                </dx-number-box>
                                                <dx-number-box name="maxCustomerPrice"
                                                               width="100%"
                                                               height="65px"
                                                               class="label"
                                                               [placeholder]="ls.l('Max Price')"
                                                               [format]="amountNullableFormat"
                                                               [min]="priceOption.minCustomerPrice ? priceOption.minCustomerPrice + 1 : 0"
                                                               [(value)]="priceOption.maxCustomerPrice"
                                                               [disabled]="isReadOnly || priceOption.isArchived || !priceOption.customerChoosesPrice">
                                                </dx-number-box>
                                            </div>
                                        </div>
                                        <ng-container *ngIf="priceOption.type == priceOptionType.Subscription">
                                            <div class="options">
                                                <div class="option">
                                                    <div class="option-row width-50">
                                                        <div [ngClass]="{disabled: priceOption.isFreePriceType}">
                                                            <label class="wide">{{ls.l('Subscription fee')}}</label>
                                                            <dx-number-box name="price"
                                                                           width="100%"
                                                                           [format]="priceOption.customerChoosesPrice ? amountNullableFormat : amountFormat"
                                                                           [(value)]="priceOption.fee"
                                                                           [disabled]="isReadOnly || priceOption.isArchived"
                                                                           (onValueChanged)="checkShowAmountChangeWarrning(priceOption)">
                                                                <dx-validator>
                                                                    <dxi-validation-rule type="custom" [validationCallback]="validateFee(priceOption)" message="{{ls.l('InvalidField', ls.l('Fee'))}}."></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-number-box>
                                                        </div>
                                                        <div [ngClass]="{disabled: !isCommissionsEnabled || priceOption.isFreePriceType}">
                                                            <label class="wide">{{ls.l('CommissionableAmount')}}</label>
                                                            <dx-number-box name="commissionableFeeAmount"
                                                                           width="100%"
                                                                           [format]="amountNullableFormat"
                                                                           [(value)]="priceOption.commissionableFeeAmount"
                                                                           [disabled]="isReadOnly || priceOption.isArchived || product.type == productType.Donation">
                                                            </dx-number-box>
                                                        </div>
                                                        <div *ngIf="hasViewCredits">
                                                            <label class="wide">{{ls.l('Credits')}}</label>
                                                            <dx-number-box width="100%"
                                                                           min="0"
                                                                           format="#"
                                                                           [(value)]="priceOption.credits"
                                                                           [disabled]="isReadOnly || priceOption.isArchived || !hasManageCredits || priceOption.customerChoosesPrice || product.type == productType.Donation">
                                                            </dx-number-box>
                                                        </div>
                                                    </div>
                                                    <div class="option-row periods">
                                                        <div>
                                                            <dx-select-box name="name"
                                                                           [dataSource]="getFrequencies(priceOption.isFreePriceType)"
                                                                           [placeholder]="ls.l('PaymentPeriod')"
                                                                           [(value)]="priceOption.frequency"
                                                                           [disabled]="isReadOnly || priceOption.isArchived"
                                                                           (onValueChanged)="onFrequencyChanged($event, priceOption, customPeriodValidator, i)">
                                                                <dx-validator>
                                                                    <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('PaymentPeriod'))}}."></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-select-box>
                                                        </div>
                                                        <div [ngClass]="{disabled: !(priceOption.frequency && priceOption.frequency == recurringPaymentFrequency.Custom)}">
                                                            <dx-select-box name="name"
                                                                           [dataSource]="customPeriodTypes"
                                                                           [placeholder]="ls.l('Period Type')"
                                                                           [(value)]="priceOption.customPeriodType"
                                                                           [disabled]="isReadOnly || priceOption.isArchived">
                                                                <dx-validator #customPeriodValidator>
                                                                    <dxi-validation-rule [type]="priceOption.frequency && priceOption.frequency == recurringPaymentFrequency.Custom ? 'required' : 'custom'" message="{{ls.l('RequiredField', ls.l('Type'))}}." [validationCallback]="disabledValidationCallback"></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-select-box>
                                                        </div>
                                                        <div [ngClass]="{disabled: !(isOneTime || (priceOption.frequency && priceOption.frequency == recurringPaymentFrequency.Custom))}">
                                                            <dx-number-box name="period"
                                                                           [min]="0"
                                                                           mode="number"
                                                                           format="###0"
                                                                           class="label"
                                                                           valueChangeEvent="keyup"
                                                                           [placeholder]="ls.l('Set number of ') + (priceOption.customPeriodType?.toLowerCase() || 'period')"
                                                                           [(value)]="priceOption.customPeriodCount"
                                                                           [disabled]="isReadOnly || priceOption.isArchived">
                                                                <dx-validator>
                                                                    <dxi-validation-rule type="custom" [validationCallback]="validatePeriodDayCount(priceOption)" message="{{ls.l('RequiredField', ls.l('Period'))}}."></dxi-validation-rule>
                                                                    <dxi-validation-rule type="custom" [validationCallback]="validateCustomPeriodDayCount(priceOption)" message="{{ls.l('CustomBillingPeriodLengthError')}}."></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-number-box>
                                                        </div>
                                                    </div>
                                                    <div class="option-row customer-price">
                                                        <div>
                                                            <dx-switch switchedOffText=""
                                                                       switchedOnText=""
                                                                       [(value)]="priceOption.customerChoosesPrice"
                                                                       (onValueChanged)="priceOption.credits = priceOption.signUpCredits = priceOption.minCustomerPrice = priceOption.maxCustomerPrice = null"
                                                                       [disabled]="isReadOnly || priceOption.isArchived || priceOption.isFreePriceType || (product.type != productType.Donation && (priceOption.stripeXref || priceOption.paypalXref))">
                                                            </dx-switch><span>{{ls.l('Customer chooses price')}}</span>
                                                        </div>
                                                        <dx-number-box width="100%"
                                                                       height="65px"
                                                                       class="label"
                                                                       [placeholder]="ls.l('Min Price')"
                                                                       [format]="amountNullableFormat"
                                                                       [min]="0"
                                                                       [max]="priceOption.maxCustomerPrice ? priceOption.maxCustomerPrice - 1 : null"
                                                                       [(value)]="priceOption.minCustomerPrice"
                                                                       [disabled]="isReadOnly || priceOption.isArchived || !priceOption.customerChoosesPrice">
                                                        </dx-number-box>
                                                        <dx-number-box width="100%"
                                                                       height="65px"
                                                                       class="label"
                                                                       [placeholder]="ls.l('Max Price')"
                                                                       [format]="amountNullableFormat"
                                                                       [min]="priceOption.minCustomerPrice ? priceOption.minCustomerPrice + 1 : 0"
                                                                       [(value)]="priceOption.maxCustomerPrice"
                                                                       [disabled]="isReadOnly || priceOption.isArchived || !priceOption.customerChoosesPrice">
                                                        </dx-number-box>
                                                    </div>
                                                    <div class="option-row width-50" [ngClass]="{disabled: priceOption.isFreePriceType || !priceOption.frequency || isOneTime || priceOption.frequency == recurringPaymentFrequency.LifeTime }">
                                                        <div>
                                                            <dx-select-box name="name"
                                                                           [dataSource]="billingCyclesEnable"
                                                                           [placeholder]="ls.l('Billing cycles')"
                                                                           valueExpr="key"
                                                                           displayExpr="displayValue"
                                                                           [(value)]="priceOption.billingCyclesEnabled"
                                                                           [disabled]="isReadOnly || priceOption.isArchived"
                                                                           (onValueChanged)="priceOption.cycles = priceOption.billingCyclesEnabled ? priceOption.cycles : undefined">
                                                            </dx-select-box>
                                                        </div>
                                                        <div [ngClass]="{disabled: !priceOption.billingCyclesEnabled}">
                                                            <dx-number-box name="cycles"
                                                                           [min]="1"
                                                                           [max]="999"
                                                                           mode="number"
                                                                           format="###0"
                                                                           class="label"
                                                                           valueChangeEvent="keyup"
                                                                           [placeholder]="ls.l('Set number of cycles')"
                                                                           [(value)]="priceOption.cycles"
                                                                           [disabled]="isReadOnly || priceOption.isArchived">
                                                                <dx-validator>
                                                                    <dxi-validation-rule [type]="priceOption.billingCyclesEnabled ? 'required' : 'custom'" [validationCallback]="disabledValidationCallback" message="{{ls.l('RequiredField', ls.l('Cycles'))}}."></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-number-box>
                                                        </div>
                                                    </div>
                                                    <div class="option-row width-50">
                                                        <div [ngClass]="{disabled: priceOption.isFreePriceType || !priceOption.frequency || isOneTime || product.type == productType.Donation}">
                                                            <label class="wide">{{ls.l('SignupFee')}}</label>
                                                            <dx-number-box name="price"
                                                                           width="100%"
                                                                           [format]="amountFormat"
                                                                           [(value)]="priceOption.signupFee"
                                                                           [disabled]="isReadOnly || priceOption.isArchived"
                                                                           (onValueChanged)="checkShowAmountChangeWarrning(priceOption)">
                                                                <dx-validator>
                                                                    <dxi-validation-rule [type]="priceOption.frequency && !isOneTime && priceOption.trialDayCount ? 'required' : 'custom'" [validationCallback]="disabledValidationCallback" message="{{ls.l('RequiredField', ls.l('SignupFee'))}}."></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-number-box>
                                                        </div>
                                                        <div [ngClass]="{disabled: priceOption.isFreePriceType || !priceOption.frequency || isOneTime || !isCommissionsEnabled || product.type == productType.Donation}">
                                                            <label class="wide">{{ls.l('CommissionableAmount')}}</label>
                                                            <dx-number-box name="commissionableSignupFeeAmount"
                                                                           width="100%"
                                                                           [format]="amountNullableFormat"
                                                                           [(value)]="priceOption.commissionableSignupFeeAmount"
                                                                           [disabled]="isReadOnly || priceOption.isArchived">
                                                            </dx-number-box>
                                                        </div>
                                                        <div *ngIf="hasViewCredits" [ngClass]="{disabled: priceOption.isFreePriceType || !priceOption.frequency || isOneTime || product.type == productType.Donation}">
                                                            <label class="wide">{{ls.l('Sign Up Credits')}}</label>
                                                            <dx-number-box width="100%"
                                                                           min="0"
                                                                           format="#"
                                                                           [(value)]="priceOption.signUpCredits"
                                                                           [disabled]="isReadOnly || priceOption.isArchived || !hasManageCredits || priceOption.customerChoosesPrice">
                                                            </dx-number-box>
                                                        </div>
                                                    </div>
                                                    <div class="option-row width-50">
                                                        <div [ngClass]="{disabled: priceOption.isFreePriceType || !priceOption.frequency || isOneTime || product.type == productType.Donation}">
                                                            <label class="wide" for="level">
                                                                <dx-switch #trialSwitch
                                                                           switchedOffText=""
                                                                           switchedOnText=""
                                                                           [(value)]="priceOption.trialEnabled"
                                                                           [disabled]="isReadOnly || priceOption.isArchived">
                                                                </dx-switch>&nbsp;<span (click)="priceOption.trialEnabled = !priceOption.trialEnabled">{{ls.l('Add Trial Period')}}</span>
                                                            </label>
                                                            <dx-number-box name="count"
                                                                           [min]="0"
                                                                           mode="number"
                                                                           format="###0"
                                                                           width="100%"
                                                                           valueChangeEvent="keyup"
                                                                           [placeholder]="ls.l('ByDefault', 0)"
                                                                           [(value)]="priceOption.trialDayCount"
                                                                           [disabled]="isReadOnly || priceOption.isArchived || !priceOption.trialEnabled">
                                                            </dx-number-box>
                                                        </div>
                                                        <div [ngClass]="{disabled: priceOption.isFreePriceType || !priceOption.frequency || product.type == productType.Donation}">
                                                            <label class="wide gracePeriodDayCount" for="gracePeriodDayCount">
                                                                <dx-switch switchedOffText=""
                                                                           switchedOnText=""
                                                                           [(value)]="priceOption.gracePeriodEnabled"
                                                                           [disabled]="isReadOnly || priceOption.isArchived">
                                                                </dx-switch>&nbsp;<span (click)="priceOption.gracePeriodEnabled = !priceOption.gracePeriodEnabled">{{ls.l('Custom Grace Period')}}</span>
                                                            </label>
                                                            <dx-number-box name="gracePeriodDayCount"
                                                                           [placeholder]="ls.l('ByDefault', gracePeriodDefaultValue ? gracePeriodDefaultValue : 0)"
                                                                           [min]="0"
                                                                           format="###0"
                                                                           mode="number"
                                                                           [(value)]="priceOption.gracePeriodDayCount"
                                                                           [disabled]="isReadOnly || priceOption.isArchived || !priceOption.gracePeriodEnabled">
                                                            </dx-number-box>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="priceOption.id">
                                            <hr>
                                            <div class="option-ids">
                                                <div *ngIf="priceOption.id" class="option-id">
                                                    <label>Price Id</label>
                                                    <div class="clipboard-holder">{{priceOption.id}} <i class="save-to-clipboard" (click)="copyTextToClipboard(priceOption.id)"></i></div>
                                                </div>
                                                <div *ngIf="priceOption.stripeXref">
                                                    <label>Stripe Xref</label>
                                                    <div class="clipboard-holder wrap-text">
                                                        <ng-container *ngIf="priceOption.stripeXrefUrl; else plainOptionStripeXref">
                                                            <a [href]="priceOption.stripeXrefUrl" target="_blank">{{priceOption.stripeXref}}</a>
                                                        </ng-container>
                                                        <ng-template #plainOptionStripeXref><span>{{priceOption.stripeXref}}</span></ng-template>
                                                        <i class="save-to-clipboard" (click)="copyTextToClipboard(priceOption.stripeXref)"></i>
                                                    </div>
                                                </div>
                                                <div *ngIf="priceOption.paypalXref">
                                                    <label>Paypal Xref</label>
                                                    <div class="clipboard-holder wrap-text"><span>{{priceOption.paypalXref}}</span><i class="save-to-clipboard" (click)="copyTextToClipboard(priceOption.paypalXref)"></i></div>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                            <div class="block donation-type" *ngIf="product.type == productType.Donation">
                                <h3>{{ls.l('Donation options')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <hr>
                                <div class="donation-options">
                                    <div>
                                        <label>{{ls.l('Donation Goal Amount')}}</label>
                                        <dx-number-box name="donationGoalAmount"
                                                       width="100%"
                                                       [format]="amountNullableFormat"
                                                       [(value)]="product.productDonation.goalAmount"
                                                       [disabled]="isReadOnly">
                                        </dx-number-box>
                                    </div>
                                    <div>
                                        <dx-switch switchedOffText=""
                                                   switchedOnText=""
                                                   [(value)]="product.productDonation.keepActiveIfGoalReached"
                                                   [disabled]="isReadOnly">
                                        </dx-switch>
                                        <span class="always-active-goal">{{ls.l('Keep active if the goal is reached')}}</span>
                                    </div>
                                </div>
                                <hr>
                                <div class="options-header">
                                    <h3>{{ls.l('Defined amounts')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                    <div *ngIf="!isReadOnly" class="add-new-button" (click)="addNewSuggestedAmountFields()"><span>+</span></div>
                                </div>
                                <div class="suggested-amounts options" *ngFor="let suggestedAmount of product.productDonation.productDonationSuggestedAmounts; let i = index">
                                    <div *ngIf="!isReadOnly" class="remove-button" (click)="removeSuggestedAmountFields(i)"><span>-</span></div>
                                    <div class="field-wrapper">
                                        <div class="field-50">
                                            <dx-number-box width="100%"
                                                           [placeholder]="ls.l('Amount')"
                                                           [format]="amountNullableFormat"
                                                           [(value)]="suggestedAmount.amount"
                                                           [disabled]="isReadOnly">
                                                <dx-validator>
                                                    <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Amount'))}}."></dxi-validation-rule>
                                                </dx-validator>
                                            </dx-number-box>
                                        </div>
                                        <div class="field-50">
                                            <dx-text-box width="100%"
                                                         [maxLength]="256"
                                                         [placeholder]="ls.l('Text')"
                                                         [(value)]="suggestedAmount.text"
                                                         [disabled]="isReadOnly">
                                                <dx-validator>
                                                    <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Text'))}}."></dxi-validation-rule>
                                                </dx-validator>
                                            </dx-text-box>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="block" *ngIf="product.type != productType.Donation && isCommissionsEnabled">
                                <h3>{{ls.l('Commission Calculations')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <hr>
                                <div [ngClass]="{disabled: !enableCommissions || isReadOnly}">
                                    <div class="commissions">
                                        <div>
                                            <label>{{ls.l('Tier 1 Max Commission Rate')}}</label>
                                            <dx-number-box name="maxCommissionRate"
                                                           width="100%"
                                                           format="#.##%"
                                                           [(value)]="product.maxCommissionRate"
                                                           [disabled]="isReadOnly">
                                            </dx-number-box>
                                        </div>
                                        <div>
                                            <label>{{ls.l('Tier 2 Max Commission Rate')}}</label>
                                            <dx-number-box name="maxCommissionRate2"
                                                           width="100%"
                                                           format="#.##%"
                                                           [(value)]="product.maxCommissionRateTier2"
                                                           [disabled]="isReadOnly">
                                            </dx-number-box>
                                        </div>
                                    </div>
                                    <div *ngIf="isProductAddOnsEnabled && product.type != productType.Subscription">
                                        <dx-switch switchedOffText=""
                                                   switchedOnText=""
                                                   [(value)]="product.enableAddOnCommissions"
                                                   [disabled]="isReadOnly">
                                        </dx-switch><span class="enable-commissions" (click)="!isReadOnly && product.enableAddOnCommissions = !product.enableAddOnCommissions">{{ls.l('Enable commissions for Add-On options')}}</span>
                                    </div>
                                </div>
                                <hr>
                                <dx-switch switchedOffText=""
                                           switchedOnText=""
                                           [(value)]="enableCommissions"
                                           [disabled]="isReadOnly">
                                </dx-switch><span class="enable-commissions" (click)="!isReadOnly && enableCommissions = !enableCommissions">{{ls.l(enableCommissions ? 'Disable': 'Enable')}} {{ls.l('Commissions')}}</span>
                                <p class="enable-commissions-info">{{ls.l('This product will be included in the commissions calculations for your affiliates, resellers and partners')}}</p>
                            </div>
                            <div class="block options" *ngIf="product.type != productType.Donation">
                                <h3>{{ls.l('Taxation')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <hr>
                                <p *ngIf="!product.stripeIsTaxationEnabled">{{ls.l('Automatic Taxation is disabled on Stripe Account')}}</p>
                                <dx-switch switchedOffText=""
                                           switchedOnText=""
                                           [(value)]="product.isStripeTaxationEnabled"
                                           [disabled]="isReadOnly">
                                </dx-switch><span class="enable-inventory"> {{ls.l('Automatic Taxation Enable')}}</span>
                                <br /><br />
                                <div *ngIf="product.isStripeTaxationEnabled">
                                    <dx-select-box #stripeProductTaxCodeSelect
                                                   [inputAttr]="{readonly: 'readonly'}"
                                                   [disabled]="isReadOnly"
                                                   valueExpr="id"
                                                   displayExpr="name"
                                                   [showClearButton]="false"
                                                   [placeholder]="ls.l('Select Product Tax Code')"
                                                   [(value)]="product.stripeTaxProcuctCode"
                                                   [dataSource]="productTaxCodeDataSource"
                                                   [searchEnabled]="true"
                                                   [searchTimeout]="500"
                                                   (onValueChanged)="checkShowAmountChangeWarrning()">
                                        <div *dxTemplate="let cell of 'item'">
                                            <span [title]="cell.name">{{cell.name }}</span>
                                        </div>
                                    </dx-select-box>
                                </div>
                            </div>
                            <div class="block options" *ngIf="product.type != productType.Donation">
                                <h3>{{ls.l('Inventory')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <hr>
                                <dx-switch switchedOffText=""
                                           switchedOnText=""
                                           [(value)]="product.productInventory.isActive"
                                           [disabled]="isReadOnly">
                                </dx-switch><span class="enable-inventory"> {{ls.l('Track quantity')}}</span>
                                <div class="option" *ngIf="product.productInventory.isActive">
                                    <br />
                                    <label class="wide">{{ls.l('Actual Quantity')}}</label>
                                    <div class="option-row width-50">
                                        <div>
                                            <div *ngIf="storedCurrentQuantity == undefined">
                                                <dx-number-box name="initialQuantity"
                                                               [(value)]="product.productInventory.initialQuantity"
                                                               [format]="product.type == productType.General ? '#,##0.##' : '#,##0'"
                                                               [disabled]="isReadOnly">
                                                    <dx-validator>
                                                        <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Quantity'))}}."></dxi-validation-rule>
                                                    </dx-validator>
                                                </dx-number-box>
                                            </div>
                                            <div *ngIf="storedCurrentQuantity != undefined">
                                                <dx-number-box name="storedCurrentQuantity"
                                                               [(value)]="storedCurrentQuantity"
                                                               [format]="product.type == productType.General ? '#,##0.##' : '#,##0'"
                                                               [disabled]="true">
                                                </dx-number-box>
                                            </div>
                                        </div>
                                        <div class="option-cell">
                                            <dx-switch switchedOffText=""
                                                       switchedOnText=""
                                                       [(value)]="product.productInventory.canSellOutOfStock"
                                                       [disabled]="isReadOnly">
                                            </dx-switch><span class="enable-inventory"> {{ls.l('Can sell out of stock')}}</span>
                                        </div>
                                    </div>
                                    <div *ngIf="storedCurrentQuantity != undefined">
                                        <div class="inventory-topup">
                                            <dx-number-box name="topupQuantity"
                                                           width="80%"
                                                           [placeholder]="ls.l('Topup')"
                                                           [(value)]="topupQuantity"
                                                           [format]="product.type == productType.General ? '#,###.##' : '#,###'"
                                                           [disabled]="isReadOnly">
                                            </dx-number-box>
                                            <div class="add-button" (click)="addInventoryTopup()">{{ls.l('Add')}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="block options addOn-block" *ngIf="isProductAddOnsEnabled && (product.type == productType.General || product.type == productType.Event || product.type == productType.Digital)">
                                <div class="options-header">
                                    <h3>{{ls.l('Add-Ons')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                    <div *ngIf="!isReadOnly" class="add-new-button" (click)="addNewAddOn()"><span>+</span></div>
                                </div>
                                <hr class="wide">
                                <div *ngIf="!product.productAddOns || !product.productAddOns.length; else addOns" class="addon-hint">
                                    <p>Add-Ons Overview:</p>
                                    <p>Enhance your products with optional features, variations, or upgrades using Add-Ons. This functionality allows you to offer additional choices such as different sizes, flavors, or extra services for an additional cost.</p>
                                    <p>Customers can select from multiple options within each Add-On, and you can choose whether a selection is required. Perfect for customizable products, this feature improves flexibility and increases potential revenue.</p>
                                </div>
                                <ng-template #addOns>
                                    <div class="options" *ngFor="let addOn of product.productAddOns; let i = index">
                                        <div *ngIf="!isReadOnly" class="remove-button" (click)="removeAddOn(i)"><span>-</span></div>
                                        <div class="addOn-header">
                                            <label>{{ls.l('Add-On Option Name')}}</label>
                                            <dx-select-box class="hide-placeholder"
                                                           [dataSource]="addOnSelectionTypes"
                                                           valueExpr="key"
                                                           displayExpr="displayValue"
                                                           [(value)]="addOn.multiselect"
                                                           [disabled]="isReadOnly">
                                            </dx-select-box>
                                            <div class="required-switch">
                                                <label>{{ls.l('Required')}}</label>
                                                <dx-switch switchedOffText=""
                                                           switchedOnText=""
                                                           [(value)]="addOn.required"
                                                           [disabled]="isReadOnly">
                                                </dx-switch>
                                            </div>
                                        </div>
                                        <div>
                                            <dx-text-box width="100%"
                                                         [maxLength]="256"
                                                         [(value)]="addOn.name"
                                                         [disabled]="isReadOnly">
                                                <dx-validator>
                                                    <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Name'))}}."></dxi-validation-rule>
                                                </dx-validator>
                                            </dx-text-box>
                                        </div>
                                        <div>
                                            <div class="options-header">
                                                <h3>{{ls.l('Add-Ons Options')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                                <div *ngIf="!isReadOnly" class="add-new-button" (click)="addNewAddOnOption(addOn)"><span>+</span></div>
                                            </div>
                                            <div *ngIf="!addOn.productAddOnOptions || !addOn.productAddOnOptions.length; else addOnOptions" class="addon-hint">
                                                <p>
                                                    Create optional features, variations, or add-ons that customers can choose to include with their purchase. This allows for product customization and can increase your average order value.
                                                </p>
                                            </div>
                                            <ng-template #addOnOptions>
                                                <div class="options" *ngFor="let addOnOption of addOn.productAddOnOptions; let j = index">
                                                    <div *ngIf="!isReadOnly" class="remove-button" (click)="removeAddOnOption(addOn, j)"><span>-</span></div>
                                                    <div class="field-wrapper">
                                                        <div class="field-50">
                                                            <dx-text-box width="100%"
                                                                         [maxLength]="256"
                                                                         [placeholder]="ls.l('Name')"
                                                                         [(value)]="addOnOption.name"
                                                                         [disabled]="isReadOnly">
                                                                <dx-validator>
                                                                    <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Name'))}}."></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-text-box>
                                                        </div>
                                                        <div class="field-50">
                                                            <dx-number-box width="100%"
                                                                           [placeholder]="ls.l('Price')"
                                                                           [format]="amountFormat"
                                                                           min="0"
                                                                           [(value)]="addOnOption.price"
                                                                           [disabled]="isReadOnly">
                                                                <dx-validator>
                                                                    <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Price'))}}."></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-number-box>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </div>
                                        <hr />
                                    </div>
                                </ng-template>
                            </div>
                            <div class="block" *ngIf="false">
                                <h3>{{ls.l('Stock')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                            </div>
                            <div class="block" *ngIf="false">
                                <h3>{{ls.l('Variants')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                            </div>
                            <div class="block" *ngIf="false">
                                <h3>{{ls.l('Shipping')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                            </div>
                            <div class="block event-type" *ngIf="product.type == productType.Event">
                                <h3>{{ls.l('Location')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <p class="small-gray">Help people in the area discover your event and let attendees know where to show up.</p>
                                <div>
                                    <button class="btn btn-outline-dark"
                                            [class.active]="product.productEvent.location == eventLocation.Online"
                                            (click)="product.productEvent.location = eventLocation.Online"
                                            [disabled]="isReadOnly">
                                        <i class="fa fa-laptop"></i> Online
                                    </button>
                                    <button class="btn btn-outline-dark"
                                            [class.active]="product.productEvent.location == eventLocation.InPerson"
                                            (click)="product.productEvent.location = eventLocation.InPerson"
                                            [disabled]="isReadOnly">
                                        <i class="fa fa-map-marker"></i> In-Person
                                    </button>
                                    <button class="btn btn-outline-dark"
                                            [class.active]="product.productEvent.location == eventLocation.ToBeAnnounced"
                                            (click)="product.productEvent.location = eventLocation.ToBeAnnounced"
                                            [disabled]="isReadOnly">
                                        <i class="fa fa-bullhorn"></i> To be announced
                                    </button>
                                </div>
                                <p>Venue location</p>
                                <div class="edit-address" [class.placeholder]="!eventAddress" (click)="editAddress()">
                                    {{ eventAddress ? eventAddress : ls.l('Search for venue location or address')}}
                                    <i *ngIf="!isReadOnly && eventAddress" (click)="clearAddress($event)" class="fa fa-times"></i>
                                </div>
                                <dx-text-box [(value)]="product.productEvent.link"
                                             height="65px"
                                             [placeholder]="ls.l('Add link for Zoom, Google Meet, Twitch etc.')"
                                             [disabled]="isReadOnly">
                                    <dx-validator>
                                        <dxi-validation-rule type="pattern"
                                                             [pattern]="urlRegexPattern"
                                                             [message]="ls.l('InvalidFieldValue', 'Link Name')">
                                        </dxi-validation-rule>
                                    </dx-validator>
                                </dx-text-box>
                                <h3>{{ls.l('Date and time')}}</h3>
                                <p class="small-gray">Tell event-goers when your event starts and ends so they can make plans to attend.</p>
                                <div>
                                    <button class="btn btn-primary">Single Event</button>
                                    <button class="btn btn-primary" disabled>Recurring Event</button>
                                </div>
                                <p class="small-gray">Single event happens once and can last multiple days</p>
                                <div class="row">
                                    <div class="col-3">
                                        <label>Date</label>
                                        <dx-date-box [(value)]="eventDate"
                                                     type="date"
                                                     height="65px"
                                                     [placeholder]="ls.l('Enter date')"
                                                     [showClearButton]="true"
                                                     [disabled]="isReadOnly">
                                        </dx-date-box>
                                    </div>
                                    <div class="col-3">
                                        <label>Time</label>
                                        <dx-date-box [(value)]="eventTime"
                                                     type="time"
                                                     [placeholder]="ls.l('Select...')"
                                                     [showClearButton]="true"
                                                     [disabled]="isReadOnly">
                                        </dx-date-box>
                                    </div>
                                    <div class="col-3">
                                        <label>Duration</label>
                                        <dx-number-box [placeholder]="ls.l('Duration')"
                                                       height="65px"
                                                       [(value)]="eventDuration"
                                                       (onValueChanged)="eventDurationType = eventDurationType || eventDurationTypes[0].value"
                                                       [disabled]="isReadOnly">
                                        </dx-number-box>
                                    </div>
                                    <div class="col-3">
                                        <label></label>
                                        <dx-select-box class="hide-placeholder"
                                                       [dataSource]="eventDurationTypes"
                                                       displayExpr="displayValue"
                                                       valueExpr="value"
                                                       [(value)]="eventDurationType"
                                                       [showClearButton]="!eventDuration"
                                                       [disabled]="isReadOnly">
                                        </dx-select-box>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <dx-select-box [dataSource]="timezones"
                                                       displayExpr="name"
                                                       valueExpr="value"
                                                       [placeholder]="ls.l('Time Zone')"
                                                       [(value)]="product.productEvent.timezone"
                                                       [disabled]="isReadOnly">
                                        </dx-select-box>
                                    </div>
                                    <div class="col-6">
                                        <dx-select-box [dataSource]="languages"
                                                       displayExpr="name"
                                                       valueExpr="code"
                                                       [placeholder]="ls.l('Event Page Language')"
                                                       [(value)]="product.productEvent.languageId"
                                                       [disabled]="isReadOnly">
                                        </dx-select-box>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="right">
                            <div class="block status">
                                <h3>{{ls.l('Product Status')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <p>
                                    <img class="info" src="assets/common/icons/edit-status.svg"> {{ls.l('Status')}}: <span>{{product.isPublished ? 'Published' : 'Unpublished'}}</span>
                                    <dx-switch switchedOffText=""
                                               switchedOnText=""
                                               [(value)]="product.isPublished"
                                               (valueChange)="onIsPublishedChanged()"
                                               [disabled]="isReadOnly">
                                    </dx-switch>
                                </p>
                                <p>
                                    <img class="info" src="assets/common/icons/calendar3.svg"> {{ls.l('Published on')}}: <span *ngIf="publishDate">{{publishDate | date:'MMM d, y, h:mm a'}} <img *ngIf="!isReadOnly" class="delete" (click)="publishDate=undefined" src="assets/common/icons/delete-icon.svg"></span> <a *ngIf="!isReadOnly" href="javascript:void(0)" (click)="publishDateComponent.instance.open()">Edit</a>
                                    <dx-date-box #publishDateComponent
                                                 type="datetime"
                                                 width="0px"
                                                 height="0px"
                                                 [(value)]="publishDate"
                                                 (onOpened)="onPublishDateOpened()"
                                                 [disabled]="isReadOnly">
                                    </dx-date-box>
                                </p>
                                <hr>
                                <p>
                                    Require user creation <img class="info" src="assets/common/icons/info-circle.svg">
                                    <dx-switch switchedOffText=""
                                               switchedOnText=""
                                               [(value)]="product.createUser"
                                               [disabled]="isReadOnly">
                                    </dx-switch>
                                </p>
                                <p>
                                    Single Purchase <img class="info" src="assets/common/icons/info-circle.svg">
                                    <dx-switch switchedOffText=""
                                               switchedOnText=""
                                               [(value)]="product.singlePurchaseAllowed"
                                               [disabled]="isReadOnly">
                                    </dx-switch>
                                </p>
                                <p>
                                    Allow coupons <img class="info" src="assets/common/icons/info-circle.svg">
                                    <dx-switch switchedOffText=""
                                               switchedOnText=""
                                               [(value)]="product.publicAllowCoupon"
                                               [disabled]="isReadOnly">
                                    </dx-switch>
                                </p>
                                <hr>
                                <p *ngIf="product.stripeXref" class="product-xref clipboard-holder">
                                    Stripe Xref <span>
                                        <ng-container *ngIf="product.stripeXrefUrl; else plainProductStripeXref">
                                            <a [href]="product.stripeXrefUrl" target="_blank">{{product.stripeXref}}</a>
                                        </ng-container>
                                        <ng-template #plainProductStripeXref>{{product.stripeXref}}</ng-template>
                                        <i class="save-to-clipboard" (click)="copyTextToClipboard(product.stripeXref)"></i>
                                    </span>
                                </p>
                                <p *ngIf="product.paypalXref" class="product-xref clipboard-holder">
                                    Paypal Xref <span>{{product.paypalXref}}<i class="save-to-clipboard" (click)="copyTextToClipboard(product.paypalXref)"></i></span>
                                </p>
                            </div>
                            <div class="block">
                                <h3>{{ls.l('Product Logo')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <div class="logo-wrapper">
                                    <img *ngIf="image; else upload" class="product" (click)="openImageSelector()" [src]="getProductImage(true)">
                                </div>
                                <ng-template #upload>
                                    <div class="upload-logo">
                                        <div class="browse-file">
                                            <ngx-file-drop [showBrowseBtn]="true"
                                                           [browseBtnLabel]="ls.l('Browse on your device')"
                                                           (onFileDrop)="fileDropped($event)"
                                                           [disabled]="isReadOnly">
                                            </ngx-file-drop>
                                        </div>
                                        <span>{{ls.l('or')}}</span>
                                        <div class="add-link">
                                            <dx-text-box name="file"
                                                         width="80%"
                                                         [placeholder]="ls.l('Add Link')"
                                                         [inputAttr]="{ id: 'logo' }"
                                                         [(value)]="uploadFileUrl"
                                                         [disabled]="isReadOnly">
                                            </dx-text-box>
                                            <div class="add-button" (click)="addExternalLogo()">{{ls.l('Add')}}</div>
                                        </div>
                                    </div>
                                </ng-template>
                            </div>
                            <div class="block">
                                <h3>{{ls.l('Product Group')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <div *ngIf="!isReadOnly" class="add-group-button" (click)="groupSelectBox.instance.focus()"><span>+ Add</span></div>
                                <div class="options">
                                    <div *ngIf="!isReadOnly" class="remove-button" (click)="product.groupId = undefined"><span>-</span></div>
                                    <div class="upgrade-field">
                                        <dx-select-box #groupSelectBox
                                                       [dataSource]="productGroups"
                                                       [acceptCustomValue]="true"
                                                       width="100%"
                                                       displayExpr="name"
                                                       valueExpr="id"
                                                       placeholder="Select group..."
                                                       [(value)]="product.groupId"
                                                       [disabled]="isReadOnly"
                                                       (onCustomItemCreating)="onCustomGroupCreating($event)">
                                        </dx-select-box>
                                    </div>
                                </div>
                            </div>
                            <div class="block" *ngIf="false">
                                <h3>{{ls.l('Product category')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                            </div>
                            <div class="block" *ngIf="false">
                                <h3>{{ls.l('Product Tags')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                            </div>
                            <div class="block" *ngIf="product.type == productType.Subscription">
                                <ng-container *ngIf="showDowngrade">
                                    <h3>{{ls.l('Downgrade to Option')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                    <div class="options">
                                        <div *ngIf="!isReadOnly" class="remove-button" (click)="product.downgradeProductId = undefined"><span>-</span></div>
                                        <div class="upgrade-field">
                                            <dx-select-box name="name"
                                                           width="100%"
                                                           valueExpr="id"
                                                           displayExpr="name"
                                                           [showClearButton]="false"
                                                           [dataSource]="products$ | async | FilterAssignments:[]:productType.Subscription"
                                                           [placeholder]="ls.l('Select') + ' ' + ls.l('Product') + '...'"
                                                           [(value)]="product.downgradeProductId"
                                                           [disabled]="isReadOnly">
                                            </dx-select-box>
                                        </div>
                                    </div>
                                </ng-container>
                                <div class="options-header">
                                    <h3>{{ls.l('Upgrade to Options')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                    <div *ngIf="!isReadOnly" class="add-new-button" (click)="addUpgradeToProduct()"><span>+</span></div>
                                </div>
                                <div class="options" *ngFor="let option of product.productUpgradeAssignments; let i = index">
                                    <div *ngIf="!isReadOnly" class="remove-button" (click)="removeUpgradeToProduct(i, option)"><span>-</span></div>
                                    <div class="upgrade-field">
                                        <dx-select-box name="name"
                                                       width="100%"
                                                       valueExpr="id"
                                                       displayExpr="name"
                                                       [dataSource]="products$ | async | FilterAssignments: getAssignementIds(option):productType.Subscription"
                                                       [placeholder]="ls.l('Select') + ' ' + ls.l('Product') + '...'"
                                                       [(value)]="option.upgradeProductId"
                                                       [disabled]="isReadOnly">
                                            <dx-validator *ngIf="i">
                                                <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Product'))}}."></dxi-validation-rule>
                                            </dx-validator>
                                        </dx-select-box>
                                    </div>
                                </div>
                                <ng-container *ngIf="hasViewCredits && enableCreditTopUpBySubscription">
                                    <h3>{{ls.l('Credit Top Up Product')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                    <div class="options">
                                        <div *ngIf="!isReadOnly && hasManageCredits" class="remove-button" (click)="product.creditsTopUpProductId = undefined"><span>-</span></div>
                                        <div class="upgrade-field">
                                            <dx-select-box width="100%"
                                                           valueExpr="id"
                                                           displayExpr="name"
                                                           [showClearButton]="false"
                                                           [dataSource]="products$ | async | FilterAssignments:[]:productType.General:null:true"
                                                           [placeholder]="ls.l('Select') + ' ' + ls.l('Product') + '...'"
                                                           [(value)]="product.creditsTopUpProductId"
                                                           [disabled]="isReadOnly || !hasManageCredits">
                                            </dx-select-box>
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                            <div class="block">
                                <div class="options-header">
                                    <h3>{{ls.l('Recommended Products')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                    <div *ngIf="!isReadOnly" class="add-new-button" (click)="addRecommendedProduct()"><span>+</span></div>
                                </div>
                                <div class="options" *ngFor="let option of product.recommendedProducts; let i = index">
                                    <div *ngIf="!isReadOnly" class="remove-button" (click)="removeRecommendedProduct(i, option)"><span>-</span></div>
                                    <div class="upgrade-field">
                                        <dx-select-box name="name"
                                                       width="100%"
                                                       valueExpr="id"
                                                       displayExpr="name"
                                                       [dataSource]="products$ | async | FilterAssignments: getRecommendedIds(option):null:productType.Subscription"
                                                       [placeholder]="ls.l('Select') + ' ' + ls.l('Product') + '...'"
                                                       [(value)]="option.recommendedProductId"
                                                       [disabled]="isReadOnly">
                                            <dx-validator *ngIf="i">
                                                <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Product'))}}."></dxi-validation-rule>
                                            </dx-validator>
                                        </dx-select-box>
                                    </div>
                                </div>
                            </div>
                            <div class="block">
                                <h3>{{ls.l('Redirect Url')}} <img class="info" [title]="ls.l('Enter the web address that you\'d like to send payers to after they\'ve checked out')" src="assets/common/icons/info-circle.svg"></h3>
                                <div class="add-link">
                                    <dx-text-box name="file"
                                                 [placeholder]="ls.l('Default receipt page')"
                                                 [(value)]="product.redirectUrl"
                                                 [disabled]="isReadOnly">
                                        <dx-validator>
                                            <dxi-validation-rule type="pattern"
                                                                 [pattern]="urlRegexPattern"
                                                                 [message]="ls.l('InvalidUrl')">
                                            </dxi-validation-rule>
                                        </dx-validator>
                                    </dx-text-box>
                                </div>
                            </div>
                            <div class="block paid-email-template">
                                <h3>{{ls.l('Product Paid Email Template')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                <div class="options">
                                    <div *ngIf="!isReadOnly" class="remove-button" (click)="product.paidEmailTemplateId = undefined"><span>-</span></div>
                                    <div class="upgrade-field">
                                        <email-template-selector [(templateId)]="product.paidEmailTemplateId"
                                                                 [templateType]="EmailTemplateType.ProductPaid"
                                                                 [showSystemDefault]="false"
                                                                 [title]="ls.l('TemplateName')"
                                                                 [disabled]="isReadOnly">
                                        </email-template-selector>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                    <ng-template #deliverables>
                        <div class="deliverables-container">
                            <div class="deliverables-header">
                                <h3>Fulfillment Options</h3>
                                <p>Configure how your product will be delivered to customers after purchase.</p>
                            </div>
                            <div class="feature-wrapper" *ngFor="let fulfillment of visibleDeliverablesGroups">
                                <h4>{{fulfillment.title}}</h4>
                                <cdk-accordion [multi]="true">
                                    <cdk-accordion-item *ngFor="let item of fulfillment.items; let index = index;"
                                                        #accordionItem="cdkAccordionItem"
                                                        class="accordion-item"
                                                        role="button"
                                                        tabindex="0"
                                                        [attr.id]="'accordion-header-' + index"
                                                        [attr.aria-expanded]="accordionItem.expanded"
                                                        [attr.aria-controls]="'accordion-body-' + index"
                                                        [class.enabled]="deliverablesData.isActiveData[item.id]">
                                        <div class="accordion-item-header">
                                            <div class="accordion-item-header-left">
                                                <lucide-angular [img]="item.icon" class="accordion-item-header-icon" [style.background-color]="item.color + '20'" [color]="item.color"></lucide-angular>
                                                <div class="accordion-item-header-title">
                                                    <h3>{{ item.label }}</h3>
                                                    <p>{{ item.description }}</p>
                                                </div>
                                            </div>
                                            <div class="accordion-item-header-right">
                                                <mat-slide-toggle class="header-toggle"
                                                                  labelPosition="before"
                                                                  [(ngModel)]="deliverablesData.isActiveData[item.id]"
                                                                  [disabled]="isReadOnly"
                                                                  (toggleChange)="deliverablesData.isActiveData[item.id]"></mat-slide-toggle>
                                                <lucide-angular [img]="ChevronIcon" class="accordion-item-header-arrow" (click)="accordionItem.toggle()"></lucide-angular>
                                            </div>
                                        </div>
                                        <div *ngIf="item.component"
                                             [ngSwitch]="item.component"
                                             class="accordion-item-body"
                                             role="region"
                                             [style.display]="accordionItem.expanded ? '' : 'none'"
                                             [attr.id]="'accordion-body-' + index"
                                             [attr.aria-labelledby]="'accordion-header-' + index">
                                            <div class="block" *ngSwitchCase="'digital-upload'">
                                                <h3>{{ls.l('Add digital files')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>

                                                <div class="upload-files">
                                                    <div class="browse-file">
                                                        <ngx-file-drop (onFileDrop)="addResources($event)">
                                                            <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
                                                                <img class="upload" src="assets/common/icons/upload.svg">
                                                                <h3>{{ls.l('Drag & Drop Upload Content')}}</h3>
                                                                <div class="buttons">
                                                                    <button [disabled]="isReadOnly" class="btn btn-layout" (click)="openFileSelector()">{{ls.l('Browse on your computer')}}</button> or <button [disabled]="isReadOnly" class="button-layout button-default" (click)="showDocumentsDialog()">{{ls.l('Select from uploaded')}}</button>
                                                                </div>
                                                                <span>{{ls.l('Upload up to 25 files, each with a maximum size of 100MB or less.')}}<br>{{ls.l('Supported file types: JPG, PNG, MP3, MP4, MOV, DOCX, PDF, ZIP, CSV, TXT, and others.')}}</span>

                                                                <div class="field-area resources" *ngIf="productTemplates.length || productFiles.length">
                                                                    <div *ngFor="let resource of productTemplates; let i = index" class="resource" [ngStyle]="{'background-size': '0%'}">
                                                                        <a target="_blank" [download]="resource.name" [href]="resource.url" (click)="templateClick($event, resource)" class="name">{{resource.name}}</a>&nbsp;<i (click)="removeTemplate(i)" aria-hidden="true" class="delete fa fa-times"></i>
                                                                    </div>

                                                                    <div *ngFor="let resource of productFiles; let i = index" class="resource" [ngClass]="{'progress': !!resource.loader}" [ngStyle]="{'background-size': (resource.progress || 0) + '%'}">
                                                                        <a target="_blank" [download]="resource.name" [href]="resource.url" (click)="fileClick($event, resource)" class="name">{{resource.name}}</a>&nbsp;<i (click)="removeFile(resource, i)" aria-hidden="true" class="delete fa fa-times"></i>
                                                                    </div>
                                                                </div>

                                                            </ng-template>
                                                        </ngx-file-drop>
                                                    </div>
                                                </div>

                                                <div class="share-link">
                                                    <div class="share-link-header">
                                                        <img class="share" src="assets/common/icons/share.svg">
                                                        <h3>{{ls.l('Share a Link')}}</h3>
                                                    </div>
                                                    <p>{{ls.l('Direct your members to YouTube, Google Drive or articles')}}</p>
                                                    <div class="share-add-link">
                                                        <dx-text-box #resourceLinkNameCmp
                                                                     width="30%"
                                                                     height="35px"
                                                                     [(value)]="resourceLinkName"
                                                                     [placeholder]="ls.l('Link Name')"
                                                                     [disabled]="isReadOnly">
                                                            <dx-validator>
                                                                <dxi-validation-rule type="pattern"
                                                                                     [pattern]="nameRegexPattern"
                                                                                     [message]="ls.l('InvalidFieldValue', 'Link Name')">
                                                                </dxi-validation-rule>
                                                            </dx-validator>
                                                        </dx-text-box>
                                                        <dx-text-box #resourceLinkCmp
                                                                     height="35px"
                                                                     valueChangeEvent="keyup"
                                                                     [(value)]="resourceLinkUrl"
                                                                     [placeholder]="ls.l('Link URL')"
                                                                     [disabled]="isReadOnly">
                                                            <dx-validator>
                                                                <dxi-validation-rule type="pattern"
                                                                                     [pattern]="urlRegexPattern"
                                                                                     [message]="ls.l('Invalid_PublicSiteUrl')">
                                                                </dxi-validation-rule>
                                                            </dx-validator>
                                                        </dx-text-box>
                                                        <div *ngIf="!isReadOnly" class="add-button">
                                                            <span (click)="addLink(resourceLinkNameCmp, resourceLinkCmp)">+</span>
                                                        </div>
                                                    </div>

                                                    <div *ngFor="let link of productLinks; let i = index" class="link">
                                                        <a target="_blank" [href]="formatUrl(link.url)" [title]="link.url">{{link.name || link.url}}</a>&nbsp;<i *ngIf="!isReadOnly" (click)="removeLink(i)" aria-hidden="true" class="delete fa fa-times"></i>
                                                    </div>

                                                </div>

                                            </div>
                                            <div class="block subscription-feature" *ngSwitchCase="'subscription-feature'">
                                                <div class="services-header">
                                                    <h3>{{ls.l('Product Services & Features')}} <img class="info" src="assets/common/icons/info-circle.svg"></h3>
                                                    <button *ngIf="!isReadOnly" class="base-button" (click)="addNewServiceFields()">
                                                        <lucide-angular [img]="Plus"></lucide-angular>
                                                        <span>Add Service</span>
                                                    </button>
                                                </div>
                                                <div class="options" *ngFor="let service of product.productServices; let i = index">
                                                    <div *ngIf="!isReadOnly" class="remove-button" (click)="removeServiceFields(i)"><span>-</span></div>

                                                    <div class="field-wrapper">
                                                        <div class="field-50">
                                                            <div class="field-title">Select service...</div>
                                                            <dx-select-box #cmp name="name"
                                                                           class="subscription-select"
                                                                           width="100%"
                                                                           height="46px"
                                                                           valueExpr="id"
                                                                           displayExpr="name"
                                                                           [dataSource]="services"
                                                                           placeholder="Select service..."
                                                                           [(value)]="service.memberServiceId"
                                                                           [disabled]="isReadOnly"
                                                                           (onValueChanged)="onServiceChanged($event, service)">
                                                                <dx-validator>
                                                                    <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Name'))}}."></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-select-box>
                                                        </div>
                                                        <div class="field-50" *ngIf="getServiceLevels(service.memberServiceId) as levels">
                                                            <div class="field-title">Select level...</div>
                                                            <dx-select-box name="level"
                                                                           class="subscription-select"
                                                                           width="100%"
                                                                           height="46px"
                                                                           valueExpr="id"
                                                                           displayExpr="name"
                                                                           [dataSource]="levels"
                                                                           placeholder="Select level..."
                                                                           [(value)]="service.memberServiceLevelId"
                                                                           [disabled]="isReadOnly || !levels.length">
                                                                <dx-validator>
                                                                    <dxi-validation-rule type="required" message="{{ls.l('RequiredField', ls.l('Level'))}}."></dxi-validation-rule>
                                                                </dx-validator>
                                                            </dx-select-box>
                                                        </div>
                                                        <i *ngIf="service.memberServiceId" class="edit fa" [ngClass]="{'fa-pencil': !isReadOnly, 'fa-info-circle': isReadOnly}" aria-hidden="true" (click)="showEditMemberServiceDialog(service, cmp)"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <community-access-selector *ngSwitchCase="'discord-roles-selector'"
                                                                       [community]="item"
                                                                       [data]="deliverablesData['discord']"
                                                                       [hostClientId]="hostDiscordClientId">
                                            </community-access-selector>
                                            <community-access-selector *ngSwitchCase="'telegram-channel-selector'" [community]="item">
                                            </community-access-selector>
                                            <community-access-selector *ngSwitchCase="'slack-channel-selector'" [community]="item">
                                            </community-access-selector>
                                        </div>
                                        <div *ngIf="item.fields"
                                             class="accordion-item-body"
                                             role="region"
                                             [style.display]="accordionItem.expanded ? '' : 'none'"
                                             [attr.id]="'accordion-body-' + index"
                                             [attr.aria-labelledby]="'accordion-header-' + index">
                                            <deliverable-feature-fields [fields]="item.fields"
                                                                        [prefix]="item.id + '_'"
                                                                        [(data)]="deliverablesData"
                                                                        [isReadOnly]="isReadOnly"
                                                                        [(handleChange)]="handleChange"></deliverable-feature-fields>
                                        </div>
                                    </cdk-accordion-item>
                                </cdk-accordion>
                            </div>
                        </div>
                    </ng-template>
                </div>
                <div class="footer"></div>
            </div>
        </dx-validation-group>
    </dx-scroll-view>
</modal-dialog>