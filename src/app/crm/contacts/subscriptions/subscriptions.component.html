<h2>
    Subscriptions
    <span class="history-button clickable-item pull-right" (click)="toggleHistory()">
        {{ showAll ? 'Hide history' : 'Show history' }}
    </span>
    <span *ngIf="manageAllowed" class="add-subscription pull-right" (click)="openSubscriptionDialog($event)">
        {{ ls.l('AddSubscription') }}
    </span>
</h2>

<dx-data-grid #mainGrid
              id="gridContainer"
              [dataSource]="dataSource"
              keyExpr="id"
              [allowColumnReordering]="true"
              [columnAutoWidth]="true"
              [allowColumnResizing]="true"
              [masterDetail]="{ enabled: true, template: 'detail' }">
    <dxo-sorting mode="multiple"></dxo-sorting>

    <dxi-column dataField="id" [visible]="false" cssClass="clipboard-holder"></dxi-column>
    <dxi-column dataField="serviceType" cssClass="clipboard-holder"></dxi-column>
    <dxi-column dataField="startDate" dataType="date" cssClass="clipboard-holder"></dxi-column>
    <dxi-column dataField="endDate" dataType="date" cssClass="clipboard-holder"></dxi-column>
    <dxi-column dataField="trialEndDate" dataType="date" cssClass="clipboard-holder"></dxi-column>
    <dxi-column dataField="fee" cellTemplate="amountTemplate"></dxi-column>
    <dxi-column dataField="systemType" cssClass="clipboard-holder"></dxi-column>
    <dxi-column dataField="orderType" cssClass="clipboard-holder"></dxi-column>
    <dxi-column dataField="status" [caption]="ls.l('Status')" cssClass="clipboard-holder"></dxi-column>
    <dxi-column caption="" [width]="220" cellTemplate="actionsTemplate"></dxi-column>
    <div *dxTemplate="let cell of 'actionsTemplate'" class="billing-actions">
        <a *ngIf="cell.data.tenantId && permission.isGranted(permissions.TenantsImpersonation)"
           (click)="cell.data.status == 'Active' && showUserImpersonateLookUpModal($event, cell.data)">{{ls.l('LoginAsThisTenant')}}</a>
        <!-- <br /> -->
        <button class="btn-link" *ngIf="cell.data.statusCode === 'A' && permission.isGranted(permissions.CRMOrdersManage)" (click)="cancelSubscription(cell.data.id, $event)">{{ls.l('cancel')}}</button>
    </div>
    <div *dxTemplate="let cell of 'amountTemplate'" class="clipboard-holder">
        <span> {{ cell.text | currency:currency:'symbol':'1.2-2' }} </span>
    </div>
    <div *dxTemplate="let payment of 'detail'">
        <div class="master-detail-caption">{{'Payments info'}}</div>
        <dx-data-grid [dataSource]="payment.data.orderSubscriptionPayments"
                      [showBorders]="true"
                      [columnAutoWidth]="true">

            <dxi-column dataField="status" [width]="120" [caption]="ls.l('Status')" cssClass="clipboard-holder"></dxi-column>
            <dxi-column dataField="fee" [caption]="ls.l('Total Fee')" cellTemplate="amountTemplate"></dxi-column>
            <dxi-column dataField="startDate" dataType="date" cssClass="clipboard-holder"></dxi-column>
            <dxi-column dataField="endDate" dataType="date" cssClass="clipboard-holder"></dxi-column>
            <div *dxTemplate="let cell of 'amountTemplate'" class="clipboard-holder">
                <span> {{ cell.text | currency:currency:'symbol':'1.2-2' }} </span>
            </div>
        </dx-data-grid>
    </div>
</dx-data-grid>
