<source-contact-list
    [leadId]="data?.leadInfo?.id"
    [selectedKey]="data?.leadInfo?.sourceContactId"
    [targetSelector]="'#contactSourceLink'"
    (onDataLoaded)="onSourceContactLoaded($event)"
    (onItemSelected)="onSourceContactChanged($event)">
</source-contact-list>
<div #loaderWrapper>
    <action-menu width="150px"
        [items]="actionMenuItems"
        target=""
        (onItemClick)="onMenuItemClick($event)">
    </action-menu>
    <dx-data-grid
        class="main-component-view"
        accessKey="narrowHeaderPanel"
        noDataText=""
        [visible]="!selectedLeadId"
        [renderAsync]="true"
        [dataSource]="dataSource"
        [allowColumnReordering]="true"
        [columnAutoWidth]="true"
        [cacheEnabled]="false"
        [remoteOperations]="{
            filtering: false,
            grouping: false,
            groupPaging: true,
            paging: true,
            sorting: true,
            summary: true
        }"
        [allowColumnResizing]="true"
        [hoverStateEnabled]="true"
        [pager]="defaultGridPagerConfig"
        (onCellClick)="onCellClick($event)"
        (onDataErrorOccurred)="httpInterceptor.handleError($event.error)">
        <dxo-selection mode="none"></dxo-selection>
        <dxo-scrolling rowRenderingMode="virtual"></dxo-scrolling>

        <dxi-column
            alignment="center"
            width="90px"
            cellTemplate="actionsCellTemplate"
            headerCellTemplate="actionsCellTemplate">
        </dxi-column>

        <dxi-column [dataField]="leadFields.Id" [visible]="false" sortOrder="desc"></dxi-column>
        <dxi-column [dataField]="leadFields.CustomerId" [visible]="false"></dxi-column>
        <dxi-column [dataField]="leadFields.LeadDate" [caption]="ls.l('Created')" cellTemplate="dateCell" cssClass="tabular"></dxi-column>
        <dxi-column [dataField]="leadFields.Stage" [caption]="ls.l('Stage')" cssClass="clipboard-holder"></dxi-column>
        <dxi-column [dataField]="leadFields.ContactAffiliateCode" [caption]="ls.l('ContactAffiliateCode')" cssClass="clipboard-holder"></dxi-column>
        <dxi-column [dataField]="leadFields.SourceContactName" [caption]="ls.l('SourceContactName')" cssClass="clipboard-holder"></dxi-column>
        <dxi-column [dataField]="leadFields.SourceCampaignCode" [caption]="ls.l('CampaignCode')" cssClass="clipboard-holder"></dxi-column>
        <dxi-column [dataField]="leadFields.SourceChannelCode" [caption]="ls.l('ChannelCode')" cssClass="clipboard-holder"></dxi-column>
        <dxi-column [dataField]="leadFields.RefererUrl" [caption]="ls.l('RefererUrl')" cssClass="clipboard-holder"></dxi-column>

        <a class="dx-link dx-link-edit" *dxTemplate="let cellData of 'actionsCellTemplate'"></a>

        <div *dxTemplate="let cellData of 'dateCell'" class="clipboard-holder">
            {{cellData.value | date: formatting.dateTime : userTimezone}}
        </div>
        <dxo-group-panel [visible]="true"></dxo-group-panel>
        <dxo-sorting mode="multiple"></dxo-sorting>
    </dx-data-grid>

    <i *ngIf="selectedLeadId" class="show-leads-grid" (click)="showLeadsGrid()">{{ls.l('Show Leads')}}</i>
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" *ngIf="selectedLeadId">
        <mat-tab label="General">
            <dx-scroll-view showScrollbar="onHover">
                <div class="lead-info row">
                    <div *ngFor="let column of layoutColumns" class="col-md-6">
                        <div *ngFor="let section of column.sections" class="section">
                            <h3 *ngIf="section.name" class="lab {{section.icon}}">{{ls.l('LeadInfoSection_' + section.name)}}</h3>
                            <div *ngFor="let item of section.items" class="section-item">
                                <div *ngIf="!item.hideLabel" class="item-edit-label">{{ls.l(capitalize(item?.lname || item?.name || item))}}:</div>
                                <ng-container [ngSwitch]="item?.name">
                                    <ng-container *ngSwitchCase="'contact'">
                                        <a id="contactSourceLink"
                                           class="clipboard-holder"
                                           [class.selected]="!!sourceContactName"
                                           [class.disabled]="!isCGManageAllowed"
                                           (click)="isCGManageAllowed && sourceComponent.toggle()">{{sourceContactName || (isCGManageAllowed && data?.leadInfo ? ls.l('Search') : '')}}
                                            <i class="save-to-clipboard" [hidden]="!sourceContactName" (click)="saveToClipboard($event, sourceContactName)"></i>
                                        </a>
                                    </ng-container>
                                    <ng-container *ngSwitchDefault>
                                        <div *ngIf="getPropValue(item.name) as value" [hidden]="isEditAllowed && !item.readonly" (click)="showApplicationAllowed && item.action && item.action()" class="item-value" [ngClass]="{'item-link': showApplicationAllowed && item.action, 'clipboard-holder': true}"><span [title]="value" [ngClass]="{'wide': item.wide}">{{value}}</span><i class="save-to-clipboard" (click)="saveToClipboard($event, value)"></i></div>
                                        <ng-container *ngIf="isEditAllowed && !item.readonly">
                                            <div [ngSwitch]="item?.data ? 'select' : 'text'" [ngStyle]="{'margin-right': item?.data ? '0' : '50px'}">
                                                <inplace-edit *ngSwitchCase="'text'" [data]="getPropData(item)" (valueChanged)="updateValue($event, item)"></inplace-edit>
                                                <inplace-select *ngSwitchCase="'select'" [data]="item.data" (valueChanged)="item.onChange($event)" ></inplace-select>
                                            </div>
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </dx-scroll-view>
        </mat-tab>
        <mat-tab label="Applications" [disabled]="!data?.leadInfo?.applicantId || !showApplicationAllowed">
            <dx-scroll-view showScrollbar="onHover" *ngIf="application">
                <div *ngIf="selectedTabIndex" class="app-container">
                    <div *ngFor="let group of getObjectKeys(application)" class="app-group">
                        <h3 class="lab {{upperCase(group) == 'TRACKING INFORMATION' ? 'single-content': 'c-info'}}">{{upperCase(group)}}</h3>
                        <div *ngFor="let field of getObjectKeys(application[group])" class="section-item">
                            <div class="item-edit-label app">{{startCase(field)}}:</div>
                            <div class="item-value app" *ngIf="formatFieldValue(field, application[group][field]) as value" [title]="value">{{value}}</div>
                        </div>
                    </div>
                </div>
            </dx-scroll-view>
        </mat-tab>
    </mat-tab-group>
</div>