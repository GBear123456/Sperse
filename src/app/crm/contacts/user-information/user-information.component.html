<div class="invite-user-form" *ngIf="showInviteUserForm$ | async; else userInfo">
    <dx-scroll-view showScrollbar="onHover">
        <dx-validation-group #inviteValidationGroup>
            <div class="row">
                <div class="invite-user-info col-md-4" *ngIf="emails || phones">
                    <h2>{{ls.l('UserInfo')}}</h2>
                    <p>{{ls.l('UserInfoDescription')}}</p>
                    <div class="invite-field">
                        <div class="item-edit-label">{{ls.l("Email")}}:</div>
                        <dx-select-box #emailAddress
                            width="calc(100% - 50px)"
                            name="emailAddress"
                            [placeholder]="ls.l('SelectOrEnterNew')"
                            [disabled]="!isInviteAllowed"
                            [showClearButton]="true"
                            [acceptCustomValue]="true"
                            [dataSource]="emails"
                            displayExpr="emailAddress"
                            valueExpr="emailAddress"
                            [(value)]="inviteData.emailAddress"
                            (onCustomItemCreating)="onCustomItemCreating($event, 'emailAddress')"
                            itemTemplate="emailItemTemplate">
                            <div *dxTemplate="let item of 'emailItemTemplate'">
                                <div class="email-item-wrapper">
                                    <span>{{item?.emailAddress}}</span>
                                </div>
                            </div>
                            <dx-validator>
                                <dxi-validation-rule type="required" [message]="ls.l('EmailIsRequired')"></dxi-validation-rule>
                                <dxi-validation-rule type="pattern" [pattern]="emailRegEx" [message]="ls.l('InvalidEmailAddress')"></dxi-validation-rule>
                            </dx-validator>
                        </dx-select-box>
                    </div>
                    <div class="invite-field">
                        <div class="item-edit-label">{{ls.l("PhoneNumber")}}:</div>
                        <dx-select-box #phoneNumber
                            width="calc(100% - 50px)"
                            name="phoneNumber"
                            [placeholder]="ls.l('SelectOrEnterNew')"
                            [disabled]="!isInviteAllowed"
                            [showClearButton]="true"
                            [acceptCustomValue]="true"
                            [dataSource]="phones"
                            displayExpr="phoneNumber"
                            valueExpr="phoneNumber"
                            [(value)]="inviteData.phoneNumber"
                            (onCustomItemCreating)="onCustomItemCreating($event, 'phoneNumber')"
                            itemTemplate="phoneItemTemplate">
                            <div *dxTemplate="let item of 'phoneItemTemplate'">
                                <div class="phone-item-wrapper">
                                    <span>{{phoneFormatPipe.transform(item?.phoneNumber)}}</span>
                                </div>
                            </div>
                            <dx-validator>
                                <dxi-validation-rule type="stringLength" max="24"></dxi-validation-rule>
                                <dxi-validation-rule type="pattern"
                                                     [pattern]="phonePattern"
                                                     [message]="ls.l('PhoneValidationError')">
                                </dxi-validation-rule>
                            </dx-validator>
                        </dx-select-box>
                    </div>
                    <dx-check-box [(value)]="inviteSetRandomPassword" [text]="ls.l('SetRandomPassword')"></dx-check-box>
                    <input *ngIf="!inviteSetRandomPassword" class="hidden-field" type="text">
                    <input *ngIf="!inviteSetRandomPassword" class="hidden-field" type="password">
                    <dx-text-box *ngIf="!inviteSetRandomPassword"
                        width="300px"
                        placeholder="Password"
                        mode="password"
                        [inputAttr]="{ autocomplete: 'new-password' }"
                        [(value)]="inviteData.password">
                        <dx-validator>
                            <dxi-validation-rule type="required"></dxi-validation-rule>
                        </dx-validator>
                    </dx-text-box>
                    <dx-text-box *ngIf="!inviteSetRandomPassword"
                        width="300px"
                        placeholder="Confirm Password"
                        mode="password"
                        [inputAttr]="{ autocomplete: 'new-password' }"
                        [value]="">
                        <dx-validator>
                            <dxi-validation-rule type="required"></dxi-validation-rule>
                            <dxi-validation-rule type="compare" [comparisonTarget]="invitePasswordComparison" [message]="ls.l('PasswordsDontMatch')"></dxi-validation-rule>
                        </dx-validator>
                    </dx-text-box>

                    <dx-check-box [(value)]="inviteData.changePasswordOnNextLogin" [text]="ls.l('ShouldChangePasswordOnNextLogin')"></dx-check-box>
                    <dx-check-box [(value)]="inviteData.sendActivationEmail" [text]="ls.l('SendActivationEmail')"></dx-check-box>
                </div>
                <div class="col-md-4">
                    <h2>{{ls.l('SelectRoles')}}</h2><span class="optional">({{ls.l('optional')}})</span>
                    <p>{{ls.l('SelectRolesDescription')}}</p>
                    <ul class="items-list roles">
                        <li *ngFor="let role of roles" [title]="role.roleDisplayName">
                            <dx-check-box [disabled]="!isInviteAllowed"
                                        [text]="role.roleDisplayName"
                                        [value]="isPartner() && roleIsCheckedByDefault(role.roleName)"
                                        (onValueChanged)="inviteRoleUpdate($event, role)">
                            </dx-check-box>
                        </li>
                    </ul>
                </div>
            </div>
            <button class="button-layout button-primary" (click)="inviteUser()">{{ls.l('Invite')}}</button>
        </dx-validation-group>
    </dx-scroll-view>
</div>
<ng-template #userInfo>
    <mat-tab-group [(selectedIndex)]="selectedTabIndex">
        <mat-tab label="General">
            <dx-scroll-view showScrollbar="onHover">
                <div class="user-info row" #row>
                    <div class="col-md-4" [ngClass]="{ onecolum: row.offsetWidth < 600 }">
                        <h2>{{ls.l('UserInfo')}}</h2>
                        <p>{{ls.l('UserInfoDescription')}}</p>
                        <div class="section-item clearfix">
                            <div class="item-edit-label">{{ls.l("Email")}}:</div>
                            <inplace-edit #InPlaceEmail
                                          [id]="null"
                                          [value]="data && data.user && data.user[EMAIL_FIELD]"
                                          [isReadOnlyField]="!isEditAllowed"
                                          [isEditDialogEnabled]="true"
                                          [validationRules]="validationRules[EMAIL_FIELD] || []"
                                          [lEntityName]="EMAIL_FIELD"
                                          [editPlaceholder]="ls.l('EditValuePlaceholder')"
                                          (valueChanged)="updateValue($event, EMAIL_FIELD)"
                                          (openDialog)="InPlaceEmail.showInput(true)">
                            </inplace-edit>
                        </div>
                        <div class="section-item clearfix">
                            <div class="item-edit-label">{{ls.l("PhoneNumber")}}:</div>
                            <ul *ngIf="!phoneInplaceEdit">
                                <li (dblclick)="phoneInPlaceEdit()">
                                    {{ data?.user?.phoneNumber | phone }}<i class="edit-phone fa fa-pencil" *ngIf="isEditAllowed" (click)="phoneInPlaceEdit()"></i><i class="copy save-to-clipboard" aria-hidden="true" (click)="copyToClipbord(data?.user?.phoneNumber)"></i>
                                </li>
                            </ul>
                            <div class="inplace-edit-wrapper" *ngIf="phoneInplaceEdit">
                                <country-phone-number [(phoneNumber)]="data.user.phoneNumber" #countryPhoneNumber></country-phone-number>
                                <dx-button class="update" icon="todo" (onClick)="updatePhoneNumber(countryPhoneNumber.isValid())"></dx-button>
                                <dx-button class="exit" icon="refresh" (onClick)="closePhoneInPlaceEdit()"></dx-button>
                            </div>
                        </div>
                        <button class="button-layout button-primary reset-password" [disabled]="!data?.user?.isActive || !isEditAllowed" (click)="resetPasswordDialog($event)">{{ls.l('PasswordReset')}}</button>
                        <div class="title">
                            {{ls.l('Options') + ':'}}
                        </div>
                        <ul *ngIf="data && data?.user" class="items-list options">
                            <li>
                                <dx-check-box [disabled]="!isEditAllowed" [(value)]="data.user.isActive" [text]="ls.l('Active')" (onValueChanged)="isActiveChanged($event)"></dx-check-box>
                            </li>
                            <li>
                                <dx-check-box [disabled]="!isEditAllowed" [(value)]="data.user.isTwoFactorEnabled" [text]="ls.l('IsTwoFactorEnabled')" (onValueChanged)="update(TWO_FACTOR_FIELD, data.user.isTwoFactorEnabled)"></dx-check-box>
                            </li>
                            <li>
                                <dx-check-box [disabled]="!isEditAllowed" [(value)]="data.user.isLockoutEnabled" [text]="ls.l('IsLockoutEnabled')" (onValueChanged)="update(LOCKOUT_FIELD, data.user.isLockoutEnabled)"></dx-check-box>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h2>{{ls.l('UserRoles')}}</h2>
                        <p>{{ls.l('SelectRolesDescription')}}</p>
                        <ul class="items-list roles">
                            <li *ngFor="let role of data?.roles">
                                <dx-check-box [disabled]="!changeRolesAllowed" 
                                    [(value)]="role.isAssigned" 
                                    text="{{role.roleDisplayName}}" 
                                    (onValueChanged)="roleUpdate($event, role)">
                                </dx-check-box>
                            </li>
                        </ul>
                    </div>
                </div>
            </dx-scroll-view>
        </mat-tab>
        <mat-tab label="Permissions" [disabled]="!isEditAllowed">
            <dx-scroll-view showScrollbar="onHover">
                <permission-tree *ngIf="selectedTabIndex == PERMISSIONS_TAB_INDEX"></permission-tree>
            </dx-scroll-view>
        </mat-tab>
        <mat-tab label="Login Attempts">
            <login-attempts *ngIf="selectedTabIndex == LOGIN_ATTEMPTS_TAB_INDEX"></login-attempts>
        </mat-tab>
    </mat-tab-group>
</ng-template>