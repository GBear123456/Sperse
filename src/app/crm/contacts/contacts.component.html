<item-details-layout
    [navLinks]="navLinks"
    [queryParams]="queryParams"
    [rightPanelOpened]="false"
    (onClose)="close()"
    (onChanged)="updateContextType($event)">
    <ng-container topHeader>
        <details-header [data]="contactInfo"
                        [personContactInfo]="personContactInfo"
                        [ratingId]="contactInfo.ratingId"
                        (onInvalidate)="reloadCurrentSection($event)">
        </details-header>
    </ng-container>
    <ng-container underHeader>
        <div class="general-links">
            <a (click)="contactsService.showEmailDialog({ contact: contactInfo }).subscribe()"
               [class.disabled]="!isSendSmsAndEmailAllowed">
                <i class="inbox-icon" aria-hidden="true"></i>
            </a>
            <a><i class="note-icon" aria-hidden="true" (click)="contactsService.showNoteAddDialog()"></i></a>
            <a (click)="contactsService.showSMSDialog({ contact: contactInfo })"
               [class.disabled]="!isSendSmsAndEmailAllowed">
                <i class="sms-icon fa fa-commenting-o"></i>
            </a>
        </div>
        <operations-widget
            [enabled]="contactInfo && showToolbar"
            [customerType]="contactGroupId$ | async"
            [leadId]="leadId"
            [contactInfo]="contactInfo"
            [selectedPipelineId]="leadInfo?.pipelineId"
            [pipelineDataSource]="allPipelines"
            [selectedStageId]="clientStageId"
            [partnerTypes]="partnerTypes"
            [selectedPartnerTypeId]="partnerTypeId"
            (print)="printMainArea()"
            (onUpdateStatus)="updateStatus($event)"
            (onDelete)="deleteContact()"
            [getProxyService]="getProxyService"
            [assignedUsersSelector]="assignedUsersSelector"
            [getAssignmentsPermissionKey]="getAssignmentsPermissionKey">
        </operations-widget>
    </ng-container>
    <ng-container aboveNavigation>
        <div class="short-contact" *ngIf="!isUserProfile">
            <div class="related-contacts">
                <div *ngIf="contactInfo && contactInfo['organizationContactInfo']?.contactPersons?.length > 1; else addNew" class="contact-persons-info" (click)="showContactPersons($event)">
                    <img src="./assets/common/icons/similar-contacts.svg" alt="Contact Persons">
                    <span class="similar-contacts-count">{{ contactInfo['organizationContactInfo']?.contactPersons.length - 1 }} related contact<span *ngIf="contactInfo['organizationContactInfo']?.contactPersons.length - 1 > 1">s</span></span>
                    <img src="./assets/common/icons/down-arrow-icon.svg" alt="Contact Persons">
                </div>

                <ng-template #addNew>
                    <div class="contact-persons-info" (click)="addNewContact($event)" *ngIf="contactInfo?.primaryOrganizationContactId && manageAllowed">
                        <img src="./assets/common/icons/similar-contacts.svg" alt="Contact Persons">
                        <a class="add-new-contact">{{l('AddRelatedContact')}}</a>
                    </div>
                </ng-template>
                <div class="sub-contacts-info" (click)="addNewContact($event, true)"
                     *ngIf="!contactInfo?.parentId; else backToParent">
                    <img src="./assets/common/icons/similar-contacts.svg" [alt]="l('SubContact')">
                    <div>
                        <div *ngIf="contactInfo?.subContactsCount">
                            {{ contactInfo.subContactsCount + ' ' + (contactInfo.subContactsCount === 1
                            ? this.l('subContact_single')
                            : this.l('subContact_plural')) }}
                        </div>
                        <a class="add-new-contact sub-contact">+ {{l('AddSubContact')}}</a>
                    </div>
                </div>
                <ng-template #backToParent>
                    <div class="contact-persons-info" (click)="showParent()" [title]="l('Parent Contact')">
                        <img src="./assets/common/icons/similar-contacts.svg">
                        <a class="add-new-contact">{{contactInfo?.parentName || l('Parent')}}</a>
                    </div>
                </ng-template>
            </div>
        </div>
    </ng-container>
    <ng-container rightPanel></ng-container>
</item-details-layout>
