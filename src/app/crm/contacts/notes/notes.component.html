<div class="wrapper" *ngIf="dataSource && dataSource.length; else noData">
    <action-menu width="150px"
        [items]="actionMenuItems"
        target=""
        (onItemClick)="onMenuItemClick($event)">
    </action-menu>
    <div class="grid-view" *ngIf="showGridView">
        <dx-data-grid            
            height="100%"
            class="main-component-view"
            [dataSource]="dataSource"
            [pager]="defaultGridPagerConfig"
            [allowColumnReordering]="true"
            [columnAutoWidth]="true"
            [allowColumnResizing]="true"
            [hoverStateEnabled]="true"
            (onCellClick)="onCellClick($event)"
            (onDataErrorOccurred)="httpInterceptor.handleError($event.error)"
            (onToolbarPreparing)="onToolbarPreparing($event)">
            <dxo-search-panel [visible]="true" [width]="300"></dxo-search-panel>
            <dxo-header-filter [visible]="true" [allowSearch]="true"></dxo-header-filter>

            <dxi-column alignment="center" width="40px" cellTemplate="actionsCellTemplate" headerCellTemplate="actionsCellTemplate"></dxi-column>
            <a class="dx-link dx-link-edit" *dxTemplate="let cellData of 'actionsCellTemplate'"></a>

            <dxi-column dataField="text"
                        [caption]="l('Note')"
                        width="350px"
                        cssClass="clipboard-holder"
                        dataType="string"
                        cellTemplate="textCell">
            </dxi-column>
            <dxi-column dataField="dateTime"
                        [caption]="l('Date')"
                        sortOrder="desc"
                        cssClass="tabular clipboard-holder"
                        [calculateCellValue]="calculateDateCellValue">
            </dxi-column>
            <dxi-column dataField="addedByUserName"
                        [caption]="l('AddedBy')"
                        cssClass="clipboard-holder">
            </dxi-column>
            <dxi-column dataField="noteTypeName"
                        [caption]="l('Type')"
                        cssClass="clipboard-holder">
            </dxi-column>
            <dxi-column dataField="contactPhoneNumber"
                        [caption]="l('Phone')"
                        cellTemplate="phoneCell"
                        cssClass="tabular">
            </dxi-column>
            <dxi-column dataField="contactName"
                        [caption]="l('Contact')"
                        cssClass="clipboard-holder">
            </dxi-column>

            <div *dxTemplate="let cellData of 'textCell'" class="text-wrap">
                {{cellData.value}}            
            </div>

            <div *dxTemplate="let cellData of 'phoneCell'" class="clipboard-holder">
                {{cellData.value | phone}}
            </div>

            <div *dxTemplate="let data of 'title'">
                <h2 class="title">{{l('Notes')}}</h2>
            </div>

            <dxo-load-panel [enabled]="true"></dxo-load-panel>
            <dxo-sorting mode="multiple"></dxo-sorting>
            <dxo-group-panel [visible]="false"></dxo-group-panel>
        </dx-data-grid>
    </div>
    <div class="chat-view" *ngIf="!showGridView">
        <dx-scroll-view showScrollbar="onHover">                    
            <div class="messages-wrapper">
                <div *ngFor="let message of dataSource; let i = index" class="message-wrapper" [ngClass]="{current: message.addedByUserId == userId, another: message.addedByUserId != userId}" [attr.fullname]="message.addedByUserName">
                    <div [ngStyle]="{'background-image': 'url(' + profileService.getContactPhotoUrl(message.addedByUserPhotoPublicId) + ')'}" class="img-circle avatar small"></div>
                    <a *ngIf="showActonMenu" class="gear-icon" (click)="toggleActionsMenu(message, $event.target)"></a>
                    <div class="body date" [attr.date]="message.dateTime | date: formatting.inboxDate : userTimezone">
                        <div [innerHtml]="message.text"></div>
                    </div>
                </div>
            </div>
        </dx-scroll-view>        
    </div>
</div>
<ng-template #noData>
    <app-no-data></app-no-data>
</ng-template>
