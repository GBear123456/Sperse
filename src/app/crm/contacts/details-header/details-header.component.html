<header>
    <div class="avatar">
        <div class="active"></div>
        <div class="photo-area" (click)="showUploadPhotoDialog($event)" [ngStyle]="{'background-image': data?.personContactInfo?.primaryPhoto ? 'url(data:image/png;base64,' + data.personContactInfo.primaryPhoto + ')': ''}"></div>
    </div>
    <div class="personal_info">
        <div class="full_name">
            <h1 *ngIf="data && data?.personContactInfo">
                <inplace-edit [data]="getNameInplaceEditData() | async"
                              (valueChanged)="updatePrimaryContactName($event)"
                              (openDialog)="showEditPersonDialog($event)">
                </inplace-edit>
            </h1>
        </div>
        <rating-bar *ngIf="!isBankCodeLayout; else bankCode" [rating]="ratingId || 0"></rating-bar>
        <ng-template #bankCode>
            <div class="bank-code" *ngIf="data?.personContactInfo?.person?.bankCode as bankCodeLetters">
                <bank-code-letters [bankCode]="bankCodeLetters"
                                   [allowEdit]="true"
                                   [personId]="data.id"
                                   key="detailsHeader"
                                   [showDescriptionsOnHover]="true">
                </bank-code-letters>
            </div>
        </ng-template>
    </div>
    <div *ngIf="data" class="organization_info">
        <div class="delimiter"></div>
        <div *ngIf="data?.primaryOrganizationContactId" class="company-details">
            <div class="info-icon" (click)="showCompanyDialog($event)">
                <img *ngIf="!showRemovingOrgRelationProgress" src="./assets/common/icons/info-icon-blue.svg" alt="Organization Details">
                <div *ngIf="showRemovingOrgRelationProgress" class="loadindicator"></div>
            </div>
            <div class="titles">
                <h2 class="shift-top">
                    <inplace-edit #companyName
                                  [data]="getCompanyNameInplaceEditData() | async"
                                  (valueChanged)="updateCompanyField($event)">
                    </inplace-edit>
                    <i class="fa fa-angle-down" *ngIf="!companyName.isEditModeEnabled && (data?.personContactInfo?.orgRelations?.length > 1)" (click)="showCompanyList($event)"></i>
                    <div class="actions" [hidden]="!manageAllowed || companyName.isEditModeEnabled">
                        <i class="edit fa fa-pencil" (click)="showCompanyDialog($event)"></i>
                        <i class="add fa fa-plus" (click)="addCompanyDialog($event)"></i>
                        <i class="delete fa fa-times" (click)="removePersonOrgRelation($event)"></i>
                    </div>
                </h2>
                <h3>
                    <inplace-edit #jobTitle [data]="getJobTitleInplaceEditData() | async" (valueChanged)="updateJobTitle($event)"></inplace-edit>
                </h3>
            </div>
        </div>
        <div *ngIf="!data?.primaryOrganizationContactId" class="add-new-company">
            <a (click)="addCompanyDialog($event)">+ {{ l('Add Company') }}</a>
        </div>
        <div class="organization_logo">
            <img (click)="showCompanyDialog($event)" [src]="data?.organizationContactInfo?.primaryPhoto ? 'data:image/png;base64,' + data.organizationContactInfo.primaryPhoto : './assets/common/images/no-photo-Organization.png'" alt="Organization Logo">
        </div>
    </div>

    <div class="header_buttons">
        <button id="addEntity" *ngIf="manageAllowed && addContextMenuItems.length" class="button-layout button-primary menu" (click)="addEntity($event)">
            + {{addButtonTitle}}
        </button>

        <div class="vertical-delimiter"></div>
        <button class="refresh-button" (click)="refresh()"></button>
    </div>
</header>
<dx-context-menu
    *ngIf="addContextMenuItems && addContextMenuItems.length"
    [selectByClick]="true"
    [selectionMode]="'single'"
    [dataSource]="addContextMenuItems"
    [position]="{ my: 'top right', at: 'bottom right' }"
    (onSelectionChanged)="addOptionSelectionChanged($event)"
    target="#addEntity">
</dx-context-menu>
