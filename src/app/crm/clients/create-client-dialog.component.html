<div class="photo-area" (click)="showUploadPhoto($event)" [ngStyle]="{'background-image': photoOriginalData ? 'url(' + photoOriginalData + ')': ''}"></div>
<modal-dialog (onTitleKeyUp)="onFullNameKeyUp($event)">
    <dx-context-menu
        [selectByClick]="true"
        [selectionMode]="'single'"
        [dataSource]="saveContextMenuItems"
        [position]="{ my: 'top right', at: 'bottom right' }"
        (onSelectionChanged)="onSaveOptionSelectionChanged($event)"
        target="#{{saveButtonId}}">
    </dx-context-menu>
    <app-toolbar [config]="toolbarConfig"></app-toolbar>
    <div *ngIf="similarCustomers?.length" class="similar-clients-message" (click)="showSimilarCustomers($event)">Similar records found. Click here for details</div>
    <mat-sidenav class="main_sidenav" mode="side" align="end" opened="true">
      <mat-tab-group>
        <mat-tab *ngFor="let type of contactTypes" label="{{l(type) | uppercase}}">
          <div class="tab-content">
              <div class="field" *ngIf="type == 'business'">
                  <label>{{l('Company')}}</label>
                  <dx-text-box #companyComponent
                    name="company"
                    [width]="'360px'"
                    (onKeyUp)="onCompanyKeyUp($event)"
                    [(value)]="company">
                  </dx-text-box>
                  <span [class]="company && 'clear-contact' || 'hidden'" (click)="company = ''">+</span>
              </div>
              <dx-validation-group (onInitialized)="initValidationGroup($event, 'emailValidator')">
                  <div class="field email">
                      <label>{{l('Email')}}</label>
                      <dx-text-box #emailComponent
                        name="email"
                        [width]="'260px'"
                        (onKeyUp)="onKeyUp($event, 'emails', type, emails)"
                        (onInitialized)="onComponentInitialized($event, 'emails', type)">
                        <dx-validator>
                          <dxi-validation-rule type="pattern" [pattern]="emailRegEx" message="{{l('EmailIsNotValid')}}."></dxi-validation-rule>
                        </dx-validator>
                      </dx-text-box>
                      <dx-select-box
                        width="100px"
                        name="emailType"
                        placeholder="{{l('Type')}}"
                        [dataSource]="emailTypes"
                        [disabled]="!addButtonVisible[type]['emails']"
                        displayExpr="name"
                        valueExpr="id"
                        [value]="emailType[type]"
                        (onValueChanged)="onTypeChanged($event, 'email', type)">
                      </dx-select-box>
                      <span [class]="addButtonVisible[type]['emails'] && 'add-contact' || clearButtonVisible[type]['emails'] && 'clear-contact' || 'hidden'" (click)="clearButtonVisible[type]['emails'] ? emptyInput('emails', type): addContact('emails', type)">+</span>
                  </div>
              </dx-validation-group>
              <div class="field" *ngFor="let email of contacts.emails[type]; index as i">
                  <p class="{{email.type}}">{{email.email}}<span (click)="removeContact('emails', type, i)"></span></p>
              </div>
              <div class="field phone H">
                  <label>{{l('Phone')}}</label>
                  <dx-text-box
                    class="tabular"
                    name="phone"
                    maskInvalidMessage="{{l('PhoneValidationError')}}"
                    [mask]="masks.phone"
                    [width]="'205px'"
                    (onKeyUp)="onKeyUp($event, 'phones', type, phones)"
                    (onFocusIn)="focusInput($event)"
                    (onInitialized)="onComponentInitialized($event, 'phones', type)">
                  </dx-text-box>
                  <dx-number-box
                    class="tabular"
                    name="phoneExtension"
                    [width]="'50px'"
                    [placeholder]="l('Ext')"
                    [(value)]="phoneExtension[type]">
                  </dx-number-box>
                  <dx-select-box
                    width="100px"
                    name="phoneType"
                    [disabled]="!addButtonVisible[type]['phones']"
                    placeholder="{{l('Type')}}"
                    [dataSource]="phoneTypes"
                    displayExpr="name"
                    valueExpr="id"
                    [value]="phoneType[type]"
                    (onValueChanged)="onTypeChanged($event, 'phone', type)">
                  </dx-select-box>
                  <span [class]="addButtonVisible[type]['phones'] && 'add-contact' || clearButtonVisible[type]['phones'] && 'clear-contact' || 'hidden'" (click)="clearButtonVisible[type]['phones'] ? emptyInput('phones', type): addContact('phones', type)">+</span>
              </div>
              <div class="field" *ngFor="let phone of contacts.phones[type]; index as i">
                  <p class="phone {{phone.type}}">{{phone.number | phone}}&nbsp;&nbsp;{{phone.ext ? 'ext: ' + phone.ext: '' }}<span (click)="removeContact('phones', type, i)"></span></p>
              </div>
              <dx-validation-group (onInitialized)="initValidationGroup($event, 'addressValidator')">
                  <div class="field addr address H">
                      <label>{{l('Address')}}</label>                   
                      <input *ngIf="!googleAutoComplete" type="text"
                          name="Address"
                          placeholder="{{l('Street')}}"
                          [(ngModel)]="contacts.addresses[type].address"
                          class="dx-texteditor-input"/>
                      <input *ngIf="googleAutoComplete" type="text"
                          name="Address"
                          placeholder="{{l('Street')}}"
                          [(ngModel)]="contacts.addresses[type].address"
                          class="dx-texteditor-input"
                          (country)="contacts.addresses[type].country=$event"
                          (street_number)='contacts.addresses[type].streetNumber=$event'
                          (street)='contacts.addresses[type].streetAddress=$event'
                          (city)='contacts.addresses[type].city=$event'
                          (state)='contacts.addresses[type].state=$event'
                          (postal_code)='contacts.addresses[type].zip=$event'
                          (setAddress)="onAddressChanged($event, type)"
                          ng2-google-place-autocomplete/>
                      <dx-select-box
                        width="100px"
                        name="addressType"
                        placeholder="{{l('Type')}}"
                        [dataSource]="addressTypes"
                        displayExpr="name"
                        valueExpr="id"
                        [disabled]="!contacts.addresses[type].address"
                        [value]="contacts.addresses[type].addressType"
                        (onValueChanged)="onTypeChanged($event, 'address')">
                      </dx-select-box>
                      <span [class]="contacts.addresses[type].address && 'clear-contact' || 'hidden'" (click)="contacts.addresses[type] = {}">+</span>  
                  </div>
                  <div class="field addr">
                      <label></label>                   
                      <dx-text-box
                          name="city"
                          maxLength="50"
                          placeholder="{{l('City')}}"
                          [disabled]="!contacts.addresses[type].address"
                          [width]="'360px'"
                          [(value)]="contacts.addresses[type].city">
                          <dx-validator>
                              <dxi-validation-rule type="required" message="{{l('CityRequired')}}"></dxi-validation-rule>
                          </dx-validator>
                      </dx-text-box>
                  </div>
                  <div class="field addr">
                      <label></label>                   
                      <dx-select-box
                          [dataSource]="states"
                          displayExpr="name"
                          valueExpr="name"
                          name="state"
                          placeholder="{{l('State')}}"
                          [disabled]="!contacts.addresses[type].address"
                          [width]="'360px'"
                          [searchEnabled]="true"
                          [(value)]="contacts.addresses[type].state">
                          <dx-validator>
                              <dxi-validation-rule type="required" message="{{l('StateRequired')}}"></dxi-validation-rule>
                          </dx-validator>
                      </dx-select-box>
                  </div>
                  <div class="field addr">
                      <label></label>                   
                      <dx-text-box
                          name="zip"
                          maxLength="5"
                          placeholder="{{l('Zip')}}"
                          [disabled]="!contacts.addresses[type].address"
                          [width]="'360px'"
                          [(value)]="contacts.addresses[type].zip">
                          <dx-validator>
                              <dxi-validation-rule type="required" message="{{l('ZipIsRequired')}}"></dxi-validation-rule>
                          </dx-validator>
                      </dx-text-box>
                  </div>
                  <div class="field">
                      <label></label>                   
                      <dx-select-box
                          [dataSource]="countries"
                          displayExpr="name"
                          valueExpr="name"
                          name="country"
                          placeholder="{{l('Country')}}"
                          [disabled]="!contacts.addresses[type].address"
                          [width]="'360px'"
                          [searchEnabled]="true"
                          [(value)]="contacts.addresses[type].country"
                          (onValueChanged)="onCountryChange($event)">
                          <dx-validator>
                              <dxi-validation-rule type="required" message="{{l('CountryRequired')}}"></dxi-validation-rule>
                          </dx-validator>
                      </dx-select-box>
                  </div>
                  <div class="field">
                      <label class="comment">{{l('Notes')}}</label>
                      <dx-text-area
                        name="comment"
                        [width]="'360px'"
                        [height]="'100px'"
                        (onKeyUp)="onCommentKeyUp($event, type)"
                        [(value)]="notes[type]">
                      </dx-text-area>
                      <span [class]="notes[type] && 'clear-contact' || 'hidden'" (click)="notes[type] = ''">+</span>
                  </div>
              </dx-validation-group>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-sidenav>
</modal-dialog>