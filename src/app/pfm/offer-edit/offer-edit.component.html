<item-details-layout [navLinks]="navLinks" (onClose)="back()">
    <ng-container topHeader>
        <header>
            <ng-container *ngIf="(offerDetails$ | async) as offerDetails">
                <img [src]="offerDetails.logoUrl">
                <ng-container *ngIf="getInplaceEditData() as data">
                    <inplace-edit
                        [data]="data"
                        (valueChanged)="updateCustomName($event)">
                    </inplace-edit>
                </ng-container>
            </ng-container>
            <div class="filters">
                <dx-select-box
                    name="years"
                    width="100"
                    [dataSource]="years"
                    [(value)]="selectedYear"
                    [visible]="checkSection('stats') | async">
                </dx-select-box>
            </div>
            <div class="buttons">
                <button class="button-layout button-primary" *ngIf="sentAnnouncementPermissionGranted" (click)="onNotify()">{{ ls.l('Notify') }}</button>
                <button class="button-layout button-primary" [disabled]="offerIsUpdating" type="submit" (click)="onSubmit()">{{ ls.l('Save') }}</button>
            </div>
            <div class="vertical-delimiter ng-star-inserted"></div>
            <div class="navigation">
                <dx-button icon="chevronprev" class="prev" [hint]="ls.l('Previous')" (click)="onPrev()" [disabled]="prevButtonIsDisabled"></dx-button>
                <dx-button icon="chevronnext" class="next" [hint]="ls.l('Next')" (click)="onNext()" [disabled]="nextButtonIsDisabled"></dx-button>
            </div>
            <div class="vertical-delimiter ng-star-inserted"></div>
            <button (click)="refreshData()" class="refresh-button ng-star-inserted"></button>
        </header>
    </ng-container>
    <ng-container mainContent>
        <form class="offerEditForm" (submit)="$event.preventDefault()">

            <ng-container [ngSwitch]="section$ | async" *ngIf="model">

                <div *ngSwitchCase="'general'">

                    <div class="row">
                        <div class="col-md-5">
                            <text-field name="campaignId"
                                        [value]="model.campaignId"
                                        [readOnly]="true">
                            </text-field>

                            <checkbox-field name="isPublished"
                                            [(value)]="model.extendedInfo.isPublished"
                                            class="leftAlignment">
                            </checkbox-field>

                            <text-field name="categories"
                                        [readOnly]="true"
                                        [value]="categoriesNames$ | async">
                            </text-field>

                            <text-field name="subId"
                                        [(value)]="model.extendedInfo.subId">
                            </text-field>

                            <dropdown-field name="type"
                                            [readOnly]="true"
                                            [value]="model.type"
                                            [dataSource]="getEnumDataSource(typeEnum)">
                            </dropdown-field>

                            <text-field name="issuingBank"
                                        [readOnly]="true"
                                        [(value)]="model.extendedInfo.issuingBank">
                            </text-field>

                            <text-field name="daysOfWeekAvailability"
                                        [readOnly]="true"
                                        [value]="model.daysOfWeekAvailability">
                            </text-field>

                            <text-field name="expireTimeOfDay"
                                        [readOnly]="true"
                                        [value]="model.expireTimeOfDay">
                            </text-field>

                            <text-multiple-field name="details"
                                                 [(value)]="model.extendedInfo.details"
                                                 class="valuesBelow">
                            </text-multiple-field>

                        </div>
                        <div class="offset-md-1"></div>
                        <div class="col-md-5">
                            <text-field name="name"
                                        [value]="model.name"
                                        [readOnly]="true">
                            </text-field>

                            <dropdown-field name="status"
                                            [value]="model.status"
                                            [readOnly]="true"
                                            [dataSource]="getEnumDataSource(statusEnum)">
                            </dropdown-field>

                            <text-field name="description"
                                        [readOnly]="true"
                                        [value]="model.description">
                            </text-field>

                            <dropdown-field name="campaignProviderType"
                                            [(value)]="model.extendedInfo.campaignProviderType"
                                            [dataSource]="getEnumDataSource(campaignProviderTypeEnum)">
                            </dropdown-field>

                            <dropdown-field name="parameterHandlerType"
                                            [(value)]="model.extendedInfo.parameterHandlerType"
                                            [dataSource]="getEnumDataSource(parameterHandlerTypeEnum)">
                            </dropdown-field>

                            <dropdown-field name="cardType"
                                            [readOnly]="true"
                                            [(value)]="model.extendedInfo.cardType"
                                            [dataSource]="getEnumDataSource(cardTypeEnum)">
                            </dropdown-field>

                            <text-multiple-field name="countries"
                                                [readOnly]="true"
                                                [value]="model.countries">
                            </text-multiple-field>

                            <text-field name="effectiveTimeOfDay"
                                        [readOnly]="true"
                                        [value]="model.effectiveTimeOfDay">
                            </text-field>

                            <text-field name="termsOfService"
                                        [readOnly]="true"
                                        [value]="model.termsOfService">
                            </text-field>

                            <text-multiple-field name="pros"
                                                 [(value)]="model.extendedInfo.pros"
                                                 class="valuesBelow">
                            </text-multiple-field>

                            <text-multiple-field name="cons"
                                                 [(value)]="model.extendedInfo.cons"
                                                 class="valuesBelow">
                            </text-multiple-field>
                        </div>
                        <div class="col-md-12">
                            <text-field name="campaignUrl"
                                        [readOnly]="true"
                                        class="center"
                                        [value]="model.campaignUrl">
                            </text-field>
                        </div>
                    </div>
                </div>

                <div *ngSwitchCase="'rating'">
                    <div class="row">
                        <div class="col-md-5">
                            <rating-field name="overallRating"
                                          [(value)]="model.extendedInfo.overallRating">
                            </rating-field>

                            <rating-field name="feesRating"
                                          [(value)]="model.extendedInfo.feesRating">
                            </rating-field>

                            <rating-field name="rewardsRating"
                                          [(value)]="model.extendedInfo.rewardsRating">
                            </rating-field>
                        </div>
                        <div class="offset-md-1"></div>
                        <div class="col-md-5">
                            <rating-field name="interestRating"
                                          [(value)]="model.extendedInfo.interestRating">
                            </rating-field>

                            <rating-field name="benefitsRating"
                                          [(value)]="model.extendedInfo.benefitsRating">
                            </rating-field>

                            <rating-field name="serviceRating"
                                          [(value)]="model.extendedInfo.serviceRating">
                            </rating-field>
                        </div>
                    </div>
                </div>

                <div *ngSwitchCase="'attributes'">
                    <div class="row">
                        <div class="col-md-5">

                            <tag-field name="states"
                                       displayExpr="name"
                                       valueExpr="code"
                                       [dataSource]="states$ | async"
                                       [(value)]="model.extendedInfo.states">
                            </tag-field>

                            <text-field name="categories"
                                        [readOnly]="true"
                                        [value]="model.creditScores">
                            </text-field>

                            <from-to-field fromName="minAnnualIncome"
                                           toName="maxAnnualIncome"
                                           [isCurrency]="true"
                                           [(fromValue)]="model.extendedInfo.minAnnualIncome"
                                           [(toValue)]="model.extendedInfo.maxAnnualIncome"
                                           label="Annual Income">
                            </from-to-field>

                            <from-to-field fromName="minLoanAmount"
                                           toName="maxLoanAmount"
                                           [isCurrency]="true"
                                           [(fromValue)]="model.extendedInfo.minLoanAmount"
                                           [(toValue)]="model.extendedInfo.maxLoanAmount"
                                           label="Loan Amount">
                            </from-to-field>

                            <from-to-field fromName="minLoanTermMonths"
                                           toName="maxLoanTermMonths"
                                           [(fromValue)]="model.extendedInfo.minLoanTermMonths"
                                           [(toValue)]="model.extendedInfo.maxLoanTermMonths"
                                           label="Loan Term Months">
                            </from-to-field>

                            <text-field name="introAPR"
                                        [(value)]="model.extendedInfo.introAPR">
                            </text-field>

                            <text-field name="regularAPR"
                                        [(value)]="model.extendedInfo.regularAPR">
                            </text-field>

                            <text-field name="introRewardsBonus"
                                        [(value)]="model.extendedInfo.introRewardsBonus">
                            </text-field>

                            <number-field name="rewardsRate"
                                          [(value)]="model.extendedInfo.rewardsRate">
                            </number-field>

                            <text-field name="annualFee"
                                        [(value)]="model.extendedInfo.annualFee">
                            </text-field>

                            <text-field name="monthlyFee"
                                        [(value)]="model.extendedInfo.monthlyFee">
                            </text-field>

                            <text-field name="balanceTransferFee"
                                        [(value)]="model.extendedInfo.balanceTransferFee">
                            </text-field>

                            <text-field name="activationFee"
                                        [(value)]="model.extendedInfo.activationFee">
                            </text-field>

                            <text-field name="zeroPercentageInterestTransfers"
                                        [(value)]="model.extendedInfo.zeroPercentageInterestTransfers">
                            </text-field>

                            <group-field label="Duration For Zero Percentage (Months)">
                                <number-field name="durationForZeroPercentageTransfersInMonths"
                                              [(value)]="model.extendedInfo.durationForZeroPercentageTransfersInMonths"
                                            label="Transfers"></number-field>
                                <number-field name="durationForZeroPercentagePurchasesInMonths"
                                              [(value)]="model.extendedInfo.durationForZeroPercentagePurchasesInMonths"
                                              label="Purchases"></number-field>
                            </group-field>
                        </div>
                    </div>
                </div>
                <div *ngSwitchCase="'flags'">
                    <div class="row">
                        <div class="col-md-5">
                            <dropdown-field name="offerCollection"
                                            [(value)]="model.extendedInfo.offerCollection"
                                            [readOnly]="offerNotInCardCategory$ | async"
                                            [dataSource]="getEnumDataSource(offerCollectionEnum)">
                            </dropdown-field>
                            <dropdown-field name="cardNetwork"
                                            [(value)]="model.extendedInfo.cardNetwork"
                                            [readOnly]="offerNotInCardCategory$ | async"
                                            [dataSource]="getEnumDataSource(cardNetworkEnum)">
                            </dropdown-field>
                        </div>
                        <div class="col-md-5">
                            <dropdown-field name="targetAudience"
                                            [(value)]="model.extendedInfo.targetAudience"
                                            [readOnly]="offerNotInCardCategory$ | async"
                                            [dataSource]="getEnumDataSource(targetAudienceEnum)">
                            </dropdown-field>
                            <dropdown-field name="securingType"
                                            [(value)]="model.extendedInfo.securingType"
                                            [readOnly]="offerNotInCardCategory$ | async"
                                            [dataSource]="getEnumDataSource(securingTypeEnum)">
                            </dropdown-field>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-5" *ngFor="let key of keys(model.extendedInfo.flags)">
                            <checkbox-field [name]="key"
                                            [(value)]="!!model.extendedInfo.flags[key]"
                                            [readOnly]="offerNotInCardCategory$ | async">
                            </checkbox-field>
                        </div>
                    </div>
                </div>

                <div *ngSwitchCase="'stats'">
                    <pfm-click-stats [campaignId]="model.campaignId" [year]="selectedYear" [refresh$]="refresh$"></pfm-click-stats>
                </div>

                <div *ngSwitchCase="'visitors'">
                    <pfm-offer-visitors [campaignId]="model.campaignId"></pfm-offer-visitors>
                </div>

            </ng-container>
        </form>
    </ng-container>
</item-details-layout>
