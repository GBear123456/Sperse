<div>
    <app-headline [names]="[ l('Reports') ]"
                  [buttons]="headlineButtons"
                  [showToggleToolbarButton]="true">
        <dx-select-box *ngIf="section == 'clicks'"
            [items]="years"
            [(value)]="clickStatsYear"
            (selectionChanged)="yearSelectionChanged()">
        </dx-select-box>
    </app-headline>
    <app-toolbar [config]="toolbarConfig"></app-toolbar>
    <div class="main-wrapper wrapper portlet light">
        <setup-steps-common [SetupSteps]="menuItems" [SelectedStepIndex]="0" [HeaderTitle]="''"></setup-steps-common>
        <div #rightSection>
            <div [hidden]="section != 'clicks'">
                <pfm-click-stats [campaignId]="undefined" [year]="clickStatsYear" [refresh$]="refresh$" (onStatsClick)="onStatsClick($event)"></pfm-click-stats>
            </div>
            <div class="offers-section">
                <dx-data-grid id="gridContainer" #offerStatsGrid
                              [visible]="section == 'offers'"
                              [dataSource]="offerStatsDataSource"
                              [pager]="defaultGridPagerConfig"
                              (onDataErrorOccurred)="httpInterceptor.handleError($event.error)">
                    <dxi-column dataField="LogoUrl" caption="Logo" cellTemplate="photoTemplate"
                                [width]="140" [showInColumnChooser]="false" [allowExporting]="false"
                                [allowGrouping]="false" [allowSorting]="false"></dxi-column>
                    <dxi-column dataField="Name" [caption]="l('Offer_Name')" cssClass="clipboard-holder"></dxi-column>
                    <dxi-column dataField="Categories" [caption]="l('Offer_Category')" [width]="300" [calculateSortValue]="getCategoryValue" [calculateGroupValue]="getCategoryValue" [calculateCellValue]="getCategoryValue" cssClass="clipboard-holder"></dxi-column>
                    <dxi-column dataField="RequestCount" [caption]="l('Offer_ClickCount')" cellTemplate="clicksTemplate" [width]="150"></dxi-column>

                    <div *dxTemplate="let field of 'photoTemplate'">
                        <div [ngStyle]="{'background-image': 'url(' + field.data.LogoUrl + ')'}" class="logo-url"></div>
                    </div>

                    <div *dxTemplate="let field of 'clicksTemplate'">
                        <div class="clicksCount" (click)="onOfferClicksClick(field)" class="clipboard-holder">{{field.data.RequestCount}}</div>
                    </div>
                </dx-data-grid>
            </div>
            <div>
                <dx-data-grid id="gridContainer" #visitorsGrid
                              [dataSource]="visitorsDataSource"
                              [allowColumnReordering]="true"
                              [allowColumnResizing]="true"
                              [hoverStateEnabled]="true"
                              [pager]="defaultGridPagerConfig"
                              [visible]="section == 'visitors'"
                              (onCellClick)="onVisitorCellClick($event)"
                              (onDataErrorOccurred)="httpInterceptor.handleError($event.error)">
                    <dxi-column [caption]="l('Name')" [calculateDisplayValue]="getVisitorFullName" cssClass="clipboard-holder"></dxi-column>
                    <dxi-column dataField="State" [caption]="l('State')" [width]="160" calculateSortValue="StateCode" cssClass="clipboard-holder"></dxi-column>
                    <dxi-column dataField="Email" [caption]="l('Email')" cssClass="clipboard-holder"></dxi-column>
                    <dxi-column dataField="PhoneNumber" [caption]="l('PhoneNumber')" cssClass="clipboard-holder"></dxi-column>
                    <dxi-column dataField="Date" [caption]="l('Created')" [calculateDisplayValue]="getCreatedDate" cssClass="clipboard-holder"></dxi-column>
                    <dxi-column dataField="DoB" [caption]="l('Birthday')" dataType="date" format="dd/MM/yyyy" cssClass="clipboard-holder"></dxi-column>
                    <dxi-column dataField="CampaignName" [caption]="l('CampaignName')" cssClass="clipboard-holder"></dxi-column>

                    <dxo-group-panel [visible]="false"></dxo-group-panel>
                    <dxo-sorting mode="multiple"></dxo-sorting>
                </dx-data-grid>
            </div>
        </div>
    </div>
</div>
