<modal-dialog>
   <header class="container">
        <h1>
            <span (click)="inPlaceEdit('transactionDescriptor', transactionInfo)" *ngIf="transactionInfo?.transactionDescriptor && !transactionInfo['inplaceEdit']">
                {{ transactionInfo?.transactionDescriptor }} <i class="icon blue-edit-pencil">&nbsp;</i>
            </span>
            <span *ngIf="!transactionInfo?.transactionDescriptor && !transactionInfo['inplaceEdit']">
                <a (click)="inPlaceEdit('transactionDescriptor', transactionInfo)">
                    {{ls.l("TransactionDetail_Add_descriptor")}} <i class="plus">+</i>
                </a>
            </span>
            <span *ngIf="transactionInfo['inplaceEdit']" class="inplace-edit-wrapper">
                <dx-text-box class="tabular"
                             placeholder=""
                             [(value)]="transactionInfo.transactionDescriptor"></dx-text-box>
                <dx-button class="update" icon="todo" (onClick)="updateDescriptor()"></dx-button>
                <dx-button class="exit" icon="close" (onClick)="closeInPlaceEdit('transactionDescriptor', transactionInfo)"></dx-button>
            </span>
        </h1>
        <span class="type" [ngClass]="transactionInfo?.cashFlowTypeId == 'I' ? 'inflows' : 'outflows'">
            <ng-container *ngIf="transactionInfo?.cashFlowTypeId == 'I'; else outflowsTemplate">
                {{ls.l("TransactionDetail_Inflows")}}
            </ng-container>
            <ng-template #outflowsTemplate>
                {{ls.l("TransactionDetail_Outflows")}}
            </ng-template>
        </span>
    </header>

    <main class="text-left container">
        <dx-scroll-view showScrollbar="onHover">
            <div class="row aligned-center">
                <div class="col-3 text-right light-gray">{{ls.l("Category")}}</div>
                <div class="col-6 truncate category-row" [title]="categoryPathTitle">
                    <ng-container *ngIf="transactionInfo.accountingType">
                        <dx-select-box [items]="accountingTypes"
                                       displayExpr="name"
                                       accessKey="accType-select"
                                       valueExpr="key"
                                       itemTemplate="itemTemplate"
                                       [(value)]="selectedAccountingTypeKey"
                                       [disabled]="!isEditAllowed"
                                       [placeholder]="transactionInfo?.accountingType"
                                       (onValueChanged)="getFilteredCategoriesData(transactionInfo, selectedAccountingTypeKey)">
                            <div *dxTemplate="let item of 'itemTemplate'">
                                <span [title]="item.name">{{ item.name }}</span>
                            </div>
                        </dx-select-box>
                        <ng-container *ngIf="transactionInfo?.cashflowCategory">
                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                            <dx-select-box [items]="filteredCategory"
                                           displayExpr="name"
                                           accessKey="category-select"
                                           itemTemplate="itemTemplate"
                                           [disabled]="!isEditAllowed || !selectedAccountingTypeKey"
                                           [placeholder]="transactionInfo?.cashflowCategory"
                                           valueExpr="key"
                                           [(value)]="selectedCategoryKey"
                                           (onValueChanged)="getFilteredSubCategoriesData(transactionInfo, selectedCategoryKey)"
                                           (onItemClick)="confirmUpdateTransactionCategory($event)">
                                <div *dxTemplate="let item of 'itemTemplate'">
                                    <span [title]="item.name">{{ item.name }}</span>
                                </div>
                            </dx-select-box>
                            <ng-container *ngIf="transactionInfo?.cashflowSubCategory || filteredSubCategory.length">
                                <i class="fa fa-angle-right" aria-hidden="true"></i>
                                <dx-select-box [items]="filteredSubCategory"
                                               accessKey="category-select"
                                               itemTemplate="itemTemplate"
                                               [disabled]="!isEditAllowed || !selectedCategoryKey"
                                               [(value)]="selectedSubCategoryKey"
                                               [inputAttr]="{ title: transactionInfo?.cashflowSubCategory ? null : ls.l('TransactionDetail_Choose_Transaction_Category') }"
                                               [placeholder]="transactionInfo?.cashflowSubCategory ? transactionInfo?.cashflowSubCategory : ls.l('TransactionDetail_Choose_Transaction_Category')"
                                               displayExpr="name"
                                               valueExpr="key"
                                               (onItemClick)="updateTransactionCategory($event)">
                                    <div *dxTemplate="let item of 'itemTemplate'">
                                        <span [title]="item.name">{{ item.name }}</span>
                                    </div>
                                </dx-select-box>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                    <ng-container *ngIf="!transactionInfo.accountingType">
                        <div *ngIf="!selectedAccountingTypeKey" class="unclassified-label">{{ls.l("TransactionDetail_Unclassified")}}</div>
                        <dx-select-box [items]="accountingTypes"
                                       displayExpr="name"
                                       valueExpr="key"
                                       accessKey="category-select"
                                       [disabled]="!isEditAllowed"
                                       [(value)]="selectedAccountingTypeKey"
                                       [inputAttr]="{ title: accountingTypes.length ? '' : ls.l('TransactionDetail_Choose_Accounting_Type')}"
                                       [placeholder]="ls.l('TransactionDetail_Choose_Accounting_Type')"
                                       itemTemplate="itemTemplate"
                                       (onValueChanged)="getFilteredCategoriesData(transactionInfo, selectedAccountingTypeKey)">
                            <div *dxTemplate="let item of 'itemTemplate'">
                                <span [title]="item.name">{{ item.name }}</span>
                            </div>
                        </dx-select-box>
                        <ng-container *ngIf="filteredCategory.length">
                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                            <dx-select-box [items]="filteredCategory"
                                           [inputAttr]="{ title: ls.l('TransactionDetail_Choose_Transaction_Category') }"
                                           displayExpr="name"
                                           valueExpr="key"
                                           accessKey="category-select"
                                           itemTemplate="itemTemplate"
                                           [disabled]="!isEditAllowed"
                                           [(value)]="selectedCategoryKey"
                                           [placeholder]="ls.l('TransactionDetail_Choose_Transaction_Category')"
                                           (onValueChanged)="getFilteredSubCategoriesData(transactionInfo, selectedCategoryKey)"
                                           (onItemClick)="confirmUpdateTransactionCategory($event)">
                                <div *dxTemplate="let item of 'itemTemplate'">
                                    <span [title]="item.name">{{ item.name }}</span>
                                </div>
                            </dx-select-box>
                        </ng-container>
                        <ng-container *ngIf="filteredSubCategory.length">
                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                            <dx-select-box [items]="filteredSubCategory"
                                           displayExpr="name"
                                           accessKey="category-select"
                                           itemTemplate="itemTemplate"
                                           [disabled]="!isEditAllowed"
                                           [(value)]="selectedSubCategoryKey"
                                           [inputAttr]="{ title: ls.l('TransactionDetail_Choose_Transaction_SubCategory') }"
                                           [placeholder]="ls.l('TransactionDetail_Choose_Transaction_SubCategory')"
                                           (onItemClick)="updateTransactionCategory($event)"
                                           valueExpr="key">
                                <div *dxTemplate="let item of 'itemTemplate'">
                                    <span [title]="item.name">{{ item.name }}</span>
                                </div>
                            </dx-select-box>
                        </ng-container>
                    </ng-container>
                </div>
                <div class="col-1 text-right light-gray">ID</div>
                <div class="col-2 text-right tabular">{{transactionInfo?.id}}</div>
            </div>
            <div class="row">
                <div class="col-3 text-right light-gray">{{ls.l("TransactionDetail_Notes")}}</div>
                <div class="col-9">
                    <div class="comments" *ngFor="let comment of transactionInfo?.comments">
                        <div (click)="inPlaceEdit('text', comment)" *ngIf="!comment.inplaceEdit">
                            {{comment.text}} <i class="icon blue-edit-pencil">&nbsp;</i>
                        </div>
                        <span *ngIf="comment.inplaceEdit" class="inplace-edit-wrapper">
                            <dx-text-box class="tabular"
                                         [(value)]="comment.text"></dx-text-box>
                            <dx-button class="update" icon="todo" (onClick)="updateComment('text', comment)"></dx-button>
                            <dx-button class="exit" icon="close" (onClick)="closeInPlaceEdit('text', comment)"></dx-button>
                        </span>
                    </div>
                    <div class="add-comment">
                        <a (click)="inPlaceCreateComment($event)" *ngIf="!newComment.inplaceEdit">
                            {{ls.l("TransactionDetail_Add_comment")}} <i class="plus">+</i>
                        </a>
                        <span *ngIf="newComment.inplaceEdit" class="inplace-edit-wrapper">
                            <dx-text-box class="tabular"
                                         [(value)]="newComment.text"></dx-text-box>
                            <dx-button class="update" icon="todo" (onClick)="addNewComment()"></dx-button>
                            <dx-button class="exit" icon="close" (onClick)="closeInPlaceEdit('text', newComment)"></dx-button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">
                    <hr>
                </div>
            </div>
            <div class="row">
                <div class="col-3 text-right light-gray">{{ls.l("TransactionDetail_Date")}}</div>
                <div class="col-4">{{transactionInfo?.date | date : 'MMM d, y'}}</div>
                <div class="col-3 text-right light-gray truncate" title="{{transactionInfo?.bankAccountBankName}}">{{transactionInfo?.bankAccountBankName}}</div>
                <div class="col-2 text-right tabular"><b>{{transactionInfo?.bankAccountNumber}}</b></div>
            </div>
            <div class="row">
                <div class="col-3 text-right light-gray">{{ls.l("TransactionDetail_Amount")}}</div>
                <div class="col-4 amount">{{transactionInfo?.amount | currency:cfoPreferencesService.selectedCurrencyId:cfoPreferencesService.selectedCurrencySymbol:'1.2-2'}}</div>
                <div class="col-3 text-right light-gray">{{ls.l("TransactionDetail_Status")}}</div>
                <div class="col-2 text-right tabular status"><span ngClass="{{transactionInfo?.transactionStatus | lowercase}}">{{transactionInfo?.transactionStatus}}</span></div>
            </div>
            <div class="row">
                <div class="col-3"></div>
                <div class="col-9">
                    <hr>
                </div>
            </div>
            <div class="row">
                <div class="col-3 text-right light-gray">{{ls.l("TransactionDetail_Description")}}</div>
                <div class="col-9 wrap uppercase">{{transactionInfo?.description}}</div>
            </div>

            <ng-container *ngIf="transactionInfo?.attributes && transactionInfo?.attributes.length">
                <div class="row">
                    <div class="col-3"></div>
                    <div class="col-9">
                        <hr>
                    </div>
                </div>
                <div class="sorted-attributes">
                    <ng-container *ngFor="let attr of transactionInfo?.attributes; trackBy: trackElement">
                        <div class="row align-items-center" [ngClass]="attr.typeId">
                            <div class="col-3 text-right light-gray">{{ transactionAttributeTypes ? transactionAttributeTypes[attr.typeId].name : '' }}</div>
                            <div class="col-9">{{attr.value}}</div>
                        </div>
                    </ng-container>
                </div>
            </ng-container>
        </dx-scroll-view>
    </main>
</modal-dialog>
