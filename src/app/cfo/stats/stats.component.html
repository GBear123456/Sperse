<app-headline [names]="[ l('Daily Cash Balances') ]"
              iconSrc="assets/common/icons/pulse-icon.svg"
              [buttons]="headlineButtons"
              [showReloadButton]="showReload"
              [showToggleToolbarButton]="true"
              (onReload)="reload()"
              (onToggleToolbar)="toggleToolbar()">
    <business-entities-chooser (onFilterButtonClick)="openBankAccountsSelectDialog()"></business-entities-chooser>
    <synch-progress class="synch-progress" (onComplete)="getUpdatedDataSource()"></synch-progress>
    <calendar-button></calendar-button>
</app-headline>
<app-toolbar [config]="toolbarConfig" [hidden]="appService.toolbarIsHidden$ | async"></app-toolbar>
<div [hidden]="!statsData || !statsData.length">
    <div class="mainStatsView">
        <setup-steps
            [SetupSteps]="leftSideBarItems"
            SelectedStepIndex="0"
            HeaderTitle=""
            (onToggle)="calculateChartsSize()"></setup-steps>
        <source-data [ngClass]="{'showen': showSourceData}"
                     (onClose)="hideSourceDataWidget()"
                     [historicalSourceData]="historicalSourceData"
                     [forecastSourceData]="forecastSourceData">
        </source-data>
        <div class="charts">
            <dx-scroll-view showScrollbar="onHover" [height]="calculateChartsScrolableHeight()">
                <!-- Top linear chart -->
                <div class="chart">
                    <div class="header">
                        <h2>{{l('Stats_Header_Trends')}}</h2>
                        <div class="btn-setion">
                            <p class="title">{{l('Monthly_Ending_Balances')}}</p>
                            <button>
                                <i class="fa fa-angle-right" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <dx-chart id="chart"
                              [dataSource]="statsData"
                              animation="{easing: 'easeOutCubic',duration: 2000}"
                              [customizePoint]="customizePoint"
                              resolveLabelOverlapping="stack"
                              (onDone)="onDone($event)"
                              #linearChart>
                        <dxo-adaptive-layout width="500px"></dxo-adaptive-layout>
                        <dxo-size [width]="chartsWidth" [height]="chartsHeight / 2"></dxo-size>
                        <!-- common settings for charts -->
                        <dxo-common-series-settings
                            argumentField="date"
                            [showInLegend]="false"
                            [maxLabelCount]="maxLabelCount"
                            [ignoreEmptyPoints]="true"
                            hoverMode="none">
                            <dxo-label [visible]="false" [backgroundColor]="labelPositiveBackgroundColor">
                                <dxo-format type="currency largeNumber" [currency]="cfoPreferencesService.selectedCurrencyId">
                                </dxo-format>
                                <dxo-font size="10px" [weight]="300"></dxo-font>
                            </dxo-label>
                            <dxo-point size="8"></dxo-point>
                        </dxo-common-series-settings>
                        <dxo-tooltip [enabled]="true"
                                     [zIndex]="1"
                                     [customizeTooltip]="customizeBarTooltip">
                        </dxo-tooltip>
                        <dxi-series name="forecastGradient"
                                    pane="topPane"
                                    color="url(#forecast-linear-gradient)"
                                    type="rangeArea"
                                    rangeValue1Field="forecastMinRange"
                                    rangeValue2Field="forecastEndingBalance">
                            <dxo-label [visible]="false"></dxo-label>
                        </dxi-series>
                        <dxi-series name="forecast"
                                    [color]="forecastEndingBalanceColor"
                                    valueField="forecastEndingBalance"
                                    pane="topPane">
                        </dxi-series>
                        <dxi-series name="historicalGradient"
                                    pane="topPane"
                                    color="url(#historical-linear-gradient)"
                                    type="rangeArea"
                                    rangeValue1Field="minRange" rangeValue2Field="endingBalance">
                            <dxo-label [visible]="false"></dxo-label>
                        </dxi-series>
                        <dxi-series name="historical"
                                    [color]="historicalEndingBalanceColor"
                                    valueField="endingBalance"
                                    pane="topPane">
                        </dxi-series>
                        <dxi-pane name="topPane"></dxi-pane>
                        <!-- Left axis -->
                        <dxi-value-axis>
                            <dxo-label [customizeText]="customizeAxisValues">
                                <dxo-format type="currency largeNumber">
                                </dxo-format>
                            </dxo-label>
                            <dxo-grid color="#e5e9ec" [visible]="true"></dxo-grid>
                        </dxi-value-axis>
                        <!-- Bottom axis -->
                        <dxo-argument-axis argumentType="datetime" [visible]="true" type="discrete">
                            <dxo-label [customizeText]="customizeBottomAxis">
                                <dxo-format [type]="axisDateFormat"></dxo-format>
                            </dxo-label>
                            <dxo-tick-interval [months]="1"></dxo-tick-interval>
                        </dxo-argument-axis>
                        <!-- Common settings for axis -->
                        <dxo-common-axis-settings [allowDecimals]="false">
                            <dxo-label alignment="center" overlappingBehavior="hide">
                                <dxo-font [weight]="300" color="#677380" size="12px"></dxo-font>
                            </dxo-label>
                            <dxo-strip-style>
                                <dxo-label horizontal-allignment="center"></dxo-label>
                            </dxo-strip-style>
                        </dxo-common-axis-settings>
                    </dx-chart>
                </div>

                <div class="chart">
                    <div class="header">
                        <h2>{{l('Stats_Header_Inflows_Outflows')}}</h2>
                        <div class="legend" [hidden]="!statsData || !statsData.length">
                            <ul class="legend-list">
                                <li class="label legend-item">{{l('Historical')}}:</li>
                                <li class="legend-item inflow">{{l('Stats_Inflows')}}</li>
                                <li class="legend-item outflows">{{l('Stats_Outflows')}}</li>
                                <li class="legend-item net-change">{{l('Net_Change')}}</li>
                            </ul>
                            <ng-container *ngIf="isForecast">
                                <ul class="legend-list">
                                    <li class="label legend-item">{{l('Forecast')}}:</li>
                                    <li class="legend-item forecast inflow">{{l('Stats_Inflows')}}</li>
                                    <li class="legend-item forecast outflows">{{l('Stats_Outflows')}}</li>
                                    <li class="legend-item forecast net-change">{{l('Net_Change')}}</li>
                                </ul>
                            </ng-container>
                        </div>
                    </div>
                    <dx-chart id="bar"
                            [dataSource]="statsData"
                            animation="{easing: 'easeOutCubic',duration: 2000}"
                            [barWidth]="0.5"
                            (onDone)="onDone($event)"
                            #barChart>
                        <dxo-size [width]="chartsWidth" [height]="chartsHeight / 2"></dxo-size>
                        <!-- common settings for charts -->
                        <dxo-common-series-settings argumentField="date"
                                                    type="stackedBar"
                                                    [showInLegend]="false"
                                                    [ignoreEmptyPoints]="true">
                        </dxo-common-series-settings>
                        <dxo-tooltip [enabled]="true"
                                     [zIndex]="1"
                                     [customizeTooltip]="customizeBarTooltip">
                        </dxo-tooltip>
                        <dxi-series [color]="historicalCreditColor" valueField="credit" name="historical"></dxi-series>
                        <dxi-series [color]="historicalDebitColor" valueField="debit" name="historicalDebit"></dxi-series>
                        <dxi-series [color]="forecastCreditColor" valueField="forecastCredit" name="forecast"></dxi-series>
                        <dxi-series [color]="forecastDebitColor" valueField="forecastDebit" name="forecastDebit"></dxi-series>
                        <dxi-series type="line"
                                    [color]="historicalNetChangeColor"
                                    valueField="netChange"
                                    name="netChange">
                        </dxi-series>
                        <dxi-series type="line"
                                    [color]="forecastNetChangeColor"
                                    valueField="forecastNetChange"
                                    name="forecastNetChange">
                        </dxi-series>

                        <!-- Bottom axis -->
                        <dxo-argument-axis argumentType="datetime"
                                        [visible]="true"
                                        type="discrete">
                            <dxo-label [customizeText]="customizeBottomAxis">
                                <dxo-format [type]="axisDateFormat">
                                </dxo-format>
                            </dxo-label>
                            <dxo-tick-interval [months]="1"></dxo-tick-interval>
                        </dxo-argument-axis>

                        <!-- Left axis -->
                        <dxi-value-axis>
                            <dxo-label [customizeText]="customizeAxisValues">
                                <dxo-format type="currency largeNumber">
                                </dxo-format>
                            </dxo-label>
                            <dxo-grid color="#e5e9ec" [visible]="true"></dxo-grid>
                        </dxi-value-axis>
                        <!-- Common settings for axis -->
                        <dxo-common-axis-settings [allowDecimals]="false">
                            <dxo-label alignment="center">
                                <dxo-font [weight]="300" color="#677380" size="12px"></dxo-font>
                            </dxo-label>
                            <dxo-strip-style>
                                <dxo-label horizontal-allignment="center"></dxo-label>
                            </dxo-strip-style>
                        </dxo-common-axis-settings>
                    </dx-chart>
                </div>
            </dx-scroll-view>
        </div>

    </div>

    <svg>
        <linearGradient id="historical-linear-gradient" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="rgba(0, 174, 239, .5)"/>
            <stop offset="100%" stop-color="#fff"/>
        </linearGradient>

        <linearGradient id="forecast-linear-gradient" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="rgba(249, 186, 78, .5)"/>
            <stop offset="100%" stop-color="#fff"/>
        </linearGradient>
    </svg>
</div>

<app-no-data
    *ngIf="loadingFinished && (!statsData || !statsData.length)"
    [showLink]="false">
</app-no-data>
