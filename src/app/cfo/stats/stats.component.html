<app-headline [config]="headlineConfig">
    <synch-progress class="synch-progress" (onComplete)="getUpdatedDataSource()"></synch-progress>
</app-headline>

<div [hidden]="!statsData || !statsData.length">
    <div class="mainStatsView">
        <setup-steps [SetupSteps]="leftSideBarItems" SelectedStepIndex="0" HeaderTitle=""></setup-steps>
        <source-data [ngClass]="{'showen': showSourceData}"
                     (onClose)="hideSourceDataWidget()"
                     [historicalSourceData]="historicalSourceData"
                     [forecastSourceData]="forecastSourceData">
        </source-data>
        <div class="charts">
            <dx-scroll-view showScrollbar="onHover" [height]="calculateChartsScrolableHeight()">
                <!-- Top linear chart -->
                <div class="header">
                    <h2>{{l('Stats_Header_Trends')}}</h2>
                    <div class="btn-setion">
                        <p class="title">{{l('Monthly_Ending_Balances')}}</p>
                        <button>
                            <i class="fa fa-angle-right" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
                <dx-chart id="chart"
                          [dataSource]="statsData"
                          animation="{easing: 'easeOutCubic',duration: 2000}"
                          [customizePoint]="customizePoint"
                          (onDone)="onDone($event)"
                          resolveLabelOverlapping="stack"
                          #linearChart>
                    <dxo-size [width]="chartsWidth" [height]="chartsHeight / 2"></dxo-size>
                    <!-- common settings for charts -->
                    <dxo-common-series-settings argumentField="date"
                                                [showInLegend]="false"
                                                [maxLabelCount]="maxLabelCount"
                                                ignoreEmptyPoints="true"
                                                hoverMode="none">
                        <dxo-label [visible]="false"
                                   [backgroundColor]="labelPositiveBackgroundColor">
                            <dxo-format type="currency largeNumber"
                                        [currency]="currency">
                            </dxo-format>
                            <dxo-font size="10px" weight="300"></dxo-font>
                        </dxo-label>
                        <dxo-point size="8"></dxo-point>
                    </dxo-common-series-settings>
                    <dxo-tooltip enabled="true"
                                 zIndex="1"
                                 [customizeTooltip]="customizeBarTooltip">
                    </dxo-tooltip>
                    <dxi-series pane="topPane"
                                color="url(#forecast-linear-gradient)"
                                type="rangeArea"
                                rangeValue1Field="minRange"
                                rangeValue2Field="forecastEndingBalance">
                        <dxo-label [visible]="false"></dxo-label>
                    </dxi-series>
                    <dxi-series name="forecast"
                                pane="topPane"
                                [color]="forecastEndingBalanceColor"
                                valueField="forecastEndingBalance">
                    </dxi-series>
                    <dxi-series pane="topPane"
                                color="url(#historical-linear-gradient)"
                                type="rangeArea"
                                rangeValue1Field="minRange"
                                rangeValue2Field="endingBalance">
                        <dxo-label [visible]="false"></dxo-label>
                    </dxi-series>
                    <dxi-series name="historical"
                                [color]="historicalEndingBalanceColor"
                                valueField="endingBalance"
                                pane="topPane">
                    </dxi-series>
                    <dxi-pane name="topPane"></dxi-pane>
                    <!-- Left axis -->
                    <dxi-value-axis>
                        <dxo-label [customizeText]="customizeAxisValues">
                            <dxo-format type="currency largeNumber"
                                        [currency]="currency">
                            </dxo-format>
                        </dxo-label>
                        <dxo-grid color="#e5e9ec" [visible]="true"></dxo-grid>
                    </dxi-value-axis>
                    <!-- Bottom axis -->
                    <dxo-argument-axis argumentType="datetime"
                                       visible="true"
                                       type="discrete">
                        <dxo-label [customizeText]="customizeBottomAxis">
                            <dxo-format [type]="axisDateFormat">
                            </dxo-format>
                        </dxo-label>
                        <dxo-tick-interval months="1"></dxo-tick-interval>
                    </dxo-argument-axis>
                    <!-- Common settings for axis -->
                    <dxo-common-axis-settings allowDecimals="false">
                        <dxo-label alignment="center" overlappingBehavior="hide">
                            <dxo-font weight="300" color="#677380" size="12px"></dxo-font>
                        </dxo-label>
                        <dxo-strip-style>
                            <dxo-label horizontal-allignment="center"></dxo-label>
                        </dxo-strip-style>
                    </dxo-common-axis-settings>
                </dx-chart>
                <div class="header">
                    <h2>{{l('Stats_Header_Inflows_Outflows')}}</h2>
                    <div class="legend" [hidden]="!statsData || !statsData.length">
                        <ul class="legend-list">
                            <li class="label legend-item">{{l('Historical')}}:</li>
                            <li class="legend-item inflow">{{l('Stats_Inflows')}}</li>
                            <li class="legend-item outflows">{{l('Stats_Outflows')}}</li>
                            <li class="legend-item net-change">{{l('Net_Change')}}</li>
                        </ul>
                        <ng-container *ngIf="isForecast">
                            <ul class="legend-list">
                                <li class="label legend-item">{{l('Forecast')}}:</li>
                                <li class="legend-item forecast inflow">{{l('Stats_Inflows')}}</li>
                                <li class="legend-item forecast outflows">{{l('Stats_Outflows')}}</li>
                                <li class="legend-item forecast net-change">{{l('Net_Change')}}</li>
                            </ul>
                        </ng-container>
                    </div>
                </div>
                <dx-chart id="bar"
                          [dataSource]="statsData"
                          defaultPane="bottomPane"
                          animation="{easing: 'easeOutCubic',duration: 2000}"
                          [barWidth]="0.5"
                          (onDone)="onDone($event)"
                          #barChart>
                    <dxo-size [width]="chartsWidth" [height]="chartsHeight / 2"></dxo-size>
                    <!-- common settings for charts -->
                    <dxo-common-series-settings argumentField="date"
                                                type="stackedBar"
                                                [showInLegend]="false"
                                                ignoreEmptyPoints="true">
                    </dxo-common-series-settings>
                    <dxo-tooltip enabled="true"
                                 zIndex="1"
                                 [customizeTooltip]="customizeBarTooltip">
                    </dxo-tooltip>
                    <dxi-series [color]="historicalCreditColor" valueField="credit" name="historical"></dxi-series>
                    <dxi-series [color]="historicalDebitColor" valueField="debit" name="historicalDebit"></dxi-series>
                    <dxi-series [color]="forecastCreditColor" valueField="forecastCredit" name="forecast"></dxi-series>
                    <dxi-series [color]="forecastDebitColor" valueField="forecastDebit" name="forecastDebit"></dxi-series>
                    <dxi-series type="line"
                                [color]="historicalNetChangeColor"
                                valueField="netChange"
                                name="netChange">
                    </dxi-series>
                    <dxi-series type="line"
                                [color]="forecastNetChangeColor"
                                valueField="forecastNetChange"
                                name="forecastNetChange">
                    </dxi-series>
                    <!-- Bottom axis -->
                    <dxo-argument-axis argumentType="datetime"
                                       visible="true"
                                       type="discrete">
                        <dxo-label [customizeText]="customizeBottomAxis">
                            <dxo-format [type]="axisDateFormat">
                            </dxo-format>
                        </dxo-label>
                        <dxo-tick-interval months="1"></dxo-tick-interval>
                    </dxo-argument-axis>
                    <!-- Left axis -->
                    <dxi-value-axis>
                        <dxo-label [customizeText]="customizeAxisValues">
                            <dxo-format type="currency largeNumber"
                                        [currency]="currency">
                            </dxo-format>
                        </dxo-label>
                        <dxo-grid color="#e5e9ec" [visible]="true"></dxo-grid>
                    </dxi-value-axis>
                    <!-- Common settings for axis -->
                    <dxo-common-axis-settings allowDecimals="false">
                        <dxo-label alignment="center">
                            <dxo-font weight="300" color="#677380" size="12px"></dxo-font>
                        </dxo-label>
                        <dxo-strip-style>
                            <dxo-label horizontal-allignment="center"></dxo-label>
                        </dxo-strip-style>
                    </dxo-common-axis-settings>
                </dx-chart>
            </dx-scroll-view>
        </div>

    </div>

    <svg>
        <linearGradient id="historical-linear-gradient" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="rgba(0, 174, 239, .5)"/>
            <stop offset="100%" stop-color="#fff"/>
        </linearGradient>

        <linearGradient id="forecast-linear-gradient" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="rgba(249, 186, 78, .5)"/>
            <stop offset="100%" stop-color="#fff"/>
        </linearGradient>
    </svg>
</div>

<dx-tooltip target="[aria-label='Report Period']"
            [(visible)]="reportPeriodTooltipVisible">
    <div *dxTemplate="let data = data of 'content'">
        <div class="report-period-tooltip-container">
            <div class="actions">
                <span class="filter-clear" (click)="clear()">{{l('Clear')}}</span>
                <span class="filter-apply" (click)="apply()">{{l('Apply')}}</span>
            </div>
            <div class="report-period-title">
                <span class="title">{{ls('CFO','CashflowToolbar_Report_Period_Title')}}</span>
                <span class="start">{{sliderReportPeriod.start}}</span>
                to
                <span class="end">{{sliderReportPeriod.end}}</span>
            </div>

            <dx-range-slider [min]="sliderReportPeriod.minDate"
                             [max]="sliderReportPeriod.maxDate"
                             [(start)]="sliderReportPeriod.start"
                             [(end)]="sliderReportPeriod.end"
                             [step]="1">
            </dx-range-slider>
        </div>
    </div>
</dx-tooltip>

<bank-accounts-select targetBankAccountsTooltip="[aria-label='Accounts']"
                      (onBankAccountsSelected)="setBankAccountsFilter($event)">
</bank-accounts-select>

<app-no-data
    *ngIf="loadingFinished && (!statsData || !statsData.length)"
    [showLink]="false">
</app-no-data>
