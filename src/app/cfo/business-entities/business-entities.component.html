<div>
    <app-headline [names]="[ l('Setup_Title'), l('SetupStep_BusinessEntities') ]"
                  iconSrc="assets/common/icons/magic-stick-icon.svg"
                  [buttons]="headlineButtons"
                  [showReloadButton]="ui.showReload"
                  [showToggleColumnSelectorButton]="true"
                  [showToggleCompactViewButton]="true"
                  [showToggleFullScreenButton]="true"
                  [showToggleLeftMenuButton]="true"
                  [showStateResetButton]="true"
                  (onReload)="refreshDataGrid()"
                  (onStateReset)="dataGrid.instance.state(null)"
                  (onToggleColumnSelector)="toggleColumnChooser()"
                  (onToggleCompactView)="toggleCompactView()"
                  (onToggleFullScreen)="repaintDataGrid()">
    </app-headline>
    <div class="content-wrap">
        <cfo-left-menu [selectedItemIndex]="1"></cfo-left-menu>
        <dx-scroll-view showScrollbar="onHover" [width]="contentWidth$ | async">
            <div class="grid-wrapper">
                <ghost-list [hidden]="isDataLoaded"></ghost-list>
                <dx-data-grid id="gridContainer"
                            class="main-component-view"
                            [dataSource]="dataSource"
                            [allowColumnReordering]="true"
                            [columnAutoWidth]="true"
                            [allowColumnResizing]="true"
                            [hoverStateEnabled]="true"
                            [columnResizingMode]="'widget'"
                            [loadPanel]="{ enabled: false }"
                            (onDataErrorOccurred)="httpInterceptor.handleError($event.error)"
                            (onCellClick)="onCellClick($event)"
                            (onContentReady)="onContentReady()"
                            (onOptionChanged)="onGridOptionChanged($event)"
                            (onCellPrepared)="onCellPrepared($event)">
                    <dxo-selection selectAllMode="page"
                                showCheckBoxesMode="always"
                                mode="multiple"></dxo-selection>
                    <dxo-sorting mode="multiple"></dxo-sorting>
                    <dxi-column [caption]="l('BusinessEntities_Name')"
                                cssClass="clipboard-holder"
                                [dataField]="businessEntityFields.Name"
                                [width]="250">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_Accounts')"
                                name="BankAccountIds"
                                [dataField]="businessEntityFields.BankAccountIds"
                                [width]="200"
                                [allowSorting]="false"
                                cellTemplate="accountsTemplate">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_Parent')"
                                cssClass="clipboard-holder"
                                [dataField]="businessEntityFields.ParentName"
                                [width]="250">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_Location')"
                                cssClass="clipboard-holder"
                                name="location"
                                [calculateCellValue]="locationColumn_calculateCellValue">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_DateOpened')"
                                cssClass="clipboard-holder"
                                [dataField]="businessEntityFields.DateOpened"
                                cellTemplate="dateOpenedTemplate">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_TaxNumber')"
                                cssClass="clipboard-holder"
                                [dataField]="businessEntityFields.TaxNumber">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_Phone')"
                                [dataField]="businessEntityFields.Phone"
                                cellTemplate="phoneCell"
                                cssClass="tabular"
                                [visible]="false">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_Type')"
                                cssClass="clipboard-holder"
                                [dataField]="businessEntityFields.Type">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_Industry')"
                                cssClass="clipboard-holder"
                                [dataField]="businessEntityFields.Industry"
                                [visible]="false">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_Status')"
                                [width]="150"
                                [dataField]="businessEntityFields.Status"
                                cssClass="status"
                                alignment="center"
                                cellTemplate="statusTemplate">
                    </dxi-column>
                    <dxi-column [caption]="l('BusinessEntities_Default')"
                                cssClass="clipboard-holder"
                                [dataField]="businessEntityFields.IsDefault">
                    </dxi-column>

                    <div *dxTemplate="let data of 'dateOpenedTemplate'" class="clipboard-holder">{{data.value | date: 'EEE dd, yyyy' : userTimezone }}</div>
                    <div *dxTemplate="let data of 'phoneCell'" class="clipboard-holder">{{data.value | phone}}</div>
                    <div *dxTemplate="let data of 'statusTemplate'" class="statusContent">
                        <span [ngClass]="data.value.toLowerCase()">
                            <span>
                                {{data.value.toUpperCase()}}
                            </span>
                        </span>
                    </div>
                    <div *dxTemplate="let data of 'accountsTemplate'">
                        <div (click)="openBankAccountSelectComponent(data.data)">
                            <i id="business-entity-arrow-{{data.data.Id}}" class="arrow"></i>
                            <ng-container *ngIf="data.value && data.value.length; else noaccounts">
                                <span class="count">
                                    {{data.value.length | number}} {{data.value.length ===1 ? l('Account'): l('Accounts')}}
                                </span>
                            </ng-container>
                            <ng-template #noaccounts>
                                {{l('Assign')}} {{l('Accounts')}}
                            </ng-template>
                        </div>
                    </div>
                </dx-data-grid>
            </div>
        </dx-scroll-view>
    </div>
</div>
