<div [@routerTransition]>
    <app-headline [config]="headlineConfig"></app-headline>
    <div class="portlet light no-padding margin-bottom-0">
        <div class="portlet-body">
            <div class="main-wrapper" [ngClass]="{'expanded': ctegoriesShowed}">
                <div class="categories" (mouseover)="ctegoriesShowed = true">
                    <categorization [dragMode]="dragInProgress"
                        (close)="ctegoriesShowed = false"                          
                        (onTransactionDrop)="openCategorizationWindow($event)"
                        (onSelectionChanged)="filterByCashflowCategory($event)">
                    </categorization>
                </div>
                <div class="transactions">
                    <dx-data-grid id="gridContainer"
                                  [dataSource]="dataSource"
                                  [allowColumnReordering]="true"
                                  [columnAutoWidth]="true"
                                  [allowColumnResizing]="true"
                                  [hoverStateEnabled]="true"
                                  [columnResizingMode]="'widget'"
                                  (onDataErrorOccurred)="httpConfig.handleError($event.error)"
                                  (onSelectionChanged)="onSelectionChanged($event)">
                        <dxo-selection
                            selectAllMode="page"
                            showCheckBoxesMode="always"
                            mode="multiple">
                        </dxo-selection>
                        <dxo-group-panel [visible]="true"></dxo-group-panel>
                        <dxo-sorting mode="multiple"></dxo-sorting>
                        <dxi-column caption="" 
                            [fixed]="true" 
                            [allowHiding]="false" 
                            [allowResizing]="false" 
                            [allowReordering]="false" 
                            [calculateCellValue]="checkUncategozired"></dxi-column>
                        <dxi-column dataField="Id" cssClass="tabular" caption="{{l('Transactions_Id')}}" sortOrder="desc" sortIndex="1"></dxi-column>
                        <dxi-column dataField="Date" cssClass="tabular" caption="{{l('Transactions_Date')}}" dataType="date" format="shortDate" sortOrder="desc" sortIndex="0"></dxi-column>
                        <dxi-column dataField="BankAccountNumber" cssClass="tabular" caption="{{l('Transactions_BankAccountNumber')}}"></dxi-column>
                        <dxi-column dataField="BankAccountTypeName" caption="{{l('Transactions_BankAccountType')}}"></dxi-column>
                        <dxi-column dataField="CashFlowTypeName" caption="{{l('Transactions_CashFlowType')}}"></dxi-column>
                        <dxi-column dataField="TypeName" caption="{{l('Transactions_Type')}}"></dxi-column>
                        <dxi-column dataField="ExpenseCategoryName" caption="{{l('Transactions_ExpenseCategory')}}"></dxi-column>
                        <dxi-column dataField="Description" caption="{{l('Transactions_Description')}}" [width]="550"></dxi-column>
                        <dxi-column dataField="Amount" cssClass="tabular" name="Debit" caption="{{l('Transactions_Debit')}}" cellTemplate="amountTemplate"></dxi-column>
                        <dxi-column dataField="Amount" cssClass="tabular" name="Credit" caption="{{l('Transactions_Credit')}}" cellTemplate="amountTemplate"></dxi-column>
                        <dxi-column dataField="EndingBalance" cssClass="tabular" caption="{{l('Transactions_EndingBalance')}}" cellTemplate="endBalanceTemplate"></dxi-column>

                        <dxi-column dataField="Amount" cssClass="tabular" name="Amount" caption="{{l('Transactions_Amount')}}" cellTemplate="amountTemplate" [visible]="false"></dxi-column>
                        <dxi-column dataField="BankAccountBankName" caption="{{l('Transactions_BankName')}}" [visible]="false"></dxi-column>
                        <dxi-column dataField="Currency" caption="{{l('Transactions_Currency')}}" [visible]="false"></dxi-column>
                        <dxi-column dataField="CashflowCategoryName" caption="{{l('Transactions_CashflowCategoryName')}}" [visible]="false"></dxi-column>
                        <dxi-column dataField="CashflowCategoryGroupName" caption="{{l('Transactions_CashflowCategoryGroupName')}}" [visible]="false"></dxi-column>
                        <dxi-column dataField="CategoryName" caption="{{l('Transactions_CategoryName')}}" [visible]="false"></dxi-column>
                        <dxi-column dataField="Fees"  cssClass="tabular" caption="{{l('Transactions_Fees')}}" [visible]="false"></dxi-column>
                        <dxi-column dataField="PostDate" cssClass="tabular" caption="{{l('Transactions_PostDate')}}" dataType="date" format="shortDateShortTime" [visible]="false"></dxi-column>
                        <dxi-column dataField="Time" cssClass="tabular" caption="{{l('Transactions_Time')}}" dataType="date" format="shortTime" [visible]="false"></dxi-column>
                        <dxi-column [fixed]="true" [fixedPosition]="'right'" [showInColumnChooser]="false"></dxi-column>

                        <div *dxTemplate="let cell of 'amountTemplate'">
                            <ng-container *ngIf="(cell.text) && ((cell.column.name == 'Amount') || (cell.value >= 0 && cell.column.name == 'Debit') || (cell.value < 0 && cell.column.name == 'Credit'))">
                                <span [ngClass]="{'red': cell.value < 0}"> {{ cell.text | number:'1.2-2' }} </span>
                            </ng-container>
                        </div>
                        <div *dxTemplate="let cell of 'endBalanceTemplate'">
                            <ng-container *ngIf="cell.text">
                                <span class="end-balance{{cell.data['IsBalanceConfirmed'] ? '' : '-not'}}-confirmed"> {{ cell.text | number:'1.2-2' }} </span>
                            </ng-container>
                        </div>
                        <dxo-paging [pageSize]="20"></dxo-paging>
                        <dxo-pager [showPageSizeSelector]="true"
                                   [allowedPageSizes]="[20, 100, 500, 1000, 5000]"
                                   [showInfo]="true">
                        </dxo-pager>
                    </dx-data-grid>

                </div>
            </div>
        </div>
    </div>
</div>
