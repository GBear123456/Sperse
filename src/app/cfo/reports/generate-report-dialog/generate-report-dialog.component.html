<modal-dialog [title]="title"
              [buttons]="buttons">
    <dx-scroll-view showScrollbar="onHover">
        <div *ngIf="currentStep == generateReportSteps.BusinessEntities" class="businessEntities-container">
            <dx-tree-list keyExpr="id"
                          parentIdExpr="parentId"
                          [autoExpandAll]="true"
                          [scrolling]="{ showScrollbar: 'never' }"
                          [selectedRowKeys]="selectedBusinessEntityIds"
                          [dataSource]="bankAccountsService.sortedBusinessEntities$ | async"
                          (onContentReady)="onContentReady($event)"
                          (onSelectionChanged)="onSelectionChanged($event)"
                          (onInitialized)="onInitialized($event)">
                <dxo-selection [allowSelectAll]="true" mode="multiple" [recursive]="true"></dxo-selection>
                <dxi-column dataField="name" [caption]="ls.l('BusinessEntityName') | uppercase"></dxi-column>
                <dxo-scrolling mode="virtual"></dxo-scrolling>
            </dx-tree-list>
        </div>
        <div *ngIf="currentStep == generateReportSteps.Departments" class="departments-container">
            <dx-list width="100%"
                selectionMode="multiple"
                selectAllMode="allPages"
                [(selectedItems)]="selectedDepartments"
                [showSelectionControls]="true"
                [items]="departmentsEntities"
                (onInitialized)="onInitialized($event)">
            </dx-list>
        </div>
        <div *ngIf="currentStep == generateReportSteps.Calendar" class="calendar-container">
            <calendar [values]="calendarData" [options]="calendarData.options"></calendar>
        </div>
        <div *ngIf="currentStep == generateReportSteps.Final" class="final-container">
            <div class="container">
                <div class="row">
                    <div class="text-left">{{ ls.l('Reports_ReportsGrouping') }}</div>
                    <div class="custom-radio-2-btn">
                        <dx-radio-group [dataSource]="radioGroupGrouping"
                                        [disabled]="generatingStarted"
                                        displayExpr="text"
                                        valueExpr="value"
                                        layout="horizontal"
                                        name="isSeparateGrouping"
                                        [(value)]="isSeparateGrouping">
                        </dx-radio-group>
                    </div>
                </div>
                <div class="row date-range">
                    <div class="text-left">{{ ls.l('Reports_DateRange') }}</div>
                    <div class="text-right">
                        <span class="date">{{dateFrom | date : 'MM/dd/yyyy' : 'UTC' }}</span>
                        <img class="arrow" src="./assets/common/icons/date-arrow-right.svg">
                        <span class="date">{{dateTo | date : 'MM/dd/yyyy' : 'UTC' }}</span>
                        <i class="icon blue-edit-pencil" (click)="editStep(generateReportSteps.Calendar)" [class.disabled]="generatingStarted"></i>
                    </div>
                </div>
                <div class="row business-entities">
                    <div class="text-left">{{ ls.l('BusinessEntities') }}</div>
                    <div class="text-right">
                        <ul *ngIf="(bankAccountsService.businessEntitiesAmount$ | async) !== (selectedBusinessEntities$ | async).length; else all">
                            <li *ngFor="let entity of selectedBusinessEntities$ | async">{{ entity.name }}</li>
                        </ul>
                        <ng-template #all>{{ ls.l('All') }}</ng-template>
                        <i class="icon blue-edit-pencil" (click)="editStep(generateReportSteps.BusinessEntities)" [class.disabled]="generatingStarted">&nbsp;</i>
                    </div>
                </div>
                <div class="row business-entities" *ngIf="departmentsEntities.length > 1">
                    <div class="text-left">{{ ls.l('Departments') }}</div>
                    <div class="text-right">
                        <ul *ngIf="selectedDepartments.length; else all">
                            <li *ngFor="let entity of selectedDepartments">{{ entity }}</li>
                        </ul>
                        <ng-template #all>{{ ls.l('All') }}</ng-template>
                        <i class="icon blue-edit-pencil" (click)="editStep(generateReportSteps.Departments)" [class.disabled]="generatingStarted">&nbsp;</i>
                    </div>
                </div>
                <ng-container *ngIf="!cfoService.isMainInstanceType">
                    <div class="row notificationEmail">
                        <div class="text-left">{{ ls.l('Reports_SendEmailNotificationTo') }}</div>
                        <div class="text-right">
                            <dx-text-box name="email"
                                         [disabled]="generatingStarted"
                                         [(value)]="notificationToEmail"
                                         [disabled]="dontSendEmailNotification"
                                         #notificationToEmailTextBox>
                                <dx-validator>
                                    <dxi-validation-rule type="pattern"
                                                         [pattern]="emailRegEx"
                                                         [message]="ls.l('Reports_EmailIsNotValid')">
                                    </dxi-validation-rule>
                                </dx-validator>
                            </dx-text-box>
                        </div>
                    </div>
                    <div class="row checkbox">
                        <dx-check-box [(value)]="dontSendEmailNotification"
                                      [disabled]="generatingStarted"
                                      [text]="ls.l('Reports_IDontWantToSendEmailNotification')">
                        </dx-check-box>
                    </div>
                    <div class="row checkbox">
                        <dx-check-box [(value)]="sendReportInAttachments"
                                      [disabled]="dontSendEmailNotification || !emailIsValidAndNotEmpty || generatingStarted"
                                      [text]="ls.l('Reports_SendAsAttachment')">
                        </dx-check-box>
                    </div>
                </ng-container>
                <div class="row">
                    <div class="col-12 text-center">
                        <button (click)="generateReport()"
                                [disabled]="submitButtonDisabled"
                                [ngClass]="{ disabled: submitButtonDisabled, progress: generatingStarted }"
                                class="btn send-btn">
                            {{ls.l('Reports_RunReportGenerator')}}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </dx-scroll-view>
</modal-dialog>
