<modal-dialog [title]="title"
              [buttons]="buttons">
    <div *ngIf="currentStep == generateReportSteps.Step1" class="step1-container">
        <dx-data-grid id="gridContainer"
                      height="100%"
                      keyExpr="id"
                      [scrolling]="{showScrollbar: 'never'}"
                      [selectedRowKeys]="bankAccountsService.selectedBusinessEntitiesIds$ | async"
                      [dataSource]="bankAccountsService.businessEntities$ | async"
                      [pager]="defaultGridPagerConfig"
                      (onContentReady)="onContentReady($event)"
                      (onSelectionChanged)="onSelectionChanged($event)"
                      (onInitialized)="onInitialized($event)">
            <dxo-header-filter [visible]="false" [allowSearch]="true"></dxo-header-filter>
            <dxo-selection selectAllMode="page"
                           showCheckBoxesMode="always"
                           mode="multiple">
            </dxo-selection>
            <dxi-column dataField="name" [caption]="ls.l('BusinessEntityName') | uppercase"></dxi-column>
            <dxo-scrolling mode="virtual"></dxo-scrolling>
            <dxo-group-panel [visible]="false"></dxo-group-panel>
        </dx-data-grid>
    </div>
    <div *ngIf="currentStep == generateReportSteps.Step2" class="step2-container">
        <calendar [values]="calendarData" [options]="calendarData.options"></calendar>
    </div>
    <div *ngIf="currentStep == generateReportSteps.Step3" class="step3-container">
        <div class="container">
            <div class="row">
                <div class="text-left">{{ ls.l('Reports_ReportsGrouping') }}</div>
                <div class="custom-radio-2-btn">
                    <dx-radio-group [dataSource]="radioGroupGrouping"
                                    displayExpr="text"
                                    valueExpr="value"
                                    layout="horizontal"
                                    name="isSeparateGrouping"
                                    [(value)]="isSeparateGrouping">
                    </dx-radio-group>
                </div>
            </div>
            <div class="row date-range">
                <div class="text-left">{{ ls.l('Reports_DateRange') }}</div>
                <div class="text-right">
                    <span class="date">{{dateFrom | date : 'MM/dd/yyyy'}}</span>
                    <img class="arrow" src="./assets/common/icons/date-arrow-right.svg">
                    <span class="date">{{dateTo | date : 'MM/dd/yyyy'}}</span>
                    <i class="icon blue-edit-pencil" (click)="editDate()"></i>
                </div>
            </div>
            <div class="row business-entities">
                <div class="text-left">{{ ls.l('BusinessEntities') }}</div>
                <div class="text-right">
                    <ul *ngIf="(bankAccountsService.businessEntitiesAmount$ | async) !== (bankAccountsService.selectedBusinessEntities$ | async).length; else all">
                        <li *ngFor="let entity of bankAccountsService.selectedBusinessEntities$ | async">{{ entity.name }}</li>
                    </ul>
                    <ng-template #all>{{ ls.l('All') }}</ng-template>
                    <i class="icon blue-edit-pencil" (click)="editBusinessEntities()">&nbsp;</i>
                </div>
            </div>
            <ng-container *ngIf="!cfoService.isMainInstanceType">
                <div class="row">
                    <div class="text-left">{{ ls.l('Reports_SendEmailNotificationTo') }}</div>
                    <div class="text-right">
                        <dx-text-box [(value)]="notificationToEmail" name="email" #notificationToEmailTextBox>
                            <dx-validator>
                                <dxi-validation-rule type="pattern"
                                                     [pattern]="emailRegEx"
                                                     [message]="ls.l('Reports_EmailIsNotValid')">
                                </dxi-validation-rule>
                            </dx-validator>
                        </dx-text-box>
                    </div>
                </div>
                <div class="row send-as-attachment">
                    <dx-check-box [(value)]="sendReportInAttachments" [disabled]="!emailIsValidAndNotEmpty" [text]="ls.l('Reports_SendAsAttachment')"></dx-check-box>
                </div>
            </ng-container>
            <div class="row">
                <div class="col-12 text-center">
                    <button (click)="generateReport()"
                            [disabled]="cfoService.isMainInstanceType || !emailIsValid"
                            [ngClass]="{ disabled: cfoService.isMainInstanceType || !emailIsValid }"
                            class="btn send-btn">
                        {{ls.l('Reports_RunReportGenerator')}}
                    </button>
                </div>
            </div>
        </div>
    </div>
</modal-dialog>
