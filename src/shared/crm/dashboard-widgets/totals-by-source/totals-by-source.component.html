<div class="wrapper">
    <header>
        <h2 class="title">{{ ls.l('TotalsBy') }}</h2>
        <dx-select-box [items]="totalsOptions"
                       displayExpr="label"
                       [value]="selectedTotal$ | async"
                       (onSelectionChanged)="selectedTotal.next($event.selectedItem)">
        </dx-select-box>
    </header>
    <ng-container *ngIf="data$ | async as data">
        <div *ngIf="totalCount$ | async as totalCount; else noData">
            <div *ngIf="!loading && totalNumbersTop" class="totalsNumbers" [ngStyle]="{ top: totalNumbersTop }">
                <span class="range-name" [ngStyle]="{color: rangeColor}">{{percentage && rangeName}}</span>
                <span class="total-count" [ngStyle]="{color: rangeColor}">
                    <ng-container *ngIf="selectedTotal.value.format == 'currency'; else plain">{{rangeCount || totalCount | currency:currency:'symbol':'1.0-2'}}</ng-container>
                    <ng-template #plain>{{(rangeCount || totalCount).toLocaleString('en')}}</ng-template>
                </span>
                <span class="percentage" [ngStyle]="{color: rangeColor}">{{percentage}}</span>
            </div>
            <div class="round-progress">
                <dx-pie-chart [dataSource]="data"
                              [type]="'doughnut'"
                              [innerRadius]="0.9"
                              [customizePoint]="customizePoint"
                              (onPointHoverChanged)="onPointHoverChanged($event)"
                              [legend]="{verticalAlignment: 'bottom', horizontalAlignment: 'center'}"
                              (onDrawn)="onDrawn($event)">
                    <dxo-common-series-settings [argumentField]="selectedArgumentField$ | async"></dxo-common-series-settings>
                    <dxi-series [valueField]="selectedValueField$ | async"></dxi-series>
                    <dxo-animation [enabled]="false"></dxo-animation>
                </dx-pie-chart>
            </div>
        </div>
        <ng-template #noData>
            <app-no-data></app-no-data>
        </ng-template>
    </ng-container>
</div>
