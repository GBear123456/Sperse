<header>
    <div class="left-section">
        <dx-select-box [dataSource]="chartTypes"
                       valueExpr="value"
                       displayExpr="displayName"
                       [value]="selectedChartType$ | async"
                       (onSelectionChanged)="changeSelectedChartType($event)">
        </dx-select-box>

        <ng-container *ngIf="trendData$ | async as trendData">
            <div class="legend" [hidden]="!trendData || !trendData.length">
                <ng-container *ngIf="selectedChartType.value !== chartType.CashBalancesTrends">
                    <ul class="legend-list">
                        <li class="label legend-item">{{l('Historical')}}:</li>
                        <li class="legend-item inflow">{{l('Stats_Inflows')}}</li>
                        <li class="legend-item outflows">{{l('Stats_Outflows')}}</li>
                        <li class="legend-item net-change">{{l('Net_Change')}}</li>
                    </ul>
                    <ng-container *ngIf="isForecast">
                        <ul class="legend-list">
                            <li class="label legend-item">{{l('Forecast')}}:</li>
                            <li class="legend-item forecast inflow">{{l('Stats_Inflows')}}</li>
                            <li class="legend-item forecast outflows">{{l('Stats_Outflows')}}</li>
                            <li class="legend-item forecast net-change">{{l('Net_Change')}}</li>
                        </ul>
                    </ng-container>
                </ng-container>
                <ng-container *ngIf="selectedChartType.value !== chartType.CashInflowsAndOutflows">
                    <ul class="legend-list">
                        <li class="legend-item endingBalance">{{l('Stats_Historical_Ending_Balance')}}</li>
                    </ul>
                    <ng-container *ngIf="isForecast">
                        <ul class="legend-list">
                            <li class="legend-item forecast endingBalance">{{l('Stats_Forecast_Ending_Balance')}}</li>
                        </ul>
                    </ng-container>
                </ng-container>
            </div>
        </ng-container>
    </div>
</header>
<ng-container *ngIf="trendData$ | async as trendData">
    <div *ngIf="trendData && trendData.length">
        <dx-chart
            id="bar"
            [dataSource]="trendData"
            [barWidth]="0.5"
            [size]="{ height: 245 }"
            #barChart>
            <dxo-size [height]="356" [width]="chartWidth"></dxo-size>
            <!-- common settings for charts -->
            <dxo-common-series-settings
                argumentField="date"
                type="stackedBar"
                [ignoreEmptyPoints]="true">
            </dxo-common-series-settings>
            <dxo-tooltip
                [enabled]="true"
                [zIndex]="1"
                [customizeTooltip]="customizeBarTooltip">
            </dxo-tooltip>

            <ng-container *ngIf="selectedChartType.value !== chartType.CashBalancesTrends && getAxisName(chartType.CashInflowsAndOutflows) as axisName">
                <dxi-series [axis]="axisName"
                            [color]="historicalCreditColor"
                            valueField="credit"
                            [name]="l('Stats_Inflows')">
                </dxi-series>
                <dxi-series [axis]="axisName"
                            [color]="historicalDebitColor"
                            valueField="debit"
                            [name]="l('Stats_Outflows')">
                </dxi-series>
                <dxi-series [axis]="axisName"
                            [color]="forecastCreditColor"
                            [visible]="isForecast"
                            valueField="forecastCredit"
                            [showInLegend]="false"
                            name="forecast">
                </dxi-series>
                <dxi-series [axis]="axisName"
                            [color]="forecastDebitColor"
                            [visible]="isForecast"
                            valueField="forecastDebit"
                            [showInLegend]="false"
                            name="forecastDebit">
                </dxi-series>
                <dxi-series [axis]="axisName"
                            type="line"
                            [color]="historicalNetChangeColor"
                            valueField="netChange"
                            [name]="l('Net_Change')"
                            [showInLegend]="false">
                </dxi-series>
                <dxi-series [axis]="axisName"
                            type="line"
                            [visible]="isForecast"
                            [color]="forecastNetChangeColor"
                            valueField="forecastNetChange"
                            name="forecastNetChange"
                            [showInLegend]="false">
                </dxi-series>
            </ng-container>

            <ng-container *ngIf="selectedChartType.value !== chartType.CashInflowsAndOutflows && getAxisName(chartType.CashBalancesTrends) as axisName">
                <dxi-series [axis]="axisName"
                            name="endingBalanceGradient"
                            pane="topPane"
                            color="url(#ending-balance-gradient)"
                            type="rangeArea"
                            hoverMode="none"
                            rangeValue1Field="minRange"
                            rangeValue2Field="endingBalance">
                    <dxo-label [visible]="false"></dxo-label>
                </dxi-series>
                <dxi-series [axis]="axisName"
                            name="endingBalance"
                            [color]="endingBalanceColor"
                            type="line"
                            valueField="endingBalance"
                            pane="topPane">
                    <dxo-point size="8"></dxo-point>
                </dxi-series>

                <dxi-series [axis]="axisName"
                            name="forecastEndingBalanceGradient"
                            pane="topPane"
                            color="url(#forecast-ending-balance-gradient)"
                            type="rangeArea"
                            rangeValue1Field="minRange"
                            [visible]="isForecast"
                            rangeValue2Field="forecastEndingBalance">
                    <dxo-label [visible]="false"></dxo-label>
                </dxi-series>
                <dxi-series [axis]="axisName"
                            [visible]="isForecast"
                            name="forecastEndingBalance"
                            [color]="forecastEndingBalanceColor"
                            valueField="forecastEndingBalance"
                            pane="topPane">
                </dxi-series>
                <dxi-pane name="topPane"></dxi-pane>
            </ng-container>

            <!-- Bottom axis -->
            <dxo-argument-axis
                argumentType="datetime"
                [visible]="true"
                type="discrete">
                <dxo-label [customizeText]="customizeBottomAxis"></dxo-label>
                <!--<dxo-tick-interval months="1"></dxo-tick-interval>-->
            </dxo-argument-axis>

            <dxo-legend
                [visible]="false"
                itemsAlignment="center"
                itemTextPosition="right"
                orientation="horizontal"
                position="outside">
            </dxo-legend>

            <!-- Left axis -->
            <dxi-value-axis name="leftAxis">
                <dxo-label [customizeText]="customizeAxisValues">
                    <dxo-format type="currency largeNumber"></dxo-format>
                </dxo-label>
                <dxo-grid color="#e5e9ec" [visible]="true"></dxo-grid>
            </dxi-value-axis>

            <!-- Right axis -->
            <dxi-value-axis name="rightAxis"
                            [visible]="selectedChartType.value === chartType.Combined"
                            position="right">
                <dxo-label [customizeText]="customizeAxisValues">
                    <dxo-format type="currency largeNumber"></dxo-format>
                </dxo-label>
                <dxo-grid color="#e5e9ec" [visible]="true"></dxo-grid>
            </dxi-value-axis>

            <!-- Common settings for axis -->
            <dxo-common-axis-settings [allowDecimals]="false">
                <dxo-label alignment="center">
                    <dxo-font [weight]="300" color="#677380" size="12px"></dxo-font>
                </dxo-label>
                <dxo-strip-style>
                    <dxo-label horizontal-allignment="center"></dxo-label>
                </dxo-strip-style>
            </dxo-common-axis-settings>
        </dx-chart>

        <svg>
            <linearGradient id="ending-balance-gradient" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="rgba(0, 174, 239, .1)"/>
                <stop offset="100%" stop-color="#fff"/>
            </linearGradient>

            <linearGradient id="forecast-ending-balance-gradient" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="rgba(249, 186, 78, .5)"/>
                <stop offset="100%" stop-color="#fff"/>
            </linearGradient>
        </svg>

    </div>
    <app-no-data [hidden]="trendData && trendData.length"></app-no-data>
</ng-container>
