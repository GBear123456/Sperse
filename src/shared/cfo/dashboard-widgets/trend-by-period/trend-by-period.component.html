<header>
    <div class="left-section">
        <dx-select-box [dataSource]="chartTypes"
                       valueExpr="value"
                       displayExpr="displayName"
                       [value]="selectedChartType$ | async"
                       (onSelectionChanged)="changeSelectedChartType($event)">
        </dx-select-box>

        <ng-container *ngIf="trendData$ | async as trendData">
            <div class="legend" [hidden]="!trendData || !trendData.length">
                <ng-container *ngIf="selectedChartType.value !== chartType.CashBalancesTrends">
                    <ul class="legend-list">
                        <li class="label legend-item">{{l('Historical')}}:</li>
                        <ng-container *ngIf="showInflowsOutflowsCharts$ | async" >
                            <li class="legend-item">
                                <span class="legend-icon" [ngStyle]="{ background: historicalCreditColor }"></span>
                                {{l('Stats_Inflows')}}
                            </li>
                            <li class="legend-item">
                                <span class="legend-icon" [ngStyle]="{ background: historicalDebitColor }"></span>
                                {{l('Stats_Outflows')}}
                            </li>
                        </ng-container>
                        <li *ngIf="showNetChangeChart$" class="legend-item">
                            <span class="legend-icon" [ngStyle]="{ background: historicalNetChangeColor }"></span>
                            {{l('Net_Change')}}
                        </li>
                        <li *ngIf="showBalancesChart$ | async" class="legend-item">
                            <span class="legend-icon" [ngStyle]="{ background: endingBalanceColor }"></span>
                            {{l('Stats_Ending_Balances')}}
                        </li>
                    </ul>
                    <ul class="legend-list" *ngIf="isForecast">
                        <li class="label legend-item">{{l('Forecast')}}:</li>
                        <ng-container *ngIf="showInflowsOutflowsCharts$ | async" >
                            <li class="legend-item">
                                <span class="legend-icon" [ngStyle]="{ background: forecastCreditColor }"></span>
                                {{l('Stats_Inflows')}}
                            </li>
                            <li class="legend-item">
                                <span class="legend-icon" [ngStyle]="{ background: forecastDebitColor }"></span>
                                {{l('Stats_Outflows')}}
                            </li>
                        </ng-container>
                        <li *ngIf="showNetChangeChart$" class="legend-item">
                            <span class="legend-icon" [ngStyle]="{ background: forecastNetChangeColor }"></span>
                            {{l('Net_Change')}}
                        </li>
                        <li *ngIf="showBalancesChart$ | async" class="legend-item">
                            <span class="legend-icon" [ngStyle]="{ background: forecastEndingBalanceColor }"></span>
                            {{l('Stats_Ending_Balances')}}
                        </li>
                    </ul>
                </ng-container>
                <ul class="legend-list" *ngIf="selectedChartType.value === chartType.CashBalancesTrends">
                    <li class="label legend-item">{{l('Stats_Ending_Balances')}}:</li>
                    <li class="legend-item">
                        <span class="legend-icon" [ngStyle]="{ background: endingBalanceColor }"></span>
                        {{l('Historical')}}
                    </li>
                    <li class="legend-item" *ngIf="isForecast">
                        <span class="legend-icon" [ngStyle]="{ background: forecastEndingBalanceColor }"></span>
                        {{l('Forecast')}}
                    </li>
                </ul>
            </div>
        </ng-container>
    </div>
</header>
<ng-container *ngIf="trendData$ | async as trendData">
    <div *ngIf="trendData && trendData.length">
        <dx-chart
            id="bar"
            [dataSource]="trendData"
            [barWidth]="0.5"
            #barChart>
            <dxo-size [height]="chartHeight" [width]="chartWidth"></dxo-size>
            <!-- common settings for charts -->
            <dxo-common-series-settings
                argumentField="date"
                type="stackedBar"
                [ignoreEmptyPoints]="true">
            </dxo-common-series-settings>
            <dxo-tooltip
                [enabled]="true"
                [zIndex]="1"
                [customizeTooltip]="customizeBarTooltip">
            </dxo-tooltip>

            <ng-container *ngIf="showInflowsOutflowsCharts$ | async">
                <ng-container *ngIf="getAxisName(chartType.CashInflowsAndOutflows) as axisName">
                    <dxi-series [axis]="axisName"
                                [color]="historicalCreditColor"
                                valueField="credit"
                                [name]="l('Stats_Inflows')">
                    </dxi-series>
                    <dxi-series [axis]="axisName"
                                [color]="historicalDebitColor"
                                valueField="debit"
                                [name]="l('Stats_Outflows')">
                    </dxi-series>
                    <dxi-series [axis]="axisName"
                                [color]="forecastCreditColor"
                                [visible]="isForecast"
                                valueField="forecastCredit"
                                name="forecast">
                    </dxi-series>
                    <dxi-series [axis]="axisName"
                                [color]="forecastDebitColor"
                                [visible]="isForecast"
                                valueField="forecastDebit"
                                name="forecastDebit">
                    </dxi-series>
                </ng-container>
            </ng-container>

            <ng-container *ngIf="showNetChangeChart$ | async">
                <ng-container *ngIf="getAxisName(chartType.CashBalanceWithNetChange) as axisName">
                    <dxi-series [axis]="axisName"
                                type="line"
                                [color]="historicalNetChangeColor"
                                valueField="netChange"
                                [name]="l('Net_Change')">
                    </dxi-series>
                    <dxi-series [axis]="axisName"
                                type="line"
                                [visible]="isForecast"
                                [color]="forecastNetChangeColor"
                                valueField="forecastNetChange"
                                name="forecastNetChange">
                    </dxi-series>
                </ng-container>
            </ng-container>

            <ng-container *ngIf="showBalancesChart$ | async">
                <ng-container *ngIf="getAxisName(chartType.CashBalancesTrends) as axisName">
                    <dxi-series [axis]="axisName"
                                name="endingBalanceGradient"
                                pane="topPane"
                                color="url(#ending-balance-gradient)"
                                type="rangeArea"
                                hoverMode="none"
                                rangeValue1Field="minRange"
                                rangeValue2Field="endingBalance">
                        <dxo-label [visible]="false"></dxo-label>
                    </dxi-series>
                    <dxi-series [axis]="axisName"
                                name="endingBalance"
                                [color]="endingBalanceColor"
                                type="line"
                                valueField="endingBalance"
                                pane="topPane">
                        <dxo-point size="8"></dxo-point>
                    </dxi-series>

                    <dxi-series [axis]="axisName"
                                name="forecastEndingBalanceGradient"
                                pane="topPane"
                                color="url(#forecast-ending-balance-gradient)"
                                type="rangeArea"
                                hoverMode="none"
                                rangeValue1Field="minRange"
                                [visible]="isForecast"
                                rangeValue2Field="forecastEndingBalance">
                        <dxo-label [visible]="false"></dxo-label>
                    </dxi-series>
                    <dxi-series [axis]="axisName"
                                [visible]="isForecast"
                                name="forecastEndingBalance"
                                [color]="forecastEndingBalanceColor"
                                type="line"
                                valueField="forecastEndingBalance"
                                pane="topPane">
                    </dxi-series>
                    <dxi-pane name="topPane"></dxi-pane>
                </ng-container>
            </ng-container>

            <!-- Bottom axis -->
            <dxo-argument-axis
                argumentType="datetime"
                [visible]="true"
                type="discrete">
                <dxo-label [customizeText]="customizeBottomAxis"></dxo-label>
            </dxo-argument-axis>

            <dxo-legend
                [visible]="false"
                itemsAlignment="center"
                itemTextPosition="right"
                orientation="horizontal"
                position="outside">
            </dxo-legend>

            <!-- Left axis -->
            <dxi-value-axis name="leftAxis">
                <dxo-label [customizeText]="customizeAxisValues">
                    <dxo-format type="currency largeNumber"></dxo-format>
                </dxo-label>
                <dxo-title [text]="leftAxisTitle$ | async"></dxo-title>
                <dxo-grid color="#e5e9ec" [visible]="true"></dxo-grid>
            </dxi-value-axis>

            <!-- Right axis -->
            <dxi-value-axis *ngIf="showRightAxis$ | async"
                            name="rightAxis"
                            position="right">
                <dxo-label [customizeText]="customizeAxisValues">
                    <dxo-format type="currency largeNumber"></dxo-format>
                </dxo-label>
                <dxo-title [text]="rightAxisTitle$ | async"></dxo-title>
                <dxo-grid color="#e5e9ec" [visible]="true"></dxo-grid>
            </dxi-value-axis>

            <!-- Common settings for axis -->
            <dxo-common-axis-settings [allowDecimals]="false">
                <dxo-label alignment="center">
                    <dxo-font [weight]="300" color="#677380" size="12px"></dxo-font>
                </dxo-label>
                <dxo-strip-style>
                    <dxo-label horizontal-allignment="center"></dxo-label>
                </dxo-strip-style>
            </dxo-common-axis-settings>
        </dx-chart>

        <svg>
            <linearGradient id="ending-balance-gradient" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" [attr.stop-color]="endingBalanceStopColor"/>
                <stop offset="100%" stop-color="#fff"/>
            </linearGradient>
            <linearGradient id="forecast-ending-balance-gradient" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" [attr.stop-color]="forecastEndingBalanceStopColor"/>
                <stop offset="100%" stop-color="#fff"/>
            </linearGradient>
        </svg>

    </div>
    <app-no-data [hidden]="trendData && trendData.length"></app-no-data>
</ng-container>
