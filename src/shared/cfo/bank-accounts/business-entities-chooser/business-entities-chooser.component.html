<div class="selectionList">
    <ng-container *ngIf="businessEntities$ | async as dataSource">
        <dx-drop-down-box #dropDown *ngIf="dataSource.length"
            [width]="width"
            [value]="getSelectedTitle(dataSource)"
            [hint]="getItemsTitle(dataSource)"
            [placeholder]="ls.l('All_Entities') + ' \u25BE'"
            (onOpened)="onPopupOpened($event, dataSource)"
            (onClosed)="onPopupClosed()">
            <div *dxTemplate="let contentData of 'content'" class="bussiness-entities-chooser">
                <div class="select-all">
                    <dx-check-box #selectAll
                        width="100px"
                        [text]="ls.l('Select All')"
                        [value]="selectedAll"
                        (onValueChanged)="onSelectAll($event)">
                    </dx-check-box>
                    <div class="apply-all" *ngIf="showApplySelection">
                        <span (click)="applySelection()">{{ls.l('Apply')}}</span>
                        <span (click)="clearSelection()">{{ls.l('Clear')}}</span>
                    </div>
                    <span *ngIf="onFilterButtonClick.observers.length" class="accounts-filter" (click)="filterButtonClick()"></span>
                </div>
                <dx-tree-view
                    [expandAllEnabled]="true"
                    parentIdExpr="parentId"
                    dataStructure="plain"
                    [searchEnabled]="showSearch"
                    [dataSource]="dataSource"
                    selectedExpr="selected"
                    hasItemsExpr="hasChildren"
                    showCheckBoxesMode="normal"
                    displayExpr="name"
                    itemTemplate="itemTemplate"
                    (onItemCollapsed)="showApplySelection || dropDown.instance.repaint()"
                    (onItemExpanded)="showApplySelection || dropDown.instance.repaint()"
                    (onSelectionChanged)="selectedItemsChange()">
                    <div *dxTemplate="let item of 'itemTemplate'">
                        <div class="selection-list-item {{item.hasChildren ? 'highlighted' : ''}}">
                            <span [title]="item.name">{{item.name}}</span>
                        </div>
                    </div>
                </dx-tree-view>
            </div>
        </dx-drop-down-box>
    </ng-container>
</div>