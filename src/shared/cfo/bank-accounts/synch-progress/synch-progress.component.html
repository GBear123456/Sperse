<div class="synch-progress-wrapper">
    <button *ngIf="isSyncAccountButtonShown && !showProgress"
            class="sync-account-button"
            (click)="syncAll(true)">
        <img src="./assets/common/icons/sync-account-icon.svg" alt="Sync Accounts">
        {{l('SyncAllAccounts')}}
    </button>
    <div class="synch-container" *ngIf="showProgress">
        <div class="loader" *ngIf="showLoader">
            <div class="loadindicator"></div>
        </div>
        <div *ngIf="!syncFailed && ((!completed && syncData) || (completed && hasFailedAccounts)) && !showLoader"
             id="synchProgressContainer" (mouseenter)="toggleTooltip()">
            <div *ngIf="!completed" class="loadindicator" [class.in-progress]="!completed"></div>
            <h3>{{l('Sync_status')}}</h3>
            <dx-progress-bar #progressBar
                             id="progress-bar-status"
                             width="210"
                             [ngClass]="{ 'error': hasFailedAccounts, 'complete': completed, 'in-progress': !completed }"
                             [min]="0"
                             [max]="100"
                             [showStatus]="false"
                             [value]="currentProgress">
            </dx-progress-bar>
            <i *ngIf="completed" class="fa fa-times-circle red-icon" (click)="toggleComponent()"></i>
        </div>
        <div *ngIf="syncFailed && !showLoader">
            <h3>{{l('Accounts_synchronization_failed')}}</h3>
            <i class="fa fa-times-circle red-icon" (click)="toggleComponent()"></i>
        </div>
        <div *ngIf="!syncFailed && completed && !hasFailedAccounts && !showLoader">
            <button *ngIf="isSyncAccountButtonShown"
                    class="sync-account-button"
                    (click)="syncAll()">
                <img src="./assets/common/icons/sync-account-icon.svg" alt="Sync Accounts">
                {{l('SyncAllAccounts')}}
            </button>
        </div>
    </div>

    <dx-tooltip target="#synchProgressContainer"
                [width]="712"
                [(visible)]="tooltipVisible">
        <div *dxTemplate="let data = data of 'content'">
            <div class="tooltip-container">
                <div class="header">
                    <h3>{{l('Accounts_synchronization_status')}}:</h3>
                </div>
                <div class="scroll-zone">
                    <div class="row">
                        <div class="col-7">
                            <dx-scroll-view [showScrollbar]="onHover" [height]="calculateChartsScrolableHeight()">
                                <ul class="list-of-synch-accounts">
                                    <li *ngFor="let acc of syncData.accountProgresses; let i = index" id="accountProgress{{i}}"
                                        (mouseenter)="accountProgressMouseEnter('accountProgress' + i, acc.syncStatusMessage)"
                                        [class]="'clearfix ' + acc.syncStatus | lowercase">
                                        <span class="name" [ngClass]="{'full-width': completed}">{{ acc.accountName }}{{ completed ? '' : ':'}}</span>
                                        <span *ngIf="!completed && !(acc.progressPercent == 100 && isFailedAccount(acc.syncStatus))" class="percent">{{acc.progressPercent | number : '1.0-0'}}%</span>
                                    </li>
                                </ul>
                            </dx-scroll-view>
                            <dx-tooltip #accountProgressTooltip
                                        [position]="{
                                                      my: 'left top',
                                                      at: 'left bottom',
                                                      of: accountProgressTooltipTarget
                                        }"
                                        [(visible)]="accountProgressTooltipVisible">
                                <div *dxTemplate="let data = data of 'content'" class="tooltip-data">
                                    {{accountProgressTooltipText}}
                                </div>
                            </dx-tooltip>
                        </div>
                        <div class="col-5">
                            <div class="progress-wrap">
                                <round-progress [current]="currentProgress"
                                                [max]="100"
                                                [color]="hasFailedAccounts ? 'orange' : '#35C8A8'"
                                                [background]="'#ECF0F3'"
                                                [radius]="64"
                                                [stroke]="8"
                                                [rounded]="false"
                                                [clockwise]="true"
                                                [responsive]="true"
                                                [duration]="800"
                                                [animation]="'easeInOutQuart'"
                                                [animationDelay]="0">
                                </round-progress>
                                <span class="total-synch-progress">{{currentProgress | number : '1.0-0'}}%</span>
                            </div>

                            <div class="progress-description">
                                <div class="progress-description-arrow"></div>
                                <div *ngIf="completed" class="progress-description-header text-center">{{l('Accounts_synchronization_completed')}}</div>
                                <ng-container *ngIf="!completed">
                                    <div class="progress-description-header">{{l('Accounts_synchronization_in_progress')}}</div>
                                    <div class="progress-description-text">{{l('Accounts_synchronization_in_progress_description')}}</div>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer">
                    <div class="footer-text">
                        {{l('Accounts_synchronization_footer')}}
                    </div>
                </div>
            </div>
        </div>
    </dx-tooltip>
</div>
