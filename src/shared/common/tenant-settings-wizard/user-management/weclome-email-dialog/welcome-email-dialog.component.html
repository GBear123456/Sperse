<modal-dialog [title]="data.title"
              [titleClearButton]="false"
              [buttons]="buttons"
              [editTitle]="false">
    <ng-container headerContent>
        <dx-select-box
            name="template"
            width="380px"
            height="40px"
            displayExpr="name"
            valueExpr="id"
            [placeholder]="ls.l('SelectTemplate')"
            [value]="data.templateId"
            [showClearButton]="true"
            [dataSource]="templates$ | async"
            [acceptCustomValue]="true"
            itemTemplate="itemTemplate"
            (onOptionChanged)="onTemplateOptionChanged($event)"
            (onCustomItemCreating)="onNewTemplate($event)"
            (onValueChanged)="onTemplateChanged($event)">
            <div *dxTemplate="let item of 'itemTemplate'" class="email-templates-select-box">
                {{ item.name }}
                <i *ngIf="item.id != SystemDefaultId" class="delete fa fa-times" [title]="ls.l('DeleteTemplate')" (click)="deleteTemplate($event, item.id)"></i>
            </div>
        </dx-select-box>
    </ng-container>
    <div class="form-content">
        <dx-scroll-view showScrollbar="onHover" #scrollView>
            <div class="row">
                <div class="field-area">
                    <label class="caption">{{ls.l('CC')}}:</label>
                    <dx-tag-box name="cc"
                                height="40px"
                                width="calc(100% - 35px)"
                                placeholder=""
                                noDataText=""
                                [multiline]="false"
                                [acceptCustomValue]="true"
                                [disabled]="disableControls"
                                [(value)]="data.cc"
                                (onKeyUp)="onKeyUp($event)"
                                (onInitialized)="onTagBoxInitialized($event)"
                                (onFocusOut)="emailInputFocusOut($event)"
                                (onCustomItemCreating)="onCustomItemCreating($event)">
                    </dx-tag-box>
                </div>
                <div class="field-area">
                    <label class="caption">{{ls.l('BCC')}}:</label>
                    <dx-tag-box name="bcc"
                                height="40px"
                                width="calc(100% - 46px)"
                                noDataText=""
                                placeholder=""
                                [multiline]="false"
                                [acceptCustomValue]="true"
                                [disabled]="disableControls"
                                [(value)]="data.bcc"
                                (onKeyUp)="onKeyUp($event)"
                                (onInitialized)="onTagBoxInitialized($event)"
                                (onFocusOut)="emailInputFocusOut($event)"
                                (onCustomItemCreating)="onCustomItemCreating($event)">
                    </dx-tag-box>
                </div>
                <div class="field-area subject">
                    <label class="caption">{{ls.l('Subject')}}:</label>
                    <dx-text-box name="subject"
                                 [disabled]="disableControls"
                                 width="calc(100% - 69px)"
                                 height="35px"
                                 placeholder=""
                                 [(value)]="data.subject">
                    </dx-text-box>
                </div>
                <div class="field-area ckeditor">
                    <dx-tooltip [width]="250"
                                position="bottom"
                                [(visible)]="tagsTooltipVisible"
                                [target]="'.tags-button.id' + uniqId">
                        <div *dxTemplate="let data of 'content'" class="tags-container">
                            <p class="tags-note">{{ls.l('SupportedTags')}}</p>
                            <dx-list height="calc(100% - 40px)"
                                     [selectionMode]="'single'"
                                     [dataSource]="tagsList"
                                     [itemTemplate]="'startCase'"
                                     (onItemClick)="onTagClick($event)">
                                <div *dxTemplate="let data of 'startCase'" class="tags-list-item">
                                    {{ startCase(data) }}
                                </div>
                            </dx-list>
                        </div>
                    </dx-tooltip>
                    <span #tagsButton [class]="'cke_toolgroup tags-button id' + uniqId" *ngIf="tagsList.length">
                        <a (click)="tagsTooltipVisible = true">Tags</a>
                    </span>
                    <ckeditor *ngIf="loaded && ckConfig.height" [config]="ckConfig" [(data)]="this.data.body" (ready)="onCKReady($event)" (change)="updateDataLength()"></ckeditor>
                    <p class="char-count">{{charCount}}</p>
                </div>
            </div>
        </dx-scroll-view>
    </div>
</modal-dialog>