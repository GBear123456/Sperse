<div *ngIf="showNotFound" class="not-found-block">
    Product link is not valid
</div>
<div id="stripe-checkout" class="stripe-checkout" [class.visible]="showCheckout">
    <i *ngIf="showCheckout" class="back-icon" (click)="returnFromStripeCheckout()">‚Üê</i>
</div>
<div *ngIf="productInfo && !showCheckout" class="box">
    <div class="title">
        <h1 class="title title--h1"> {{productInfo.name}}</h1>
    </div>
    <p class="subtitle">{{productInfo.description}}</p>
    <div class="box__inner">
        <div class="box__left box__item">
            <div class="plan">
                <span class="wrapper">
                    <span>
                        <img *ngIf="productInfo.imageUrl" aria-hidden="true" [src]="productInfo.imageUrl">
                    </span>
                </span>
            </div>
            <div *ngIf="productInfo.type == productType.Donation && productInfo.productDonation.goalAmount" class="donation-status">
                <div class="donation-data">
                    <div>
                        <div class="data">{{currencySymbol}}{{productInfo.productDonation.raisedAmount | currency: productInfo.data.currency : '' : '1.0-2'}}</div>
                        <div class="gray">
                            {{ls.l('Raised of')}} {{currencySymbol}}{{productInfo.productDonation.goalAmount | currency: productInfo.data.currency : '' : '1.0-2'}}
                        </div>
                    </div>
                    <div>
                        <div class="data">{{productInfo.productDonation.donationsCount}}</div>
                        <div class="gray">{{ls.l('Donations')}}</div>
                    </div>
                </div>
                <div class="donation-progress">
                    <div class="donation-progress-bar" [style.width.%]="productInfo.productDonation.raisedAmount / productInfo.productDonation.goalAmount * 100">
                    </div>
                </div>
            </div>
            <product-option-selector [productPriceOptions]="productInfo.priceOptions"
                                     (onSelect)="onPriceOptionChanged($event)">
            </product-option-selector>
            <ng-container *ngIf="selectedPriceOption.type == priceOptionType.Subscription else generalProduct">
                <div class="subscription-price">
                    <div class="price-wrapper">
                        <div class="trial-day-count" *ngIf="selectedPriceOption.trialDayCount || selectedPriceOption.signupFee">
                            <ng-container *ngIf="selectedPriceOption.trialDayCount; else signupBlock">
                                <span *ngIf="selectedPriceOption.signupFee; else free">
                                    {{ currencySymbol }}{{getSignUpFee(true) | customNumber: '1.0-2' | currency: productInfo.data.currency : '' : '1.0-2'}}
                                </span>
                                <ng-template #free>{{ls.l('Free')}}</ng-template>
                                for {{selectedPriceOption.trialDayCount}}* day(s) then
                            </ng-container>
                            <ng-template #signupBlock>
                                <span>{{ currencySymbol }}{{getSignUpFee(true) | customNumber: '1.0-2' | currency: productInfo.data.currency : '' : '1.0-2'}}</span> signup fee
                            </ng-template>
                        </div>
                        <div class="amountPerMonth">
                            <ng-container *ngIf="customerPriceEditMode else plainOptionFee">
                                <div>
                                    <input class="customer-price-input" #customerPriceInput="ngModel" #customerPriceElement type="number" [(ngModel)]="selectedPriceOption.fee"
                                           (focusout)="customerPriceFocusOut($event, customerPriceInput)" [ngModelOptions]="{updateOn: 'blur'}"
                                           [pattern]="customerPriceRegexp" [min]="selectedPriceOption.minCustomerPrice" [max]="selectedPriceOption.maxCustomerPrice" required>
                                    <validation-messages [formCtrl]="customerPriceInput"
                                                         [errorDefs]="customerPriceInputErrorDefs">
                                    </validation-messages>
                                </div>
                            </ng-container>
                            <ng-template #plainOptionFee>
                                <ng-container *ngIf="!isFreeProductSelected else freeOption">
                                    <span class="currency-symbol">{{ currencySymbol }}</span>
                                    <span class="number">
                                        <ng-container *ngIf="selectedPriceOption.fee else noOptionFee">
                                            {{ getSubscriptionPrice(true) | customNumber: '1.0-0' | currency: productInfo.data.currency : '' : '1.0-0' }}
                                        </ng-container>
                                        <ng-template #noOptionFee>
                                            <i>Enter Fee</i>
                                        </ng-template>
                                    </span>
                                    <div class="number-info" *ngIf="selectedPriceOption.fee">
                                        <span class="decimal">{{ getSubscriptionPrice(true) | customNumber: '0.2-2' }}</span>
                                        <span>/{{ getPriceDescription() }}</span>
                                    </div>
                                    <i *ngIf="selectedPriceOption.customerChoosesPrice" class="fa fa-pencil customer-price-edit" (click)="showCustomerPriceInput()"></i>
                                </ng-container>
                            </ng-template>
                            <ng-template #freeOption>
                                <span class="number">{{ls.l('Free')}}</span>
                            </ng-template>
                        </div>
                        <div class="coupon-info" *ngIf="couponInfo && !isFreeProductSelected">
                            <div>Coupon applied</div>
                            <div class="save-line">You saved: {{currencySymbol}}{{getDiscount() | number : '1.0-2'}}</div>
                        </div>
                        <div class="trial-period-note" *ngIf="selectedPriceOption.trialDayCount">{{ls.l('* The Trial period is applied after the first purchase only.')}}</div>
                    </div>
                </div>
            </ng-container>
            <ng-template #generalProduct>
                <div class="price">
                    <ng-container *ngIf="selectedPriceOption.customerChoosesPrice else generalPrice">
                        <div class="price__new" *ngIf="!customerPriceEditMode">
                            <span [attr.data-currency]="currencySymbol">{{ getGeneralPrice(true) | number : '1.0-2'}}</span>
                            <i class="fa fa-pencil customer-price-edit" (click)="showCustomerPriceInput()"></i>
                        </div>
                        <div *ngIf="customerPriceEditMode">
                            <input class="customer-price-input" #customerPriceInput="ngModel" #customerPriceElement type="number" [(ngModel)]="selectedPriceOption.fee"
                                   (focusout)="customerPriceFocusOut($event, customerPriceInput)" [ngModelOptions]="{updateOn: 'blur'}"
                                   [pattern]="customerPriceRegexp" [min]="selectedPriceOption.minCustomerPrice" [max]="selectedPriceOption.maxCustomerPrice" required>
                            <validation-messages [formCtrl]="customerPriceInput"
                                                 [errorDefs]="customerPriceInputErrorDefs">
                            </validation-messages>
                        </div>
                    </ng-container>
                    <ng-template #generalPrice>
                        <ng-container *ngIf="!isFreeProductSelected else freeProduct">
                            <div class="quantity" *ngIf="productInfo.type != productType.Donation">
                                <div class="quantity-title">Quantity</div>
                                <div class="quantity-controls">
                                    <span [style.visibility]="productInput.quantity > 1 ? 'visible' : 'hidden'" (click)="changeQuantity(productInput.quantity - 1)">-</span>
                                    <span class="value" [ngClass]="(productInfo.stock != null && productInfo.stock - productInput.quantity < 0) ? 'invalid' : ''">
                                        {{productInput.quantity}}
                                    </span>
                                    <span (click)="changeQuantity(productInput.quantity + 1)">+</span>
                                </div>
                            </div>
                            <div class="price__new">
                                <span [attr.data-currency]="currencySymbol">{{ getGeneralPrice(true) | number : '1.0-2'}}</span>
                            </div>
                            <div *ngIf="couponInfo" class="discount-info">
                                <div>Coupon applied</div>
                                <div class="save-line">You saved: {{currencySymbol}}{{getDiscount() | number : '1.0-2'}}</div>
                            </div>
                        </ng-container>
                        <ng-template #freeProduct>
                            <div class="free-product">{{ls.l('Free')}}</div>
                        </ng-template>
                    </ng-template>
                </div>
            </ng-template>
            <div class="addOns" *ngIf="selectedPriceOption.type == priceOptionType.OneTime && !selectedPriceOption.customerChoosesPrice && productInfo.productAddOns && productInfo.productAddOns.length">
                <div class="addOn" *ngFor="let addOn of productInfo.productAddOns">
                    <div class="addOn-header"><span>{{ addOn.name }}</span><span *ngIf="addOn.required" class="required">*required</span></div>
                    <div class="addOn-options">
                        <div class="addOn-option" *ngFor="let addOnOption of addOn.productAddOnOptions">
                            <label class="check_wrap">
                                <input class="check_wrap__input" type="checkbox" [(ngModel)]="addOnOption.selected" (ngModelChange)="onAddOnChange(addOn, addOnOption, $event)" [ngModelOptions]="{standalone: true}">
                                <span class="check_wrap__style"></span>
                            </label>
                            <div class="addOn-option-name">{{ addOnOption.name }}</div>
                            <div class="addOn-option-price">+{{ currencySymbol }}{{addOnOption.price | currency: productInfo.data.currency : '' : '1.0-2'}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tax" *ngIf="productInfo.data.isStripeTaxationEnabled">
                <div class="tax-row">
                    <span>Estimated Taxes</span>
                    <div class="amount">
                        <span *ngIf="taxCalculation" [attr.data-currency]="currencySymbol">{{ taxCalculation.taxAmountExclusive | number : '1.0-2'}}</span>
                        <span *ngIf="!taxCalculation"> - </span>
                    </div>
                </div>
                <div class="tax-row tax-total">
                    <span>TOTAL</span>
                    <div class="amount">
                        <span *ngIf="taxCalculation" [attr.data-currency]="currencySymbol">{{ taxCalculation.amountTotal | number : '1.0-2'}}</span>
                        <span *ngIf="!taxCalculation"> - </span>
                    </div>
                </div>
            </div>
            <div class="invalid" *ngIf="!isInStock || (productInfo.stock != null && productInfo.stock - productInput.quantity < 0)">
                <p>Unfortunately, the quantity that you selected is out-of-stock.</p>
            </div>
            <div *ngIf="productInfo.productDonation && productInfo.productDonation.productDonationSuggestedAmounts" class="donation-suggestions">
                <div *ngFor="let suggestedAmount of getDonationSuggestedAmounts()"
                     class="suggested-amount"
                     [ngClass]="{ active: selectedPriceOption.fee == suggestedAmount.amount }"
                     (click)="selectSuggestedAmount(suggestedAmount)">
                    <div class="amount">{{ currencySymbol }}{{suggestedAmount.amount | currency: productInfo.data.currency : '' : '1.0-2'}}</div>
                    <div class="text">{{suggestedAmount.text}}</div>
                </div>
            </div>
            <div *ngIf="descriptionHtml" class="description-html" [innerHtml]="descriptionHtml"></div>
        </div>
        <div class="box__right box__item">
            <form id="firstStepForm" #firstStepForm="ngForm" novalidate>
                <div class="social_login" *ngIf="productInfo.data.hasDiscordService && productInfo.data.discordAppId">
                    <button type="button" class="button_global button_global_blue2" (click)="discordOAuth()" [disabled]="discordPopup">
                        <span class="discord-icon">Authorize Discord</span>
                    </button>
                    <p *ngIf="requestInfo.discordUserName">Authorized Discord user: <b>{{requestInfo.discordUserName}}</b>&nbsp;<i>({{requestInfo.discordUserId}})</i></p>
                </div>
                <div class="name">
                    <div class="input name__input">
                        <label>
                            First Name <input #firstNameInput="ngModel" type="text" placeholder="" name="firstName" [(ngModel)]="requestInfo.firstName" [ngModelOptions]="{updateOn: 'blur'}" [pattern]="nameRegexp" required>
                            <validation-messages [formCtrl]="firstNameInput" [errorDefs]="[{pattern: ls.l('{0}IsInvalid', ls.l('FirstName'))}]"></validation-messages>
                        </label>
                    </div>
                    <div class="input name__input">
                        <label>
                            Last Name <input #lastNameInput="ngModel" type="text" placeholder="" name="lastName" [(ngModel)]="requestInfo.lastName" [ngModelOptions]="{updateOn: 'blur'}" [pattern]="nameRegexp" required>
                            <validation-messages [formCtrl]="lastNameInput" [errorDefs]="[{pattern: ls.l('{0}IsInvalid', ls.l('LastName'))}]"></validation-messages>
                        </label>
                    </div>
                </div>
                <div class="input" *ngIf="productInfo.data.hasTenantService">
                    <label class="company">
                        Company <input #businessNameInput="ngModel" type="text" name="businessName" [(ngModel)]="tenantRegistrationModel.tenantName" [ngModelOptions]="{updateOn: 'blur'}" autoComplete="off" required>
                        <validation-messages [formCtrl]="businessNameInput" [errorDefs]="[{pattern: ls.l('{0}IsInvalid', ls.l('BusinessName'))}]"></validation-messages>
                    </label>
                </div>
                <div class="phone">
                    <span class="phone__label">Phone</span>
                    <div>
                        <country-phone-number #phoneNumber
                                              [required]="false"
                                              [(phoneNumber)]="requestInfo.phone"
                                              (onInitialized)="onPhoneFieldInitialize($event)">
                        </country-phone-number>
                    </div>
                </div>
                <div class="input">
                    <label class="email">
                        Email Address <input #emailAddressInput="ngModel" type="email" name="email" placeholder="" [(ngModel)]="requestInfo.email" [ngModelOptions]="{updateOn: 'blur'}" [pattern]="emailRegexp" required>
                        <validation-messages [formCtrl]="emailAddressInput" [errorDefs]="[{pattern: ls.l('InvalidEmailAddress')}]"></validation-messages>
                    </label>
                </div>
                <div *ngIf="productInfo.data.isStripeTaxationEnabled" class="input address">
                    <label class="">
                        {{ls.l('Billing Address')}}
                        <dx-text-box *ngIf="!googleAutoComplete" name="address"
                                     [placeholder]=""
                                     [(value)]="billingAddress.streetAddress">
                        </dx-text-box>

                        <input *ngIf="googleAutoComplete"
                               #addressInput
                               type="text"
                               name="Address"
                               placeholder=""
                               [(value)]="address.address"
                               class="dx-texteditor-input"
                               (onAddressChange)="onAddressChanged($event)"
                               ngx-google-places-autocomplete />
                    </label>
                </div>
                <div *ngIf="productInfo.data.isStripeTaxationEnabled" class="address name">
                    <div class="input name__input">
                        <label class="">
                            City
                        </label>
                        <dx-text-box name="city"
                                     maxLength="50"
                                     [(value)]="billingAddress.city">
                        </dx-text-box>
                    </div>
                    <div class="input name__input">
                        <label>
                            State
                        </label>
                        <dx-select-box [acceptCustomValue]="true"
                                       [dataSource]="getCountryStates() | async"
                                       displayExpr="name"
                                       valueExpr="name"
                                       name="state"
                                       [activeStateEnabled]="false"
                                       [focusStateEnabled]="false"
                                       [hoverStateEnabled]="false"
                                       [placeholder]="''"
                                       [searchEnabled]="true"
                                       [(value)]="billingAddress.stateName"
                                       (onValueChanged)="stateChanged($event)"
                                       (onCustomItemCreating)="onCustomStateCreate($event)">
                        </dx-select-box>
                    </div>
                </div>
                <div *ngIf="productInfo.data.isStripeTaxationEnabled" class="address name">
                    <div class="input name__input">
                        <label class="">
                            Zip
                        </label>
                        <dx-text-box name="zip"
                                     maxLength="10"
                                     [(value)]="billingAddress.zip"
                                     (onValueChanged)="calculateTax()">
                        </dx-text-box>
                    </div>
                    <div class="input name__input">
                        <label>
                            Country
                        </label>
                        <dx-select-box [dataSource]="countries"
                                       displayExpr="name"
                                       valueExpr="name"
                                       name="country"
                                       [activeStateEnabled]="false"
                                       [focusStateEnabled]="false"
                                       [hoverStateEnabled]="false"
                                       [placeholder]="''"
                                       [searchEnabled]="true"
                                       [(value)]="address.countryName"
                                       (onValueChanged)="onCountryChange($event)">
                        </dx-select-box>
                    </div>
                </div>
                <div class="input" *ngIf="productInfo.data.hasTenantService && passwordComplexitySetting">
                    <label>
                        Choose your password
                    </label>
                    <div class="password-row">
                        <div>
                            <input #passwordInput="ngModel"
                                   [requireDigit]="passwordComplexitySetting.requireDigit"
                                   [requireLowercase]="passwordComplexitySetting.requireLowercase"
                                   [requireUppercase]="passwordComplexitySetting.requireUppercase"
                                   [requireNonAlphanumeric]="passwordComplexitySetting.requireNonAlphanumeric"
                                   [requiredLength]="passwordComplexitySetting.requiredLength"
                                   [type]="showPassword ? 'text' : 'password'"
                                   name="password"
                                   [(ngModel)]="tenantRegistrationModel.adminPassword"
                                   reverse="true"
                                   autoComplete="off"
                                   required>
                            <span class="pass" (click)="showPassword = !showPassword">{{ls.l(showPassword ? 'hide' : 'show')}}</span>
                            <validation-messages [formCtrl]="passwordInput" [errorDefs]="[{pattern: ls.l('{0}IsInvalid', ls.l('Password'))}]"></validation-messages>
                        </div>
                        <ng-container *ngIf="passwordInput.errors && passwordInput.value">
                            <div id="message" class="entrance-page__form-validator is-active">
                                <div class="message-inner">
                                    <p id="letter"
                                       class="validator-rule"
                                       *ngIf="passwordComplexitySetting.requireLowercase"
                                       [ngClass]="{
                                        'invalid': (passwordInput?.errors && passwordInput?.errors?.requireLowercase) || !passwordInput.value,
                                        'valid': !passwordInput?.errors?.requireLowercase
                                        }">
                                        {{ls.l('PasswordComplexity_RequireLowercase_Hint')}}
                                    </p>
                                    <p id="capital"
                                       class="validator-rule"
                                       *ngIf="passwordComplexitySetting.requireUppercase"
                                       [ngClass]="{
                                        'invalid': (passwordInput?.errors && passwordInput?.errors?.requireUppercase) || !passwordInput.value,
                                        'valid': !passwordInput?.errors?.requireUppercase
                                       }">
                                        {{ls.l('PasswordComplexity_RequireUppercase_Hint')}}
                                    </p>
                                    <p id="number"
                                       class="validator-rule"
                                       *ngIf="passwordComplexitySetting.requireDigit"
                                       [ngClass]="{
                                        'invalid': (passwordInput?.errors && passwordInput?.errors?.requireDigit) || !passwordInput.value,
                                        'valid': !passwordInput?.errors?.requireDigit
                                       }">
                                        {{ls.l('PasswordComplexity_RequireDigit_Hint')}}
                                    </p>
                                    <p id="length"
                                       class="validator-rule"
                                       *ngIf="passwordComplexitySetting.requiredLength"
                                       [ngClass]="{
                                        'invalid': (passwordInput?.errors && passwordInput?.errors?.requiredLength) || !passwordInput.value,
                                        'valid': !passwordInput?.errors?.requiredLength
                                       }">
                                        {{ls.l('PasswordComplexity_RequiredLength_Hint', passwordComplexitySetting.requiredLength)}}
                                    </p>
                                    <p id="special"
                                       class="validator-rule"
                                       *ngIf="passwordComplexitySetting.requireNonAlphanumeric"
                                       [ngClass]="{
                                        'invalid': (passwordInput?.errors && passwordInput?.errors?.requireNonAlphanumeric) || !passwordInput.value,
                                        'valid': !passwordInput?.errors?.requireNonAlphanumeric
                                        }">
                                        {{ls.l('PasswordComplexity_RequireNonAlphanumeric_Hint')}}
                                    </p>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </div>
                <div class="input name__input" *ngIf="productInfo.publicAllowCoupon && !isFreeProductSelected && !selectedPriceOption.customerChoosesPrice">
                    <label class="coupon">
                        Coupon
                    </label>
                    <div class="coupon-row">
                        <div class="coupon-input">
                            <input type="text" placeholder="" name="coupon" maxlength="36" [(ngModel)]="requestInfo.couponCode"
                                   (change)="couponChange()" [attr.disabled]="couponLoading || couponInfo ? true : null">
                            <i *ngIf="couponInfo" class="fa fa-close" (click)="clearCoupon()"></i>
                        </div>
                        <i *ngIf="couponLoading" class="fa fa-spinner fa-spin"></i>
                        <button class="button_global button_global_green" [ngClass]="{disabled: !requestInfo.couponCode || couponLoading}" (click)="loadCouponInfo()">Apply</button>
                    </div>
                    <div *ngIf="couponInfo">Applied {{couponInfo['description']}}</div>
                    <div *ngIf="showCouponError" class="error">Coupon is invalid</div>
                </div>
                <div *ngIf="hasToSOrPolicy" class="actions">
                    <div>
                        <label class="check_wrap">
                            <input class="check_wrap__input" type="checkbox" [(ngModel)]="agreedTermsAndServices" [ngModelOptions]="{standalone: true}">
                            <span class="check_wrap__style"></span>
                            <div>
                                By using this page, you agree to
                                <ng-container *ngIf="productInfo.data.tenantHasTerms">
                                    <a href="javascript:void(0);" (click)="openConditionsDialog(conditions.Terms)">Terms of Service</a>
                                    <span *ngIf="productInfo.data.tenantHasPrivacyPolicy"> and </span>
                                </ng-container>
                                <a *ngIf="productInfo.data.tenantHasPrivacyPolicy" href="javascript:void(0);" (click)="openConditionsDialog(conditions.Policies)">Privacy Policy</a>.
                            </div>
                        </label>
                    </div>
                </div>
                <div class="login_btn">
                    <ng-container *ngIf="!productInfo.data.hasTenantService else tenantSubmit">
                        <div [style.display]="showSubmitButton() ? 'block' : 'none'">
                            <button class="button_global button_global_green" [ngClass]="{disabled: !isFormValid()}" (click)="submitFreeRequest()">
                                {{ selectedPriceOption.type == priceOptionType.Subscription ? 'Subscribe' : 'Purchase' }}
                            </button>
                        </div>
                        <div class="gateways" [style.display]="!showSubmitButton() ? 'flex' : 'none'">
                            <button *ngIf="showStripeButton()" class="button_global button_global_purple" [ngClass]="{disabled: !isFormValid()}" (click)="submitStripeRequest()">
                                Pay with <img src="assets/common/images/stripe.svg" />
                            </button>
                            <pay-pal [style.display]="showPayPalButton() ? 'block' : 'none'"
                                     [height]="55"
                                     [showButtonType]="paypalButtonType"
                                     [disabled]="!isFormValid()"
                                     (onApprove)="redirectToReceipt()">
                            </pay-pal>
                            <spreedly-pay-buttons *ngIf="showSpreedlyButtons()"
                                                  [environmentKey]="productInfo.data.spreedlyConfiguration.environmentKey"
                                                  [gateways]="productInfo.data.spreedlyConfiguration.spreedlyGateways"
                                                  [disabled]="!isFormValid()"
                                                  (onButtonClick)="onSpreedlyClick($event)"
                                                  (onPaymentMethod)="onSpreedlyPaymentMethod($event)">
                            </spreedly-pay-buttons>
                            <div *ngIf="showNoPaymentSystems" class="no-payment-systems">
                                Payment systems are not configured
                            </div>
                        </div>
                    </ng-container>
                    <ng-template #tenantSubmit>
                        <div>
                            <button class="button_global button_global_green" [ngClass]="{disabled: !isFormValid()}" (click)="submitTenant()">
                                {{getTenantButtonText()}}
                            </button>
                        </div>
                    </ng-template>
                </div>
            </form>
        </div>
        <div *ngIf="isDonationGoalReached && !productInfo.productDonation.keepActiveIfGoalReached" class="goal-reached-message">
            <p>Thank you for your interest in supporting our cause.</p>
            <p>We wanted to inform you that our donation campaign has now closed as we have successfully reached our goal.<br /> We deeply appreciate your willingness to contribute and make a difference.</p>
        </div>
        <div *ngIf="!isInStock" class="goal-reached-message">
            <p>The product is currently out of stock. Please check back later or contact customer support for further assistance.</p>
        </div>
    </div>
    <div class="footer">
        {{currentYear}} &copy; {{hostName}} Platform
    </div>
</div>
<app-tracking-scripts *ngIf="productInfo && productInfo.data"
                      [config]="productInfo.data.trackingTools">
</app-tracking-scripts>
