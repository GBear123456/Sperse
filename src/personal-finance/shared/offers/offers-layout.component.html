<div class="container wrapper">
    <header class="text-center" *ngIf="(category$ | async) as prefix">
        <ng-container *ngIf="prefix != 'BusinessLoans'; else BusinessLoans">
            <h1>{{ls.l('OfferTopTitle')}}</h1>
            <p>{{ls.l('OfferTopDescription')}}</p>
        </ng-container>
        <ng-template #BusinessLoans>
            <h1 class="text-left">{{ categoryDisplayName$ | async }}</h1>
        </ng-template>
    </header>
    <div class="row main">
        <div class="filter-side-bar md-hidden col-lg-4" #filtersSideBar>
            <div #leftRef class="sticky">
                <ng-content select="[leftContent]"></ng-content>
            </div>
            <!--Default left section-->
            <div *ngIf="leftRef.childNodes.length === 0" class="sticky">
                <h2 class="text-left">{{ ls.l('Refine_Your_Search')}}</h2>
                <ul class="filters">
                    <ng-container *ngFor="let filter of filters$ | async">
                        <li [ngClass]="{'slider-filter': filter.type === 2}">
                            <div class="filterName" *ngIf="filter.name">
                                {{ filter.name }}
                            </div>
                            <ng-container [ngSwitch]="filter.type">
                                <ng-container *ngSwitchCase="filterType.Checkbox">
                                    <ng-container *ngFor="let filterValue of filter.values$ | async; let i = index">
                                        <mat-checkbox *ngIf="filter.showAll || i < maxDisplayedFilterValues" (change)="filter.onChange && filter.onChange($event)" [value]="filterValue.value || filterValue">
                                            <span *ngIf="!filter.type">{{ filterValue.name || filterValue }}</span>
                                            <stars-rating *ngIf="filter.type === 'rating'" [maxRating]="filterValue"></stars-rating>
                                        </mat-checkbox>
                                    </ng-container>
                                    <button class="viewMore" *ngIf="!filter.showAll" (click)="filter.showAll = true">{{ ls.l('Offers_ViewMore') }}</button>
                                </ng-container>
                                <ng-container *ngSwitchCase="filterType.Radio">
                                    <mat-radio-group (change)="filter.onChange($event)" [value]="filter.selected$ | async">
                                        <mat-radio-button *ngFor="let filterValue of filter.values$ | async" [value]="filterValue.value || filterValue">
                                            {{ filterValue.name || filterValue }}
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </ng-container>
                                <ng-container *ngSwitchCase="filterType.Range">
                                    <div class="sliderContainer">
                                        <div class="minMaxLabels">
                                            <div class="min">{{ filter.minMaxDisplayFunction ? filter.minMaxDisplayFunction(filter.min) : filter.min }}</div>
                                            <div class="max">{{ filter.minMaxDisplayFunction ? filter.minMaxDisplayFunction(filter.max) : filter.max }}</div>
                                        </div>
                                        <mat-slider
                                            [min]="filter.min"
                                            [max]="filter.max"
                                            [value]="(filter.selected$ | async) || filter.value"
                                            [class.greyTrackBackground]="!filter.fullBackground"
                                            [step]="filter.step || 1"
                                            (input)="changeStep($event, filter.stepsConditions)"
                                            (change)="filter.onChange && filter.onChange($event)"
                                            #slider>
                                        </mat-slider>
                                        <ng-container *ngIf="filter.valueDisplayFunction(slider.value) as value; else simpleValue">
                                            <ng-container *ngTemplateOutlet="value.name ? twoLinesTemplate : oneLineTemplate"></ng-container>
                                            <ng-template #oneLineTemplate>
                                                <div class="oneLineSliderValue">{{ value }}</div>
                                            </ng-template>
                                            <ng-template #twoLinesTemplate>
                                                <div class="twoLinesSliderBlock">
                                                    <div class="name">{{ value.name }}</div>
                                                    <div class="description">{{ value.description }}</div>
                                                </div>
                                            </ng-template>
                                        </ng-container>
                                        <ng-template #simpleValue><div class="oneLineSliderValue"></div>{{ slider.value }}</ng-template>
                                    </div>
                                </ng-container>
                                <ng-container *ngSwitchCase="filterType.Select">
                                    <ng-container *ngIf="(filter.values$ | async) as filterValues">
                                        <mat-select
                                            [value]="(filter.selected$ | async) || (filterValues[0] && filterValues[0].value) || filterValues[0]"
                                            (selectionChange)="filter.onChange && filter.onChange($event)" #select>
                                            <mat-select-trigger *ngIf="filter.templateName === 'rating'">
                                                <stars-rating [currentRating]="select.value" color="#f0d500"></stars-rating>
                                            </mat-select-trigger>
                                            <mat-option
                                                *ngFor="let filterOption of filterValues"
                                                [value]="filterOption.value || filterOption">
                                                <ng-container *ngIf="!filter.templateName">{{ filterOption.name || filterOption }}</ng-container>
                                                <ng-container *ngIf="filter.templateName === 'rating'">
                                                    <stars-rating [currentRating]="filterOption.value" color="#f0d500"></stars-rating>
                                                </ng-container>
                                            </mat-option>
                                        </mat-select>
                                    </ng-container>
                                </ng-container>
                                <ng-container *ngSwitchCase="filterType.Chooser">
                                    <ng-container *ngIf="(filter.values$ | async) as filterValues">
                                        <chooser-filter
                                            [options]="filterValues"
                                            [type]="filter.chooserType"
                                            [design]="filter.chooserDesign"
                                            (selectionChange)="filter.onChange && filter.onChange($event)">
                                        </chooser-filter>
                                    </ng-container>
                                </ng-container>
                                <ng-container *ngSwitchCase="filterType.Score">
                                    <ng-container *ngIf="(filter.values$ | async) as filterValues">
                                        <ng-container *ngIf="(filter.selected$ | async) as selected">
                                            <score-filter [items]="filterValues" [selected]="selected" (selectionChange)="filter.onChange && filter.onChange($event)"></score-filter>
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </ng-container>
                        </li>
                    </ng-container>
                </ul>
            </div>
        </div>

        <div class="offersList col-sm-12 col-lg-8" #offersList>
            <div #rightRef>
                <ng-content select="[rightContent]"></ng-content>
            </div>
            <!--Default right section-->
            <div *ngIf="rightRef.childNodes.length === 0">
                <div class="subHeader"  *ngIf="(category$ | async) as prefix" [ngClass]="prefix">
                    <h2 class="text-center">
                        {{ ls.l(prefix + '_Right_Title') }}
                    </h2>
                    <div class="mobileButtons">
                        <button class="btn btn-secondary sortingButton" (click)="toggleSorting($event)"></button>
                        <button class="btn-btn-secondary filteringButton" (click)="toggleFiltering($event)"></button>
                    </div>
                </div>
                <ul class="credit-cards-list">
                    <li class="row" *ngFor="let offerItem of displayedOffers$ | async | slice:0:visibleOffers; let i = index" [ngClass]="{'recommend': i < 3}">
                        <ng-container *ngIf="i == 0">
                            <div class="best-offer">
                                {{ls.l('Top_Deal_Found')}}
                            </div>
                        </ng-container>
                        <div class="corner-block" [ngClass]="{'secondary': i > 2}">
                            <span class="number">
                                {{i+1}}
                            </span>
                        </div>
                        <div class="left-side col-12 col-md-6 col-lg-5">
                            <div class="img-wrap">
                                <img [src]="offerItem.logoUrl" [alt]="offerItem.name" (click)="applyOffer(offerItem)">
                            </div>

                            <div class="actions-wrap">
                                <button class="applyButton" (click)="applyOffer(offerItem)">
                                    <span>{{ ls.l(buttonCaption) }}</span>
                                </button>
                            </div>
                        </div>
                        <div class="description col-12 col-md-6 col-lg-7">
                            <small *ngIf="offerItem.issuingBank" class="bank-name">{{ offerItem.issuingBank }}</small>
                            <h4 (click)="applyOffer(offerItem)">{{ offerItem.name }}</h4>
                            <!-- <p>Loan Amount $50,000</p> -->
                            <!-- <div class="rating" *ngIf="offerItem.overallRating">
                                <stars-rating [currentRating]="offerItem.overallRating" color="#f0d500"></stars-rating>
                                span>({{ offerItem.reviewsAmount + ' ' + ls.l('Offers_reviews') }})</span
                            </div> -->
                            <ul class="descriptionItems">
                                <ng-container *ngFor="let param of ['annualFee', 'rewardsRate', 'introRewardsBonus', 'regularAPR']">
                                    <li *ngIf="offerItem[param]">
                                        <p>{{ ls.l('Offers_' + param) }}: {{ offersService.getParamDisplayValue(offerItem[param]) }}</p>
                                    </li>
                                </ng-container>
                                <!-- <li><p>Loan Term: 24-72 Months</p></li>
                                <li><p>Credit Score: Fair/Good/Excellent</p></li> -->
                            </ul>
                        </div>
                    </li>
                </ul>

                <button (click)="showNextItems()" class="load-more-items"
                        *ngIf="itemsCount > 6">{{ls.l('Load_More_Offers_Found')}}</button>
                <app-no-data *ngIf="!offersAreLoading && offersAmount === 0"></app-no-data>
            </div>
        </div>
    </div>
</div>
