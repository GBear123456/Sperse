<div class="report-item accounts">
    <div class="report-item-title" id="accountBalances">
        <span>{{l("accountBalances")}}</span>
        <ul class="tab-btn pull-right" id="account-filter">
            <li><button (click)="statusButtonUpdate($event, 0)" type="button" class="active">Active</button></li>
            <li><button (click)="statusButtonUpdate($event, 1)" type="button">Closed</button></li>
        </ul>
    </div>
    <dx-data-grid [hoverStateEnabled]="true"
                  [selectedRowKeys]="[]"
                  [dataSource]="creditReport?.accounts"
                  (onSelectionChanged)="selectionChanged($event)"
                  (onCellClick)="collapseRows($event)"
                  (onRowClick)="toggleMasterRow($event)"
                  [masterDetail]="{ enabled: false, template: 'detail' }">
        <dxo-selection mode="single"></dxo-selection>
        <dxi-column dataField="accountName" caption="{{l('accountName')}}" sortOrder="asc"></dxi-column>
        <dxi-column dataField="creditLimit" caption="{{l('creditLimit')}}" format="currency"></dxi-column>
        <dxi-column dataField="availableCredit" caption="{{l('availableCredit')}}" [width]="135" format="currency" cssClass="availableCredit" cellTemplate="availableCredit">
            <div *dxTemplate="let credit of 'availableCredit'">
                <div class="availableCreditField">
                    <span class="progress" [style.width]="(100-credit.data.ratio) + '%'"></span>
                    <span class="text">{{ credit.text }}</span>
                </div>
            </div>
        </dxi-column>
        <dxi-column dataField="outstandingBalance" caption="{{l('outstandingBalance')}}" [width]="135" format="currency" cssClass="outstandingBalance" cellTemplate="outstandingBalance">
            <div *dxTemplate="let balance of 'outstandingBalance'">
                <div class="outstandingBalanceField"
                     [style.border-color]="balance.text !== '$0' ? '#e78372' : '#8F999F'"
                     [style.background-color]="balance.text !== '$0' ? 'rgba(224, 83, 59, 0.15)' : '#e4e4e4'">
                    <span class="progress" [style.width]="(balance.data.ratio) + '%'"></span>
                    <span class="text">{{ balance.text }}</span>
                </div>
            </div>
        </dxi-column>
        <dxi-column dataField="ratio" caption="{{l('ratio')}}" cellTemplate="accountRatio">
            <div *dxTemplate="let ratio of 'accountRatio'">
                <div class="ratioField">
                    <span class="text">{{ ratio.text }}%</span>
                    <div class="ratioProgressBar">
                        <span class="progress" [style.width]="ratio.text + '%'" [style.background-color]="getRatioColor(ratio.text)"></span>
                    </div>
                </div>
            </div>
        </dxi-column>
        <dxo-paging [pageSize]="40"></dxo-paging>
        <div *dxTemplate="let accountDetail of 'detail'">
            <table class="table account-summary">
                <thead>
                    <tr>
                        <th *ngFor="let item of ['AccountSummary', 'status', 'totalCreditLimit', 'availableCredit', 'outstandingBalance', 'creditUtilization']">
                            {{l(item)}}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let bureauRow of accountInfo" class="account-summary-row">
                        <td>
                            <img src="assets/images/credit-report/{{bureauRow.bureau | lowercase}}.png" srcset="assets/images/credit-report/{{bureauRow.bureau | lowercase}}@2x.png 2x, assets/images/credit-report/{{bureauRow.bureau | lowercase}}@3x.png 3x" class="bureau-img">
                        </td>
                        <td class="status">
                            <ng-container *ngIf="bureauRow.status == 0; else closed">
                                <span class="open"><i class="fa fa-circle" aria-hidden="true"></i> {{l("open")}}</span>
                            </ng-container>
                            <ng-template #closed>
                                <span class="closed"><i class="fa fa-circle" aria-hidden="true"></i> {{l("closed")}}</span>
                            </ng-template>
                        </td>
                        <td *ngFor="let item of ['totalCreditLimit', 'availableCredit', 'balance']">{{bureauRow[item] | currency:'USD':true:'1.0'}}</td>
                        <td>
                            <ng-container *ngIf="bureauRow['creditUtilization']">
                                <div class="creditUtilizationWrap">
                                    <span class="text">{{bureauRow['creditUtilization']}}%</span>
                                    <div class="creditUtilizationProgressBar">
                                        <span class="progress" [style.width]="bureauRow['creditUtilization'] + '%'" [style.background-color]="getRatioColor(bureauRow['creditUtilization'])"></span>
                                    </div>
                                </div>
                            </ng-container>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table credit-history">
                <thead>
                    <tr>
                        <th rowspan="2">{{l('CreditHistory')}}</th>
                        <th *ngFor="let year of creditHistoryYears" [colSpan]="getCreditHistoryYearSpan(year)">
                            {{year}}
                        </th>
                    </tr>
                    <tr>
                        <th *ngFor="let month of creditHistoryMonths" class="text-center">
                            {{l('MonthLetters')[month]}}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let account of accountInfo">
                        <td>
                            <img src="assets/images/credit-report/{{account.bureau | lowercase}}.png" srcset="assets/images/credit-report/{{account.bureau | lowercase}}@2x.png 2x, assets/images/credit-report/{{account.bureau | lowercase}}@3x.png 3x" class="bureau-img">
                        </td>
                        <td *ngFor="let month of creditHistoryMonths; let i = index" class="text-center"><i class="fa fa-thumbs-{{getAccountInfoUI(account.bureau, i, month).isPositive ? 'up': 'down'}} status-{{getAccountInfoUI(account.bureau, i, month).status}}" title="{{getAccountInfoUI(account.bureau, i, month).title}}" aria-hidden="true"></i></td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>{{l("AccountDetails")}}</th>
                        <th *ngFor="let item of accountInfo">
                            <img src="assets/images/credit-report/{{item.bureau | lowercase}}.png" srcset="assets/images/credit-report/{{item.bureau | lowercase}}@2x.png 2x, assets/images/credit-report/{{item.bureau | lowercase}}@3x.png 3x" class="bureau-img">
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let node of ['accountName','accountNumber','balance','pastDue','dateOpened','status','moPayment','paymentStatus','terms', 'comment']">
                        <td class="row-title" width="200">
                            {{ l(node) }}
                        </td>
                        <td *ngFor="let item of accountInfo">
                            {{ getAccountInfoValue(item, node) }}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <dxo-summary>
            <dxi-total-item column="accountName"
                            displayFormat="Total:">
            </dxi-total-item>
            <dxi-total-item column="creditLimit"
                            summaryType="sum"
                            displayFormat="{0}"
                            valueFormat="currency">
            </dxi-total-item>
            <dxi-total-item column="availableCredit"
                            summaryType="sum"
                            displayFormat="{0}"
                            valueFormat="currency">
            </dxi-total-item>
            <dxi-total-item column="outstandingBalance"
                            summaryType="sum"
                            displayFormat="{0}"
                            valueFormat="currency">
            </dxi-total-item>
        </dxo-summary>
    </dx-data-grid>
</div>
